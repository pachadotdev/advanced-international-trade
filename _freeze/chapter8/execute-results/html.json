{
  "hash": "47feb71aee73d43659db9f6e1318a9d9",
  "result": {
    "engine": "knitr",
    "markdown": "\n# Chapter 8. Import Quotas and Export Subsidies\n\n## Empirical exercise\n\nThis exercise is to reproduce regression results Feenstra (1988a). To complete the exercise, the files \"car_7990.dta, truck_7990.dta\" should be stored in `Chapter-8`.  \n\n## Documentation\n\nData Description for Feenstra (1988a):\n\n1. `car.dta`: This STATA file contains car’s various characteristics, such as weight (wght), width (wdth), height (hght), horse power (hs), four-wheel (four), transmission (tran), power steering (ps) and air condition (ac) for 1979-1990. It also includes each model’s sales (quan) and price.\n2. `truck.dta`: This STATA file contains truck’s various characteristics, such as weight (wght), width (wdth), height (hght), horse power (hs), four-wheel (four), transmission (tran), power steering (ps) and air condition (ac) for 1979-1990. It also includes each model’s sale (quan) and price, though sales are missing after 1985.\n\n## Exercise 1\n\nRun the programs `pindex_c.do`, `pindex_t.do`, `unit_value.do` to reproduce the price indexes and unit-values for cars and trucks in Table 8.3.  What formula is used for the price indexes, and how does this differ from the unit-values?\n\n### Feenstra's code\n\n#### pindex_c.do\n\n```stata\nclear\ncapture log close\nlog using Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\pindex_c.log,replace\n\nuse Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\car_7990,clear\nkeep year model type price quan\n\npreserve\nkeep if year==80\nkeep model type price quan\nren price price_80\nren quan quan_80\nsort model\nsave Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\car_80,replace\nrestore\n\nsort model\nmerge model using Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\car_80\nkeep if _merge==3\ndrop _merge\n\nsort year model\negen value_80=sum(price_80*quan_80), by(year)\negen value_cp=sum(price*quan_80),by(year)\ngen lasp=value_cp/value_80\n\negen value_c=sum(price*quan), by(year)\negen value_cq=sum(price_80*quan), by(year)\ngen pasp=value_c/value_cq\n \ngen pindex=(lasp*pasp)^0.5\n\ncollapse (mean) pindex, by(year)\nlist\n\nlog close\n```\n\nOutput:\n\n```stata\n. clear\n\n. capture log close\n\n. log using Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapte\n> r-8\\pindex_c.log,replace\n(note: file Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapte\n> r-8\\pindex_c.log not found)\n----------------------------------------------------------------------------------\n      name:  <unnamed>\n       log:  Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapt\n> er-8\\pindex_c.log\n  log type:  text\n opened on:  19 Jun 2024, 18:40:59\n\n. \n. use Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\ca\n> r_7990,clear\n\n. keep year model type price quan\n\n. \n. preserve\n\n. keep if year==80\n(260 observations deleted)\n\n. keep model type price quan\n\n. ren price price_80\n\n. ren quan quan_80\n\n. sort model\n\n. save Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\c\n> ar_80,replace\nfile Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\car\n> _80.dta saved\n\n. restore\n\n. \n. sort model\n\n. merge model using Z:\\home\\pacha\\github\\advanced-international-trade\\first-editio\n> n\\Chapter-8\\car_80\n(note: you are using old merge syntax; see [R] merge for new syntax)\nvariable model does not uniquely identify observations in the master data\n\n. keep if _merge==3\n(55 observations deleted)\n\n. drop _merge\n\n. \n. sort year model\n\n. egen value_80=sum(price_80*quan_80), by(year)\n\n. egen value_cp=sum(price*quan_80),by(year)\n\n. gen lasp=value_cp/value_80\n\n. \n. egen value_c=sum(price*quan), by(year)\n\n. egen value_cq=sum(price_80*quan), by(year)\n\n. gen pasp=value_c/value_cq\n\n.  \n. gen pindex=(lasp*pasp)^0.5\n\n. \n. collapse (mean) pindex, by(year)\n\n. list\n\n     +-----------------+\n     | year     pindex |\n     |-----------------|\n  1. |   79      .9663 |\n  2. |   80          1 |\n  3. |   81   1.197522 |\n  4. |   82   1.289163 |\n  5. |   83   1.312988 |\n     |-----------------|\n  6. |   84   1.389093 |\n  7. |   85   1.477987 |\n  8. |   86   1.668846 |\n  9. |   87   1.885685 |\n 10. |   88    2.04798 |\n     |-----------------|\n 11. |   89   2.082082 |\n 12. |   90    2.10851 |\n     +-----------------+\n\n. \n. log close\n      name:  <unnamed>\n       log:  Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapt\n> er-8\\pindex_c.log\n  log type:  text\n closed on:  19 Jun 2024, 18:41:01\n----------------------------------------------------------------------------------\n\n. \nend of do-file\n```\n\n#### pindex_t.do\n\n```stata\nclear\ncapture log close\nlog using Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\pindex_t.log,replace\n\nuse Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\truck_7990,clear\nkeep year model type price quan\n\npreserve\nkeep if year==80\nkeep model type price quan\nren price price_80\nren quan quan_80\nsort model\nsave Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\truck_80,replace\nrestore\n\nsort model\nmerge model using Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\truck_80\nkeep if _merge==3\ndrop _merge\n\nsort year model\negen value_80=sum(price_80*quan_80), by(year)\negen value_cp=sum(price*quan_80),by(year)\ngen lasp=value_cp/value_80\n\negen value_c=sum(price*quan), by(year)\negen value_cq=sum(price_80*quan), by(year)\ngen pasp=value_c/value_cq\n \ngen pindex=(lasp*pasp)^0.5\n\ncollapse (mean) pindex, by(year)\nlist\n\nlog close\n```\n\nOutput:\n\n```stata\n. clear\n\n. capture log close\n\n. log using Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapte\n> r-8\\pindex_t.log,replace\n(note: file Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapte\n> r-8\\pindex_t.log not found)\n----------------------------------------------------------------------------------\n      name:  <unnamed>\n       log:  Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapt\n> er-8\\pindex_t.log\n  log type:  text\n opened on:  19 Jun 2024, 18:59:29\n\n. \n. use Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\tr\n> uck_7990,clear\n\n. keep year model type price quan\n\n. \n. preserve\n\n. keep if year==80\n(110 observations deleted)\n\n. keep model type price quan\n\n. ren price price_80\n\n. ren quan quan_80\n\n. sort model\n\n. save Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\t\n> ruck_80,replace\nfile Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\tru\n> ck_80.dta saved\n\n. restore\n\n. \n. sort model\n\n. merge model using Z:\\home\\pacha\\github\\advanced-international-trade\\first-editio\n> n\\Chapter-8\\truck_80\n(note: you are using old merge syntax; see [R] merge for new syntax)\nvariable model does not uniquely identify observations in the master data\n\n. keep if _merge==3\n(38 observations deleted)\n\n. drop _merge\n\n. \n. sort year model\n\n. egen value_80=sum(price_80*quan_80), by(year)\n\n. egen value_cp=sum(price*quan_80),by(year)\n\n. gen lasp=value_cp/value_80\n\n. \n. egen value_c=sum(price*quan), by(year)\n\n. egen value_cq=sum(price_80*quan), by(year)\n\n. gen pasp=value_c/value_cq\n(21 missing values generated)\n\n.  \n. gen pindex=(lasp*pasp)^0.5\n(21 missing values generated)\n\n. \n. collapse (mean) pindex, by(year)\n\n. list\n\n     +-----------------+\n     | year     pindex |\n     |-----------------|\n  1. |   79    .970215 |\n  2. |   80          1 |\n  3. |   81   1.278085 |\n  4. |   82   1.309353 |\n  5. |   83   1.210055 |\n     |-----------------|\n  6. |   84   1.230847 |\n  7. |   85   1.252268 |\n  8. |   86          . |\n  9. |   87          . |\n 10. |   88          . |\n     |-----------------|\n 11. |   89          . |\n 12. |   90          . |\n     +-----------------+\n\n. \n. log close\n      name:  <unnamed>\n       log:  Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapt\n> er-8\\pindex_t.log\n  log type:  text\n closed on:  19 Jun 2024, 18:59:31\n----------------------------------------------------------------------------------\n\n. \nend of do-file\n```\n\n#### unit_value.do\n\n```stata\nclear\ncapture log close\nlog using Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\unit_value.log,replace\n\nuse Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\car_7990,clear\n\ngen value=price*quan\negen aquan=mean(quan), by(year)\negen avalue=mean(value), by(year)\ngen uvalue=avalue/aquan\ncollapse (mean) uvalue, by(year)\nlist\nclear\n\nuse Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\truck_7990,clear\ngen value=price*quan\negen aquan=mean(quan), by(year)\negen avalue=mean(value), by(year)\ngen uvalue=avalue/aquan\ncollapse (mean) uvalue, by(year)\nlist\nclear\n\nlog close\nexit\n```\n\nOutput:\n\n```stata\n. clear\n\n. capture log close\n\n. log using Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapte\n> r-8\\unit_value.log,replace\n(note: file Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapte\n> r-8\\unit_value.log not found)\n----------------------------------------------------------------------------------\n      name:  <unnamed>\n       log:  Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapt\n> er-8\\unit_value.log\n  log type:  text\n opened on:  19 Jun 2024, 19:13:08\n\n. \n. use Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\ca\n> r_7990,clear\n\n. \n. gen value=price*quan\n\n. egen aquan=mean(quan), by(year)\n\n. egen avalue=mean(value), by(year)\n\n. gen uvalue=avalue/aquan\n\n. collapse (mean) uvalue, by(year)\n\n. list\n\n     +-----------------+\n     | year     uvalue |\n     |-----------------|\n  1. |   79   4945.603 |\n  2. |   80   5174.757 |\n  3. |   81   6210.741 |\n  4. |   82   6834.219 |\n  5. |   83   7069.203 |\n     |-----------------|\n  6. |   84   7518.311 |\n  7. |   85   8153.146 |\n  8. |   86   9391.989 |\n  9. |   87   10396.91 |\n 10. |   88    10840.6 |\n     |-----------------|\n 11. |   89   10492.76 |\n 12. |   90   11112.68 |\n     +-----------------+\n\n. clear\n\n. \n. use Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\tr\n> uck_7990,clear\n\n. gen value=price*quan\n\n. egen aquan=mean(quan), by(year)\n\n. egen avalue=mean(value), by(year)\n\n. gen uvalue=avalue/aquan\n(45 missing values generated)\n\n. collapse (mean) uvalue, by(year)\n\n. list\n\n     +-----------------+\n     | year     uvalue |\n     |-----------------|\n  1. |   79   4794.177 |\n  2. |   80   4937.291 |\n  3. |   81   6313.539 |\n  4. |   82   6426.264 |\n  5. |   83   6134.027 |\n     |-----------------|\n  6. |   84   6246.728 |\n  7. |   85   6249.927 |\n  8. |   86          . |\n  9. |   87          . |\n 10. |   88          . |\n     |-----------------|\n 11. |   89          . |\n 12. |   90          . |\n     +-----------------+\n\n. clear\n\n. \n. log close\n      name:  <unnamed>\n       log:  Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapt\n> er-8\\unit_value.log\n  log type:  text\n closed on:  19 Jun 2024, 19:13:10\n----------------------------------------------------------------------------------\n\n. exit\n\nend of do-file\n```\n\n### My code\n\n#### pindex_c.do\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Packages ----\n\nlibrary(archive)\nlibrary(haven)\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(broom)\nlibrary(knitr)\n\n# Extract ----\n\nfzip <- \"first-edition/Chapter-8.zip\"\ndout <- gsub(\"\\\\.zip$\", \"\", fzip)\n\nif (!dir.exists(dout)) {\n  archive_extract(fzip, dir = dout)\n}\n\n# Read and transform ----\n\nfout <- paste0(dout, \"/feenstra_88.rds\")\n\nif (!file.exists(fout)) {\n  feenstra_88 <- list(\n    car_7990 = read_dta(paste0(dout, \"/car_7990.dta\")),\n    truck_7990 = read_dta(paste0(dout, \"/truck_7990.dta\"))\n  )\n\n  saveRDS(feenstra_88, fout)\n} else {\n  feenstra_88 <- readRDS(fout)\n}\n\ncar_7990 <- feenstra_88$car_7990 %>%\n  select(year, model, type, price, quan) %>%\n  arrange(year, model)\n\ncar_80 <- car_7990 %>%\n  filter(year == 80) %>%\n  select(model, type, price, quan) %>%\n  rename(price_80 = price, quan_80 = quan)\n\ncar_7990 <- car_7990 %>%\n  inner_join(car_80) %>%\n  group_by(year) %>%\n  mutate(\n    value_80 = sum(price_80 * quan_80),\n    value_cp = sum(price * quan_80)\n  ) %>%\n  ungroup() %>%\n  mutate(lasp = value_cp / value_80)\n\ncar_7990 <- car_7990 %>%\n  group_by(year) %>%\n  mutate(\n    value_c = sum(price * quan),\n    value_cq = sum(price_80 * quan)\n  ) %>%\n  ungroup() %>%\n  mutate(pasp = value_c / value_cq)\n\ncar_7990 %>%\n  mutate(pindex = sqrt(lasp * pasp)) %>%\n  group_by(year) %>%\n  summarise(pindex = mean(pindex))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 12 × 2\n    year pindex\n   <dbl>  <dbl>\n 1    79  0.966\n 2    80  1    \n 3    81  1.20 \n 4    82  1.29 \n 5    83  1.31 \n 6    84  1.39 \n 7    85  1.48 \n 8    86  1.67 \n 9    87  1.89 \n10    88  2.05 \n11    89  2.08 \n12    90  2.11 \n```\n\n\n:::\n:::\n\n\n\n\n\n#### pindex_t.do\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntruck_7990 <- feenstra_88$truck_7990 %>%\n  select(year, model, type, price, quan) %>%\n  arrange(year, model)\n\ntruck_80 <- truck_7990 %>%\n  filter(year == 80) %>%\n  select(model, type, price, quan) %>%\n  rename(price_80 = price, quan_80 = quan)\n\ntruck_7990 <- truck_7990 %>%\n  inner_join(truck_80) %>%\n  group_by(year) %>%\n  mutate(\n    value_80 = sum(price_80 * quan_80),\n    value_cp = sum(price * quan_80)\n  ) %>%\n  ungroup() %>%\n  mutate(lasp = value_cp / value_80)\n\ntruck_7990 <- truck_7990 %>%\n  group_by(year) %>%\n  mutate(\n    value_c = sum(price * quan),\n    value_cq = sum(price_80 * quan)\n  ) %>%\n  ungroup() %>%\n  mutate(pasp = value_c / value_cq)\n\ntruck_7990 %>%\n  mutate(pindex = sqrt(lasp * pasp)) %>%\n  group_by(year) %>%\n  summarise(pindex = mean(pindex))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 12 × 2\n    year  pindex\n   <dbl>   <dbl>\n 1    79   0.970\n 2    80   1    \n 3    81   1.28 \n 4    82   1.31 \n 5    83   1.21 \n 6    84   1.23 \n 7    85   1.25 \n 8    86 NaN    \n 9    87 NaN    \n10    88 NaN    \n11    89 NaN    \n12    90 NaN    \n```\n\n\n:::\n:::\n\n\n\n\n\n#### unit_value.do\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncar_7990 <- feenstra_88$car_7990 %>%\n  mutate(value = price * quan) %>%\n  group_by(year) %>%\n  mutate(\n    aquan = mean(quan),\n    avalue = mean(value),\n    uvalue = avalue / aquan\n  )\n\ntruck_7990 <- feenstra_88$truck_7990 %>%\n  mutate(value = price * quan) %>%\n  group_by(year) %>%\n  mutate(\n    aquan = mean(quan),\n    avalue = mean(value),\n    uvalue = avalue / aquan\n  )\n\ncar_7990 %>%\n  group_by(year) %>%\n  summarise(uvalue = mean(uvalue))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 12 × 2\n    year uvalue\n   <dbl>  <dbl>\n 1    79  4946.\n 2    80  5175.\n 3    81  6211.\n 4    82  6834.\n 5    83  7069.\n 6    84  7518.\n 7    85  8153.\n 8    86  9392.\n 9    87 10397.\n10    88 10841.\n11    89 10493.\n12    90 11113.\n```\n\n\n:::\n\n```{.r .cell-code}\ntruck_7990 %>%\n  group_by(year) %>%\n  summarise(uvalue = mean(uvalue))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 12 × 2\n    year uvalue\n   <dbl>  <dbl>\n 1    79  4794.\n 2    80  4937.\n 3    81  6314.\n 4    82  6426.\n 5    83  6134.\n 6    84  6247.\n 7    85  6250.\n 8    86   NaN \n 9    87   NaN \n10    88   NaN \n11    89   NaN \n12    90   NaN \n```\n\n\n:::\n:::\n\n\n\n\n\n## Exercise 2\n\nRun the program `car_reg.do` to reproduce the column (1) in Table 8.4, and the program `truck_reg.do` to reproduce column (2). What weights are being used in the regression, and how does this affect the results?\n\n### Feenstra's code\n\n#### car_reg.do\n\n```stata\n\nclear\ncapture log close\nlog using Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\car_reg.log,replace\n\nuse Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\car_7990,clear\ndrop if year>=86\n\ntab year, gen(yd)\n\nprogram define nlcar\nversion 7.0\nif \"`1'\"==\"?\"{\nglobal S_1 \"a3 a4 a5 a6 a7 b2 b3 b4 b5 b6 b7 c1 c2 c3 c4 c5 c6 c7 c8\"\nglobal a3=1\nglobal a4=1\nglobal a5=1\nglobal a6=1\nglobal a7=1\nglobal b2=.1\nglobal b3=.1\nglobal b4=.1\nglobal b5=.1\nglobal b6=.1\nglobal b7=.1\nglobal c1=.1\nglobal c2=.1\nglobal c3=.1\nglobal c4=.1\nglobal c5=.1\nglobal c6=.1\nglobal c7=.1\nglobal c8=.1\nexit\n}\nreplace `1'=$a3*yd3+$a4*yd4+$a5*yd5+$a6*yd6+$a7*yd7/*\n*/+exp($b2*yd2+$b3*yd3+$b4*yd4+$b5*yd5+$b6*yd6+$b7*yd7/*\n*/+$c1*wght+$c2*wdth+$c3*hght+$c4*hp+$c5*tran+$c6*ps+$c7*ac+$c8)\n\nend\n\nnl car price\n\ngen winv=1/exp(_b[b2]*yd2+_b[b3]*yd3+_b[b4]*yd4+_b[b5]*yd5+_b[b6]*yd6+_b[b7]*yd7/*\n*/+_b[c1]*wght+_b[c2]*wdth+_b[c3]*hght+_b[c4]*hp+_b[c5]*tran+_b[c6]*ps+_b[c7]*ac+_b[c8])\n\ngen nprice=price*winv\ngen nyd3=yd3*winv\ngen nyd4=yd4*winv\ngen nyd5=yd5*winv\ngen nyd6=yd6*winv\ngen nyd7=yd7*winv\n\nprogram define nlncar\n\tversion 7.0\n\tif \"`1'\"==\"?\"{\n\t\tglobal S_1 \"a3 a4 a5 a6 a7 b2 b3 b4 b5 b6 b7 c1 c2 c3 c4 c5 c6 c7 c8\"\n\t\tglobal a3=1\n\t\tglobal a4=1\n\t\tglobal a5=1\t\n\t\tglobal a6=1\n\t\tglobal a7=1\n\t\tglobal b2=.1\t\n\t\tglobal b3=.1\n\t\tglobal b4=.1\n\t\tglobal b5=.1\n\t\tglobal b6=.1\t\n\t\tglobal b7=.1\n\t\tglobal c1=.1\n\t\tglobal c2=.1\n\t\tglobal c3=.1\n\t\tglobal c4=.1\n\t\tglobal c5=.1\n\t\tglobal c6=.1\n\t\tglobal c7=.1\n\t\tglobal c8=.1\n\t\texit\n\t}\n\treplace `1'=$a3*nyd3+$a4*nyd4+$a5*nyd5+$a6*nyd6+$a7*nyd7/*\n*/+winv*exp($b2*yd2+$b3*yd3+$b4*yd4+$b5*yd5+$b6*yd6+$b7*yd7/*\n*/+$c1*wght+$c2*wdth+$c3*hght+$c4*hp+$c5*tran+$c6*ps+$c7*ac+$c8)\n\nend\n\nnl ncar nprice\nclear\nprogram drop _all\nlog close\nexit\n```\n\nOutput:\n\n```stata\n. clear\n\n. capture log close\n\n. log using Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapte\n> r-8\\car_reg.log,replace\n(note: file Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapte\n> r-8\\car_reg.log not found)\n----------------------------------------------------------------------------------\n      name:  <unnamed>\n       log:  Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapt\n> er-8\\car_reg.log\n  log type:  text\n opened on:  19 Jun 2024, 19:28:58\n\n. \n. use Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\ca\n> r_7990,clear\n\n. drop if year>=86\n(105 observations deleted)\n\n. \n. tab year, gen(yd)\n\n       year |      Freq.     Percent        Cum.\n------------+-----------------------------------\n         79 |         21       11.73       11.73\n         80 |         24       13.41       25.14\n         81 |         24       13.41       38.55\n         82 |         24       13.41       51.96\n         83 |         26       14.53       66.48\n         84 |         29       16.20       82.68\n         85 |         31       17.32      100.00\n------------+-----------------------------------\n      Total |        179      100.00\n\n. \n. program define nlcar\n  1. version 7.0\n  2. if \"`1'\"==\"?\"{\n  3. global S_1 \"a3 a4 a5 a6 a7 b2 b3 b4 b5 b6 b7 c1 c2 c3 c4 c5 c6 c7 c8\"\n  4. global a3=1\n  5. global a4=1\n  6. global a5=1\n  7. global a6=1\n  8. global a7=1\n  9. global b2=.1\n 10. global b3=.1\n 11. global b4=.1\n 12. global b5=.1\n 13. global b6=.1\n 14. global b7=.1\n 15. global c1=.1\n 16. global c2=.1\n 17. global c3=.1\n 18. global c4=.1\n 19. global c5=.1\n 20. global c6=.1\n 21. global c7=.1\n 22. global c8=.1\n 23. exit\n 24. }\n 25. replace `1'=$a3*yd3+$a4*yd4+$a5*yd5+$a6*yd6+$a7*yd7/*\n> */+exp($b2*yd2+$b3*yd3+$b4*yd4+$b5*yd5+$b6*yd6+$b7*yd7/*\n> */+$c1*wght+$c2*wdth+$c3*hght+$c4*hp+$c5*tran+$c6*ps+$c7*ac+$c8)\n 26. \n. end\n\n. \n. nl car price\n(obs = 179)\n\nIteration 0:   residual SS =  1.16e+10\n...\nIteration 9:   residual SS =  8.39e+07\nIteration 10:  residual SS =  8.39e+07\n\n      Source |       SS       df       MS            Number of obs =       179\n-------------+------------------------------         F( 19,   160) =   1158.52\n       Model |  1.1541e+10    19   607414473         Prob > F      =    0.0000\n    Residual |    83888568   160   524303.55         R-squared     =    0.9928\n-------------+------------------------------         Adj R-squared =    0.9919\n       Total |  1.1625e+10   179  64942813.2         Root MSE      =  724.0881\n                                                     Res. dev.     =  2845.293\n(car)\n------------------------------------------------------------------------------\n       price |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]\n-------------+----------------------------------------------------------------\n          a3 |  -294.7452   723.3322    -0.41   0.684    -1723.255    1133.765\n          a4 |  -304.9631   714.5517    -0.43   0.670    -1716.132    1106.206\n          a5 |  -137.3977   700.8446    -0.20   0.845    -1521.497    1246.701\n          a6 |   72.87527   695.4052     0.10   0.917    -1300.482    1446.232\n          a7 |  -103.4007   742.9475    -0.14   0.889    -1570.649    1363.848\n          b2 |   .0099678   .0362994     0.27   0.784      -.06172    .0816555\n          b3 |   .1522578   .1022847     1.49   0.139    -.0497444      .35426\n          b4 |   .1899382   .0965319     1.97   0.051    -.0007027    .3805792\n          b5 |   .1540892   .0959124     1.61   0.110    -.0353283    .3435068\n          b6 |    .172972   .0944704     1.83   0.069    -.0135977    .3595417\n          b7 |   .2274326   .0945034     2.41   0.017     .0407977    .4140675\n          c1 |  -.0007315   .1021984    -0.01   0.994    -.2025632    .2011002\n          c2 |   .3681958   .1019742     3.61   0.000     .1668067    .5695849\n          c3 |  -.1431584   .0519385    -2.76   0.007    -.2457317    -.040585\n          c4 |   .6070451   .0665196     9.13   0.000     .4756756    .7384147\n          c5 |   .1315757   .0264479     4.97   0.000     .0793437    .1838078\n          c6 |   .0515819   .0218212     2.36   0.019     .0084872    .0946766\n          c7 |   .1635465   .0228493     7.16   0.000     .1184213    .2086717\n          c8 |    6.73024   .5719055    11.77   0.000     5.600783    7.859697\n------------------------------------------------------------------------------\n (SEs, P values, CIs, and correlations are asymptotic approximations)\n\n. \n. gen winv=1/exp(_b[b2]*yd2+_b[b3]*yd3+_b[b4]*yd4+_b[b5]*yd5+_b[b6]*yd6+_b[b7]*yd7\n> /*\n> */+_b[c1]*wght+_b[c2]*wdth+_b[c3]*hght+_b[c4]*hp+_b[c5]*tran+_b[c6]*ps+_b[c7]*ac\n> +_b[c8])\n\n. \n. gen nprice=price*winv\n\n. gen nyd3=yd3*winv\n\n. gen nyd4=yd4*winv\n\n. gen nyd5=yd5*winv\n\n. gen nyd6=yd6*winv\n\n. gen nyd7=yd7*winv\n\n. \n. program define nlncar\n  1.         version 7.0\n  2.         if \"`1'\"==\"?\"{\n  3.                 global S_1 \"a3 a4 a5 a6 a7 b2 b3 b4 b5 b6 b7 c1 c2 c3 c4 c5 c\n> 6 c7 c8\"\n  4.                 global a3=1\n  5.                 global a4=1\n  6.                 global a5=1     \n  7.                 global a6=1\n  8.                 global a7=1\n  9.                 global b2=.1    \n 10.                 global b3=.1\n 11.                 global b4=.1\n 12.                 global b5=.1\n 13.                 global b6=.1    \n 14.                 global b7=.1\n 15.                 global c1=.1\n 16.                 global c2=.1\n 17.                 global c3=.1\n 18.                 global c4=.1\n 19.                 global c5=.1\n 20.                 global c6=.1\n 21.                 global c7=.1\n 22.                 global c8=.1\n 23.                 exit\n 24.         }\n 25.         replace `1'=$a3*nyd3+$a4*nyd4+$a5*nyd5+$a6*nyd6+$a7*nyd7/*\n> */+winv*exp($b2*yd2+$b3*yd3+$b4*yd4+$b5*yd5+$b6*yd6+$b7*yd7/*\n> */+$c1*wght+$c2*wdth+$c3*hght+$c4*hp+$c5*tran+$c6*ps+$c7*ac+$c8)\n 26. \n. end\n\n. \n. nl ncar nprice\n(obs = 179)\n\nIteration 0:   residual SS =  174.4452\n...\nIteration 13:  residual SS =  1.672068\nIteration 14:  residual SS =  1.672068\n\n      Source |       SS       df       MS            Number of obs =       179\n-------------+------------------------------         F( 19,   160) =    871.41\n       Model |  173.025768    19  9.10661939         Prob > F      =    0.0000\n    Residual |  1.67206775   160  .010450423         R-squared     =    0.9904\n-------------+------------------------------         Adj R-squared =    0.9893\n       Total |  174.697836   179  .975965565         Root MSE      =  .1022273\n                                                     Res. dev.     = -328.5451\n(ncar)\n------------------------------------------------------------------------------\n      nprice |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]\n-------------+----------------------------------------------------------------\n          a3 |   410.4256   619.1744     0.66   0.508    -812.3829    1633.234\n          a4 |    378.927   650.2562     0.58   0.561     -905.265    1663.119\n          a5 |   770.6115   601.2054     1.28   0.202    -416.7099    1957.933\n          a6 |   624.3817   618.9925     1.01   0.315    -598.0676    1846.831\n          a7 |  -122.9148   719.4492    -0.17   0.865    -1543.756    1297.927\n          b2 |   .0089535   .0309918     0.29   0.773    -.0522522    .0701592\n          b3 |   .0474345   .1093808     0.43   0.665    -.1685818    .2634509\n          b4 |   .0938457    .108274     0.87   0.387    -.1199848    .3076761\n          b5 |   .0195742   .1052628     0.19   0.853    -.1883094    .2274579\n          b6 |   .0918745   .1019572     0.90   0.369     -.109481      .29323\n          b7 |   .2189293   .1012639     2.16   0.032      .018943    .4189156\n          c1 |   .0254744   .1207686     0.21   0.833    -.2130317    .2639805\n          c2 |   .3565755   .1083292     3.29   0.001      .142636     .570515\n          c3 |  -.0630705   .0554954    -1.14   0.257    -.1726685    .0465275\n          c4 |   .6899452   .0852231     8.10   0.000      .521638    .8582524\n          c5 |   .1428588   .0244762     5.84   0.000     .0945207    .1911968\n          c6 |   .0581011   .0272835     2.13   0.035     .0042188    .1119834\n          c7 |   .1473354    .033027     4.46   0.000     .0821103    .2125606\n          c8 |   6.328371   .5830815    10.85   0.000     5.176842    7.479899\n------------------------------------------------------------------------------\n (SEs, P values, CIs, and correlations are asymptotic approximations)\n\n. clear\n\n. program drop _all\n\n. log close\n      name:  <unnamed>\n       log:  Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapt\n> er-8\\car_reg.log\n  log type:  text\n closed on:  19 Jun 2024, 19:29:06\n----------------------------------------------------------------------------------\n\n. exit\n\nend of do-file\n```\n\n#### truck_reg.do\n\n```stata\n. clear\n\n. capture log close\n\n. log using Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\truck_reg.log,replace\n(note: file Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\truck_reg.log not found)\n--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------\n      name:  <unnamed>\n       log:  Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\truck_reg.log\n  log type:  text\n opened on:  18 Oct 2024, 17:38:02\n\n. \n. use Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\truck_7990,clear\n\n. \n. drop if year>=86\n(45 observations deleted)\n\n. gen lnprice=log(price)\n\n. \n. tab year, gen(yd)\n\n       year |      Freq.     Percent        Cum.\n------------+-----------------------------------\n         79 |         10       13.33       13.33\n         80 |         10       13.33       26.67\n         81 |         11       14.67       41.33\n         82 |         11       14.67       56.00\n         83 |         10       13.33       69.33\n         84 |         11       14.67       84.00\n         85 |         12       16.00      100.00\n------------+-----------------------------------\n      Total |         75      100.00\n\n. \n. program define nltruck_1\n  1. version 7.0\n  2.         if \"`1'\"==\"?\"{\n  3.                 global S_1\"a2 a3 a4 a5 a6 a7 b1 b2 b3 b4 b5 b6 b7 c1\"\n  4.                 global a2=1\n  5.                 global a3=1\n  6.                 global a4=1\n  7.                 global a5=1\n  8.                 global a6=1\n  9.                 global a7=1\n 10.                 global b1=1\n 11.                 global b2=1\n 12.                 global b3=1\n 13.                 global b4=1\n 14.                 global b5=1\n 15.                 global b6=1\n 16.                 global b7=1\n 17.                 global c1=1\n 18.                 exit\n 19.         }\n 20.         replace `1'=exp($a2*yd2+$a3*yd3+$a4*yd4+$a5*yd5+$a6*yd6+$a7*yd7/*\n> */+$b1*weight+$b2*wdth+$b3*hght+$b4*hp+$b5*tran+$b6*ps+$b7*four+$c1*1)\n 21. end\n\n. \n. nl truck_1 price\n(obs = 75)\n\nIteration 0:   residual SS =  2.50e+17\nIteration 1:   residual SS =  3.38e+16\nIteration 2:   residual SS =  4.57e+15\nIteration 3:   residual SS =  6.18e+14\nIteration 4:   residual SS =  8.35e+13\nIteration 5:   residual SS =  1.12e+13\nIteration 6:   residual SS =  1.50e+12\nIteration 7:   residual SS =  1.96e+11\nIteration 8:   residual SS =  2.44e+10\nIteration 9:   residual SS =  2.65e+09\nIteration 10:  residual SS =  2.09e+08\nIteration 11:  residual SS =  2.03e+07\nIteration 12:  residual SS =  1.53e+07\nIteration 13:  residual SS =  1.53e+07\nIteration 14:  residual SS =  1.53e+07\nIteration 15:  residual SS =  1.53e+07\nIteration 16:  residual SS =  1.53e+07\n\n      Source |       SS       df       MS            Number of obs =        75\n-------------+------------------------------         F( 14,    61) =   1004.27\n       Model |  3.5299e+09    14   252133551         Prob > F      =    0.0000\n    Residual |  15314779.4    61  251061.957         R-squared     =    0.9957\n-------------+------------------------------         Adj R-squared =    0.9947\n       Total |  3.5452e+09    75  47269126.6         Root MSE      =  501.0608\n                                                     Res. dev.     =  1129.854\n(truck_1)\n------------------------------------------------------------------------------\n       price |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]\n-------------+----------------------------------------------------------------\n          a2 |  -.0210733   .0423824    -0.50   0.621    -.1058222    .0636756\n          a3 |   .1734177   .0382242     4.54   0.000     .0969837    .2498518\n          a4 |   .2001205   .0385602     5.19   0.000     .1230145    .2772264\n          a5 |   .1454809   .0400948     3.63   0.001     .0653064    .2256555\n          a6 |   .1825347   .0394306     4.63   0.000     .1036883    .2613811\n          a7 |   .1592055    .042285     3.77   0.000     .0746514    .2437595\n          b1 |   .4398295   .0564709     7.79   0.000     .3269091      .55275\n          b2 |     .08571   .1119267     0.77   0.447    -.1381014    .3095213\n          b3 |  -.0487976   .0470736    -1.04   0.304     -.142927    .0453318\n          b4 |   .2482011   .1089575     2.28   0.026     .0303272     .466075\n          b5 |   .0341161   .0249591     1.37   0.177    -.0157928    .0840249\n          b6 |   .0942558   .0337561     2.79   0.007     .0267564    .1617552\n          b7 |   .2292275   .0271818     8.43   0.000     .1748741    .2835808\n          c1 |   7.536871   .5461675    13.80   0.000     6.444741       8.629\n------------------------------------------------------------------------------\n (SEs, P values, CIs, and correlations are asymptotic approximations)\n\n. \n. gen winv=1/exp(_b[a2]*yd2+_b[a3]*yd3+_b[a4]*yd4+_b[a5]*yd5+_b[a6]*yd6+_b[a7]*yd7/*\n> */+_b[b1]*weight+_b[b2]*wdth+_b[b3]*hght+_b[b4]*hp+_b[b5]*tran+_b[b6]*ps+_b[b7]*four+_b[c1]*1)\n\n. \n. gen nprice=price*winv\n\n. \n. program define nltruck_2\n  1.         version 7.0\n  2.         if \"`1'\"==\"?\"{\n  3.                 global S_1\"a2 a3 a4 a5 a6 a7 b1 b2 b3 b4 b5 b6 b7 c1\"\n  4.                 global a2=1\n  5.                 global a3=1\n  6.                 global a4=1\n  7.                 global a5=1\n  8.                 global a6=1\n  9.                 global a7=1\n 10.                 global b1=1\n 11.                 global b2=1\n 12.                 global b3=1\n 13.                 global b4=1\n 14.                 global b5=1\n 15.                 global b6=1\n 16.                 global b7=1\n 17.                 global c1=1\n 18.                 exit\n 19.         }\n 20.         replace `1'=winv*exp($a2*yd2+$a3*yd3+$a4*yd4+$a5*yd5+$a6*yd6+$a7*yd7/*\n> */+$b1*weight+$b2*wdth+$b3*hght+$b4*hp+$b5*tran+$b6*ps+$b7*four+$c1*1)\n 21. end\n\n. \n. nl truck_2 nprice\n(obs = 75)\n\nIteration 0:   residual SS =  2.27e+09\nIteration 1:   residual SS =  3.07e+08\nIteration 2:   residual SS =  4.15e+07\nIteration 3:   residual SS =   5608900\nIteration 4:   residual SS =  757532.6\nIteration 5:   residual SS =  101968.1\nIteration 6:   residual SS =  13611.98\nIteration 7:   residual SS =   1784.24\nIteration 8:   residual SS =  224.5781\nIteration 9:   residual SS =  24.89367\nIteration 10:  residual SS =  2.123931\nIteration 11:  residual SS =  .3646277\nIteration 12:  residual SS =  .3191061\nIteration 13:  residual SS =  .3190177\nIteration 14:  residual SS =  .3190176\nIteration 15:  residual SS =  .3190176\nIteration 16:  residual SS =  .3190176\n\n      Source |       SS       df       MS            Number of obs =        75\n-------------+------------------------------         F( 14,    61) =   1023.93\n       Model |  74.9691322    14  5.35493802         Prob > F      =    0.0000\n    Residual |  .319017551    61  .005229796         R-squared     =    0.9958\n-------------+------------------------------         Adj R-squared =    0.9948\n       Total |  75.2881498    75    1.003842         Root MSE      =  .0723173\n                                                     Res. dev.     =  -196.659\n(truck_2)\n------------------------------------------------------------------------------\n      nprice |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]\n-------------+----------------------------------------------------------------\n          a2 |   .0041382   .0326606     0.13   0.900    -.0611707    .0694472\n          a3 |   .2093262   .0318227     6.58   0.000     .1456929    .2729596\n          a4 |   .2295212   .0329551     6.96   0.000     .1636235     .295419\n          a5 |   .1715058   .0348772     4.92   0.000     .1017645    .2412471\n          a6 |   .1898806   .0347216     5.47   0.000     .1204505    .2593108\n          a7 |   .1803588   .0370176     4.87   0.000     .1063376      .25438\n          b1 |   .4115021   .0823391     5.00   0.000      .246855    .5761493\n          b2 |   .0141524   .1005163     0.14   0.888    -.1868423    .2151472\n          b3 |   .0054683   .0515606     0.11   0.916    -.0976334      .10857\n          b4 |   .1979945   .1020843     1.94   0.057    -.0061357    .4021247\n          b5 |   .0294082     .02481     1.19   0.240    -.0202025    .0790188\n          b6 |   .0901756   .0435822     2.07   0.043     .0030275    .1773236\n          b7 |   .2159646   .0267321     8.08   0.000     .1625105    .2694187\n          c1 |   7.705805   .4974887    15.49   0.000     6.711015    8.700595\n------------------------------------------------------------------------------\n (SEs, P values, CIs, and correlations are asymptotic approximations)\n\n. \n. clear\n\n. \n. program drop _all\n\n. log close\n      name:  <unnamed>\n       log:  Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\truck_reg.log\n  log type:  text\n closed on:  18 Oct 2024, 17:38:02\n--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------\n\n. exit\n\nend of do-file\n```\n\n### My code\n\n#### car_reg.do\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(minpack.lm) # for nlsLM()\n\ncar_7990 <- feenstra_88$car_7990 %>%\n  filter(year < 86) %>%\n  mutate(yd = factor(year)) %>%\n  group_by(yd) %>%\n  mutate(id = row_number()) %>%\n  ungroup()\n\ncar_7990 %>%\n  group_by(yd) %>%\n  summarise(freq = n()) %>%\n  ungroup() %>%\n  mutate(\n    percent = freq / sum(freq) * 100,\n    cum = cumsum(percent)\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 7 × 4\n  yd     freq percent   cum\n  <fct> <int>   <dbl> <dbl>\n1 79       21    11.7  11.7\n2 80       24    13.4  25.1\n3 81       24    13.4  38.5\n4 82       24    13.4  52.0\n5 83       26    14.5  66.5\n6 84       29    16.2  82.7\n7 85       31    17.3 100  \n```\n\n\n:::\n\n```{.r .cell-code}\n# expand the yd variable to 0/1 columns\n# in R, you cannot multiply a factor/categorical variable\n\ncar_7990 <- car_7990 %>%\n  mutate(yd_ind = as.integer(yd)) %>%\n  mutate(yd_ind = as.factor(yd_ind - min(yd_ind) + 1))\n\ncar_7990_dummy <- model.matrix(~ yd_ind - 1, data = car_7990)\ncolnames(car_7990_dummy) <- gsub(\"_ind\", \"\", colnames(car_7990_dummy))\n\ncar_7990 <- car_7990 %>%\n  bind_cols(as.data.frame(car_7990_dummy))\n\n# fit the non-linear specification with initial values\n# nls() fails, so I use nlsLM() that implements the Levenberg-Marquardt\n# algorithm\n\ninitial_values <- list(\n  a3 = 1, a4 = 1, a5 = 1, a6 = 1, a7 = 1,\n  b2 = 0.1, b3 = 0.1, b4 = 0.1, b5 = 0.1, b6 = 0.1, b7 = 0.1,\n  c1 = 0.1, c2 = 0.1, c3 = 0.1, c4 = 0.1, c5 = 0.1, c6 = 0.1, c7 = 0.1,\n  c8 = 0.1\n)\n\nfit <- nlsLM(\n  price ~ a3 * yd3 + a4 * yd4 + a5 * yd5 + a6 * yd6 + a7 * yd7 +\n    exp(\n      b2 * yd2 + b3 * yd3 + b4 * yd4 + b5 * yd5 + b6 * yd6 + b7 * yd7 +\n        c1 * wght + c2 * wdth + c3 * hght + c4 * hp + c5 * tran + c6 * ps +\n        c7 * ac + c8\n    ),\n  data = car_7990,\n  start = initial_values\n)\n\nsummary(fit)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nFormula: price ~ a3 * yd3 + a4 * yd4 + a5 * yd5 + a6 * yd6 + a7 * yd7 + \n    exp(b2 * yd2 + b3 * yd3 + b4 * yd4 + b5 * yd5 + b6 * yd6 + \n        b7 * yd7 + c1 * wght + c2 * wdth + c3 * hght + c4 * hp + \n        c5 * tran + c6 * ps + c7 * ac + c8)\n\nParameters:\n     Estimate Std. Error t value Pr(>|t|)    \na3 -2.947e+02  7.233e+02  -0.407 0.684236    \na4 -3.049e+02  7.145e+02  -0.427 0.670137    \na5 -1.374e+02  7.008e+02  -0.196 0.844867    \na6  7.293e+01  6.954e+02   0.105 0.916608    \na7 -1.033e+02  7.429e+02  -0.139 0.889554    \nb2  9.967e-03  3.630e-02   0.275 0.783991    \nb3  1.523e-01  1.023e-01   1.489 0.138586    \nb4  1.899e-01  9.653e-02   1.968 0.050842 .  \nb5  1.541e-01  9.591e-02   1.607 0.110130    \nb6  1.730e-01  9.447e-02   1.831 0.068972 .  \nb7  2.274e-01  9.450e-02   2.407 0.017243 *  \nc1 -6.998e-04  1.022e-01  -0.007 0.994545    \nc2  3.682e-01  1.020e-01   3.610 0.000409 ***\nc3 -1.432e-01  5.194e-02  -2.756 0.006522 ** \nc4  6.070e-01  6.652e-02   9.126 2.93e-16 ***\nc5  1.316e-01  2.645e-02   4.975 1.67e-06 ***\nc6  5.158e-02  2.182e-02   2.364 0.019283 *  \nc7  1.635e-01  2.285e-02   7.157 2.81e-11 ***\nc8  6.730e+00  5.719e-01  11.768  < 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 724.1 on 160 degrees of freedom\n\nNumber of iterations to convergence: 19 \nAchieved convergence tolerance: 1.49e-08\n```\n\n\n:::\n\n```{.r .cell-code}\nfit_coef <- coef(fit)\n\ncar_7990 <- car_7990 %>%\n  mutate(\n    winv = 1 / exp(fit_coef[\"b2\"] * yd2 + fit_coef[\"b3\"] * yd3 +\n      fit_coef[\"b4\"] * yd4 + fit_coef[\"b5\"] * yd5 + fit_coef[\"b6\"] * yd6 +\n      fit_coef[\"b7\"] * yd7 + fit_coef[\"c1\"] * wght + fit_coef[\"c2\"] * wdth +\n      fit_coef[\"c3\"] * hght + fit_coef[\"c4\"] * hp + fit_coef[\"c5\"] * tran +\n      fit_coef[\"c6\"] * ps + fit_coef[\"c7\"] * ac + fit_coef[\"c8\"]),\n    nprice = price * winv,\n    nyd3 = yd3 * winv,\n    nyd4 = yd4 * winv,\n    nyd5 = yd5 * winv,\n    nyd6 = yd6 * winv,\n    nyd7 = yd7 * winv\n  )\n\nfit2 <- nlsLM(\n  nprice ~ a3 * nyd3 + a4 * nyd4 + a5 * nyd5 + a6 * nyd6 + a7 * nyd7 +\n    winv * exp(\n      b2 * yd2 + b3 * yd3 + b4 * yd4 + b5 * yd5 + b6 * yd6 + b7 * yd7 +\n        c1 * wght + c2 * wdth + c3 * hght + c4 * hp + c5 * tran + c6 * ps +\n        c7 * ac + c8\n    ),\n  data = car_7990,\n  start = initial_values,\n  # increase the number of iterations to avoid convergence issues\n  control = nls.lm.control(maxiter = 1000, maxfev = 10000)\n)\n\nsummary(fit2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nFormula: nprice ~ a3 * nyd3 + a4 * nyd4 + a5 * nyd5 + a6 * nyd6 + a7 * \n    nyd7 + winv * exp(b2 * yd2 + b3 * yd3 + b4 * yd4 + b5 * yd5 + \n    b6 * yd6 + b7 * yd7 + c1 * wght + c2 * wdth + c3 * hght + \n    c4 * hp + c5 * tran + c6 * ps + c7 * ac + c8)\n\nParameters:\n     Estimate Std. Error t value Pr(>|t|)    \na3  4.105e+02  6.192e+02   0.663  0.50834    \na4  3.789e+02  6.503e+02   0.583  0.56087    \na5  7.706e+02  6.012e+02   1.282  0.20176    \na6  6.244e+02  6.190e+02   1.009  0.31465    \na7 -1.229e+02  7.194e+02  -0.171  0.86455    \nb2  8.954e-03  3.099e-02   0.289  0.77303    \nb3  4.743e-02  1.094e-01   0.434  0.66515    \nb4  9.384e-02  1.083e-01   0.867  0.38740    \nb5  1.957e-02  1.053e-01   0.186  0.85274    \nb6  9.188e-02  1.020e-01   0.901  0.36887    \nb7  2.189e-01  1.013e-01   2.162  0.03211 *  \nc1  2.548e-02  1.208e-01   0.211  0.83316    \nc2  3.566e-01  1.083e-01   3.292  0.00123 ** \nc3 -6.306e-02  5.550e-02  -1.136  0.25748    \nc4  6.899e-01  8.522e-02   8.096 1.36e-13 ***\nc5  1.429e-01  2.448e-02   5.837 2.88e-08 ***\nc6  5.810e-02  2.728e-02   2.130  0.03474 *  \nc7  1.473e-01  3.303e-02   4.461 1.53e-05 ***\nc8  6.328e+00  5.831e-01  10.853  < 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.1022 on 160 degrees of freedom\n\nNumber of iterations to convergence: 18 \nAchieved convergence tolerance: 1.49e-08\n```\n\n\n:::\n:::\n\n\n\n\n\n#### truck_reg.do\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntruck_7990 <- feenstra_88$truck_7990 %>%\n  filter(year < 86) %>%\n  mutate(\n    lnprice = log(price),\n    yd = factor(year)\n  ) %>%\n  group_by(yd) %>%\n  mutate(id = row_number()) %>%\n  ungroup() %>%\n  rename(wght = weight)\n\ntruck_7990 %>%\n  group_by(yd) %>%\n  summarise(freq = n()) %>%\n  ungroup() %>%\n  mutate(\n    percent = freq / sum(freq) * 100,\n    cum = cumsum(percent)\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 7 × 4\n  yd     freq percent   cum\n  <fct> <int>   <dbl> <dbl>\n1 79       10    13.3  13.3\n2 80       10    13.3  26.7\n3 81       11    14.7  41.3\n4 82       11    14.7  56  \n5 83       10    13.3  69.3\n6 84       11    14.7  84  \n7 85       12    16   100  \n```\n\n\n:::\n\n```{.r .cell-code}\n# I will use b8 instead of c1 to avoid extra tidying later\ninitial_values <- list(\n  a2 = 1, a3 = 1, a4 = 1, a5 = 1, a6 = 1, a7 = 1,\n  b1 = 1, b2 = 1, b3 = 1, b4 = 1, b5 = 1, b6 = 1, b7 = 1, b8 = 1\n)\n\ntruck_7990 <- truck_7990 %>%\n  mutate(yd_ind = as.integer(yd)) %>%\n  mutate(yd_ind = as.factor(yd_ind - min(yd_ind) + 1))\n\ntruck_7990_dummy <- model.matrix(~ yd_ind - 1, data = truck_7990)\n\ncolnames(truck_7990_dummy) <- gsub(\"_ind\", \"\", colnames(truck_7990_dummy))\n\ntruck_7990 <- truck_7990 %>%\n  bind_cols(as.data.frame(truck_7990_dummy))\n\nfit3 <- nlsLM(\n  lnprice ~ exp(a2 * yd2 + a3 * yd3 + a4 * yd4 + a5 * yd5 + a6 * yd6 +\n    a7 * yd7 + b1 * wght + b2 * wdth + b3 * hght + b4 * hp + b5 * tran +\n    b6 * ps + b7 * four + b8),\n  data = truck_7990,\n  start = initial_values\n)\n\nsummary(fit3)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nFormula: lnprice ~ exp(a2 * yd2 + a3 * yd3 + a4 * yd4 + a5 * yd5 + a6 * \n    yd6 + a7 * yd7 + b1 * wght + b2 * wdth + b3 * hght + b4 * \n    hp + b5 * tran + b6 * ps + b7 * four + b8)\n\nParameters:\n    Estimate Std. Error t value Pr(>|t|)    \na2 0.0005705  0.0037259   0.153   0.8788    \na3 0.0240717  0.0036050   6.677 8.28e-09 ***\na4 0.0263975  0.0037132   7.109 1.50e-09 ***\na5 0.0199685  0.0039124   5.104 3.50e-06 ***\na6 0.0221336  0.0038661   5.725 3.37e-07 ***\na7 0.0207545  0.0041371   5.017 4.83e-06 ***\nb1 0.0444571  0.0087268   5.094 3.63e-06 ***\nb2 0.0030967  0.0112786   0.275   0.7846    \nb3 0.0004542  0.0056452   0.080   0.9361    \nb4 0.0235098  0.0114640   2.051   0.0446 *  \nb5 0.0035386  0.0027552   1.284   0.2039    \nb6 0.0097044  0.0046752   2.076   0.0421 *  \nb7 0.0246971  0.0029674   8.323 1.23e-11 ***\nb8 2.0445709  0.0557319  36.686  < 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.07091 on 61 degrees of freedom\n\nNumber of iterations to convergence: 23 \nAchieved convergence tolerance: 1.49e-08\n```\n\n\n:::\n\n```{.r .cell-code}\nfit_coef <- coef(fit3)\n\ntruck_7990 <- truck_7990 %>%\n  mutate(\n    winv = 1 / exp(fit_coef[\"a2\"] * yd2 + fit_coef[\"a3\"] * yd3 +\n      fit_coef[\"a4\"] * yd4 + fit_coef[\"a5\"] * yd5 + fit_coef[\"a6\"] * yd6 +\n      fit_coef[\"a7\"] * yd7 + fit_coef[\"b1\"] * wght + fit_coef[\"b2\"] * wdth +\n      fit_coef[\"b3\"] * hght + fit_coef[\"b4\"] * hp + fit_coef[\"b5\"] * tran +\n      fit_coef[\"b6\"] * ps + fit_coef[\"b7\"] * four + fit_coef[\"b8\"]),\n    nprice = price * winv\n  )\n\nfit4 <- nlsLM(\n  nprice ~ winv * exp(a2 * yd2 + a3 * yd3 + a4 * yd4 + a5 * yd5 + a6 * yd6 +\n    a7 * yd7 + b1 * wght + b2 * wdth + b3 * hght + b4 * hp + b5 * tran +\n    b6 * ps + b7 * four + b8),\n  data = truck_7990,\n  start = initial_values,\n  control = nls.lm.control(maxiter = 1000, maxfev = 10000)\n)\n\nsummary(fit4)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nFormula: nprice ~ winv * exp(a2 * yd2 + a3 * yd3 + a4 * yd4 + a5 * yd5 + \n    a6 * yd6 + a7 * yd7 + b1 * wght + b2 * wdth + b3 * hght + \n    b4 * hp + b5 * tran + b6 * ps + b7 * four + b8)\n\nParameters:\n   Estimate Std. Error t value Pr(>|t|)    \na2 -0.01752    0.04115  -0.426 0.671808    \na3  0.17842    0.03740   4.771 1.19e-05 ***\na4  0.20406    0.03782   5.396 1.18e-06 ***\na5  0.14882    0.03941   3.777 0.000363 ***\na6  0.18356    0.03874   4.738 1.33e-05 ***\na7  0.16232    0.04151   3.910 0.000234 ***\nb1  0.43760    0.05855   7.473 3.55e-10 ***\nb2  0.07716    0.11049   0.698 0.487617    \nb3 -0.04245    0.04740  -0.896 0.373973    \nb4  0.23968    0.10844   2.210 0.030841 *  \nb5  0.03410    0.02494   1.367 0.176684    \nb6  0.09343    0.03465   2.696 0.009053 ** \nb7  0.22790    0.02709   8.412 8.62e-12 ***\nb8  7.55794    0.53930  14.014  < 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 56.58 on 61 degrees of freedom\n\nNumber of iterations to convergence: 15 \nAchieved convergence tolerance: 1.49e-08\n```\n\n\n:::\n:::\n\n\n\n\n\n### Extra step: formatting the tables\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# function to avoid repeating the same code four times\nreshape_estimates <- function(fit, vehicle, term_prefix, term_mappings) {\n  tidy(fit) %>%\n    filter(term %in% paste0(term_prefix, 1:8)) %>%\n    mutate(\n      term = case_when(\n        term == paste0(term_prefix, \"1\") ~ term_mappings[1],\n        term == paste0(term_prefix, \"2\") ~ term_mappings[2],\n        term == paste0(term_prefix, \"3\") ~ term_mappings[3],\n        term == paste0(term_prefix, \"4\") ~ term_mappings[4],\n        term == paste0(term_prefix, \"5\") ~ term_mappings[5],\n        term == paste0(term_prefix, \"6\") ~ term_mappings[6],\n        term == paste0(term_prefix, \"7\") ~ term_mappings[7],\n        term == paste0(term_prefix, \"8\") ~ term_mappings[8]\n      )\n    ) %>%\n    select(term, estimate, std.error) %>%\n    pivot_longer(\n      cols = c(estimate, std.error), names_to = \"stat\",\n      values_to = \"value\"\n    ) %>%\n    mutate(\n      stat = if_else(stat == \"estimate\", \"Estimate\", \"Std. Error\"),\n      value = round(value, 3)\n    ) %>%\n    rename(!!sym(vehicle) := value)\n}\n\ncar_vars <- c(\n  \"Weight (tons)\", \"Width (feet)\", \"Height (feet)\", \"Horsepower (100)\",\n  \"Transmission (5-speed or auto)\", \"Power steering\", \"Air conditioning\", \"Constant\"\n)\n\ntruck_vars <- c(\n  \"Weight (tons)\", \"Width (feet)\", \"Height (feet)\", \"Horsepower (100)\",\n  \"Transmission (5-speed or auto)\", \"Power steering\", \"Four-wheel drive\", \"Constant\"\n)\n\nordered_vars <- unique(c(car_vars, truck_vars))\nordered_vars <- c(\"Constant\", ordered_vars[ordered_vars != \"Constant\"])\n\ntable_84_1 <- reshape_estimates(fit2, \"Car\", \"c\", car_vars) %>%\n  full_join(reshape_estimates(fit4, \"Truck\", \"b\", truck_vars)) %>%\n  # mutate term to factor + keep Constant at the beginning\n  mutate(\n    term = factor(term, levels = ordered_vars)\n  ) %>%\n  arrange(term)\n\ncolnames(table_84_1) <- c(\"Variable\", \"Statistic\", \"Car\", \"Truck\")\n\nkable(table_84_1)\n```\n\n::: {.cell-output-display}\n\n\n|Variable                       |Statistic  |    Car|  Truck|\n|:------------------------------|:----------|------:|------:|\n|Constant                       |Estimate   |  6.328|  7.558|\n|Constant                       |Std. Error |  0.583|  0.539|\n|Weight (tons)                  |Estimate   |  0.025|  0.438|\n|Weight (tons)                  |Std. Error |  0.121|  0.059|\n|Width (feet)                   |Estimate   |  0.357|  0.077|\n|Width (feet)                   |Std. Error |  0.108|  0.110|\n|Height (feet)                  |Estimate   | -0.063| -0.042|\n|Height (feet)                  |Std. Error |  0.055|  0.047|\n|Horsepower (100)               |Estimate   |  0.690|  0.240|\n|Horsepower (100)               |Std. Error |  0.085|  0.108|\n|Transmission (5-speed or auto) |Estimate   |  0.143|  0.034|\n|Transmission (5-speed or auto) |Std. Error |  0.024|  0.025|\n|Power steering                 |Estimate   |  0.058|  0.093|\n|Power steering                 |Std. Error |  0.027|  0.035|\n|Air conditioning               |Estimate   |  0.147|     NA|\n|Air conditioning               |Std. Error |  0.033|     NA|\n|Four-wheel drive               |Estimate   |     NA|  0.228|\n|Four-wheel drive               |Std. Error |     NA|  0.027|\n\n\n:::\n:::\n\n\n\n\n\n\n## Exercise 3\n\nPooling car and truck data, run `system_7985.do` to reproduce columns (3) and (4) in Table 8.4 with the constraints specified in equation (8.22). How are these constraints built into the program for the nonlinear regression?\n\n### Feenstra's code\n\n```stata\ncapture log close\nlog using Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\system_7985.log,replace\n\nuse Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\truck_7990,clear\ngen ve=2\nrename wdth wdth_t\nrename hght hght_t\nrename weight wght_t\nrename hp hp_t\nrename four four_t\nrename tran tran_t\nrename ps ps_t\nrename ac ac_t\ndrop if year>=86\n\nsave Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\truck_temp,replace\n\nuse Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\car_7990,clear\ndrop if year>=86\ngen ve=1\nrename wdth wdth_c\nrename hght hght_c\nrename wght wght_c\nrename hp hp_c\nrename four four_c\nrename tran tran_c\nrename ps ps_c\nrename ac ac_c\n\nappend using Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\truck_temp\n\nreplace wdth_c=0 if wdth_c==.\nreplace hght_c=0 if hght_c==.\nreplace wght_c=0 if wght_c==.\nreplace hp_c=0 if hp_c==.\nreplace four_c=0 if four_c==.\nreplace tran_c=0 if tran_c==.\nreplace ps_c=0 if ps_c==.\nreplace ac_c=0 if ac_c==.\nreplace wdth_t=0 if wdth_t==.\nreplace hght_t=0 if hght_t==.\nreplace wght_t=0 if wght_t==.\nreplace hp_t=0 if hp_t==.\nreplace four_t=0 if four_t==.\nreplace tran_t=0 if tran_t==.\nreplace ps_t=0 if ps_t==.\nreplace ac_t=0 if ac_t==.\n\ntab year, gen(yd)\n\ngen cyd2=yd2\ngen tyd2=yd2\nreplace cyd2=0 if type==\"JT\"\nreplace tyd2=0 if type~=\"JT\"\n\ngen cyd3=yd3\ngen tyd3=yd3\nreplace cyd3=0 if type==\"JT\"\nreplace tyd3=0 if type~=\"JT\"\n\ngen cyd4=yd4\ngen tyd4=yd4\nreplace cyd4=0 if type==\"JT\"\nreplace tyd4=0 if type~=\"JT\"\n\ngen cyd5=yd5\ngen tyd5=yd5\nreplace cyd5=0 if type==\"JT\"\nreplace tyd5=0 if type~=\"JT\"\n\ngen cyd6=yd6\ngen tyd6=yd6\nreplace cyd6=0 if type==\"JT\"\nreplace tyd6=0 if type~=\"JT\"\n\ngen cyd7=yd7\ngen tyd7=yd7\nreplace cyd7=0 if type==\"JT\"\nreplace tyd7=0 if type~=\"JT\"\n\nprogram define nlct_1\nversion 7.0\nif \"`1'\"==\"?\"{\nglobal S_1 \"a3 a4 a5 a6 a7 b2 b3 b4 b5 b6 b7 c1 c2 c3 c4 c5 c6 c7 c8 c9 d1 d2 d3 d4 d5 d6 d7 d8\"\nglobal a3=1\nglobal a4=1\nglobal a5=1\nglobal a6=1\nglobal a7=1\nglobal b2=.1\nglobal b3=.1\nglobal b4=.1\nglobal b5=.1\nglobal b6=.1\nglobal b7=.1\nglobal c1=.1\nglobal c2=.1\nglobal c3=.1\nglobal c4=.1\nglobal c5=.1\nglobal c6=.1\nglobal c7=.1\nglobal c8=.1\nglobal c9=.1\nglobal d1=.1\nglobal d2=.1\nglobal d3=.1\nglobal d4=.1\nglobal d5=.1\nglobal d6=.1\nglobal d7=.1\nglobal d8=.1\nexit\n}\n\nreplace `1'=$a3*cyd3+$a4*cyd4+$a5*cyd5+$a6*cyd6+$a7*cyd7/*\n*/+exp($b2*cyd2+$b3*cyd3+$b4*cyd4+$b5*cyd5+$b6*cyd6+$b7*cyd7/*\n*/+$c1*wght_c+$c2*wdth_c+$c3*hght_c+$c4*hp_c+$c5*tran_c+$c6*ps_c+$c7*ac_c/*\n*/+$c8)+exp($b2*tyd2+($b3+.16)*tyd3+($b4+.16)*tyd4+($b5+.16)*tyd5+($b6+.16)*tyd6+$c9*tyd7/*\n*/+$d1*wght_t+$d2*wdth_t+$d3*hght_t+$d4*hp_t+$d5*tran_t+$d6*ps_t+$d7*four_t+$d8)\n\nend\n\nnl ct_1 price\n\ngen winv=1/exp(_b[b2]*cyd2+_b[b3]*cyd3+_b[b4]*cyd4+_b[b5]*cyd5+_b[b6]*cyd6+_b[b7]*cyd7/*\n*/+_b[c1]*wght_c+_b[c2]*wdth_c+_b[c3]*hght_c+_b[c4]*hp_c+_b[c5]*tran_c+_b[c6]*ps_c/*\n*/+_b[c7]*ac_c+_b[c8])\n\nreplace winv=1/exp((_b[b2]+0.16)*tyd2+(_b[b3]+.16)*tyd3+(_b[b4]+.16)*tyd4/*\n*/+(_b[b5]+.16)*tyd5+(_b[b6]+.16)*tyd6+_b[c9]*tyd7/*\n*/+_b[d1]*wght_t+_b[d2]*wdth_t+_b[d3]*hght_t+_b[d4]*hp_t/*\n*/+_b[d5]*tran_t+_b[d6]*ps_t+_b[d7]*four_t+_b[d8]) if ve==2\n\ngen nprice=price*winv\n\n\nprogram define nlct_2\nversion 7.0\nif \"`1'\"==\"?\"{\nglobal S_1 \"a3 a4 a5 a6 a7 b2 b3 b4 b5 b6 b7 c1 c2 c3 c4 c5 c6 c7 c8 c9 d1 d2 d3 d4 d5 d6 d7 d8\"\nglobal a3=1\nglobal a4=1\nglobal a5=1\nglobal a6=1\nglobal a7=1\nglobal b2=.1\nglobal b3=.1\nglobal b4=.1\nglobal b5=.1\nglobal b6=.1\nglobal b7=.1\nglobal c1=.1\nglobal c2=.1\nglobal c3=.1\nglobal c4=.1\nglobal c5=.1\nglobal c6=.1\nglobal c7=.1\nglobal c8=.1\nglobal c9=.1\nglobal d1=.1\nglobal d2=.1\nglobal d3=.1\nglobal d4=.1\nglobal d5=.1\nglobal d6=.1\nglobal d7=.1\nglobal d8=.1\nexit\n}\nreplace `1'=winv*($a3*cyd3+$a4*cyd4+$a5*cyd5+$a6*cyd6+$a7*cyd7)/*\n*/+winv*exp($b2*cyd2+$b3*cyd3+$b4*cyd4+$b5*cyd5+$b6*cyd6+$b7*cyd7/*\n*/+$c1*wght_c+$c2*wdth_c+$c3*hght_c+$c4*hp_c+$c5*tran_c+$c6*ps_c+$c7*ac_c/*\n*/+$c8)+winv*exp($b2*tyd2+($b3+.16)*tyd3+($b4+.16)*tyd4+($b5+.16)*tyd5+($b6+.16)*tyd6+$c9*tyd7/*\n*/+$d1*wght_t+$d2*wdth_t+$d3*hght_t+$d4*hp_t+$d5*tran_t+$d6*ps_t+$d7*four_t+$d8)\n\nend\n\nnl ct_2 nprice\n\nprogram drop _all\nlog close\nexit\n```\n\nOutput:\n\n```stata\n. capture log close\n\n. log using Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapte\n> r-8\\system_7985.log,replace\n----------------------------------------------------------------------------------\n      name:  <unnamed>\n       log:  Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapt\n> er-8\\system_7985.log\n  log type:  text\n opened on:  19 Jun 2024, 21:59:23\n\n. \n. use Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\tr\n> uck_7990,clear\n\n. gen ve=2\n\n. rename wdth wdth_t\n\n. rename hght hght_t\n\n. rename weight wght_t\n\n. rename hp hp_t\n\n. rename four four_t\n\n. rename tran tran_t\n\n. rename ps ps_t\n\n. rename ac ac_t\n\n. drop if year>=86\n(45 observations deleted)\n\n. \n. save Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\t\n> ruck_temp,replace\nfile Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\tru\n> ck_temp.dta saved\n\n. \n. use Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\ca\n> r_7990,clear\n\n. drop if year>=86\n(105 observations deleted)\n\n. gen ve=1\n\n. rename wdth wdth_c\n\n. rename hght hght_c\n\n. rename wght wght_c\n\n. rename hp hp_c\n\n. rename four four_c\n\n. rename tran tran_c\n\n. rename ps ps_c\n\n. rename ac ac_c\n\n. \n. append using Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Cha\n> pter-8\\truck_temp\n\n. \n. replace wdth_c=0 if wdth_c==.\n(75 real changes made)\n\n. replace hght_c=0 if hght_c==.\n(75 real changes made)\n\n. replace wght_c=0 if wght_c==.\n(75 real changes made)\n\n. replace hp_c=0 if hp_c==.\n(75 real changes made)\n\n. replace four_c=0 if four_c==.\n(75 real changes made)\n\n. replace tran_c=0 if tran_c==.\n(75 real changes made)\n\n. replace ps_c=0 if ps_c==.\n(75 real changes made)\n\n. replace ac_c=0 if ac_c==.\n(75 real changes made)\n\n. replace wdth_t=0 if wdth_t==.\n(179 real changes made)\n\n. replace hght_t=0 if hght_t==.\n(179 real changes made)\n\n. replace wght_t=0 if wght_t==.\n(179 real changes made)\n\n. replace hp_t=0 if hp_t==.\n(179 real changes made)\n\n. replace four_t=0 if four_t==.\n(179 real changes made)\n\n. replace tran_t=0 if tran_t==.\n(179 real changes made)\n\n. replace ps_t=0 if ps_t==.\n(179 real changes made)\n\n. replace ac_t=0 if ac_t==.\n(179 real changes made)\n\n. \n. tab year, gen(yd)\n\n       year |      Freq.     Percent        Cum.\n------------+-----------------------------------\n         79 |         31       12.20       12.20\n         80 |         34       13.39       25.59\n         81 |         35       13.78       39.37\n         82 |         35       13.78       53.15\n         83 |         36       14.17       67.32\n         84 |         40       15.75       83.07\n         85 |         43       16.93      100.00\n------------+-----------------------------------\n      Total |        254      100.00\n\n. \n. gen cyd2=yd2\n\n. gen tyd2=yd2\n\n. replace cyd2=0 if type==\"JT\"\n(8 real changes made)\n\n. replace tyd2=0 if type~=\"JT\"\n(26 real changes made)\n\n. \n. gen cyd3=yd3\n\n. gen tyd3=yd3\n\n. replace cyd3=0 if type==\"JT\"\n(9 real changes made)\n\n. replace tyd3=0 if type~=\"JT\"\n(26 real changes made)\n\n. \n. gen cyd4=yd4\n\n. gen tyd4=yd4\n\n. replace cyd4=0 if type==\"JT\"\n(9 real changes made)\n\n. replace tyd4=0 if type~=\"JT\"\n(26 real changes made)\n\n. \n. gen cyd5=yd5\n\n. gen tyd5=yd5\n\n. replace cyd5=0 if type==\"JT\"\n(7 real changes made)\n\n. replace tyd5=0 if type~=\"JT\"\n(29 real changes made)\n\n. \n. gen cyd6=yd6\n\n. gen tyd6=yd6\n\n. replace cyd6=0 if type==\"JT\"\n(7 real changes made)\n\n. replace tyd6=0 if type~=\"JT\"\n(33 real changes made)\n\n. \n. gen cyd7=yd7\n\n. gen tyd7=yd7\n\n. replace cyd7=0 if type==\"JT\"\n(7 real changes made)\n\n. replace tyd7=0 if type~=\"JT\"\n(36 real changes made)\n\n. \n. program define nlct_1\n  1. version 7.0\n  2. if \"`1'\"==\"?\"{\n  3. global S_1 \"a3 a4 a5 a6 a7 b2 b3 b4 b5 b6 b7 c1 c2 c3 c4 c5 c6 c7 c8 c9 d1 d2\n>  d3 d4 d5 d6 d7 d8\"\n  4. global a3=1\n  5. global a4=1\n  6. global a5=1\n  7. global a6=1\n  8. global a7=1\n  9. global b2=.1\n 10. global b3=.1\n 11. global b4=.1\n 12. global b5=.1\n 13. global b6=.1\n 14. global b7=.1\n 15. global c1=.1\n 16. global c2=.1\n 17. global c3=.1\n 18. global c4=.1\n 19. global c5=.1\n 20. global c6=.1\n 21. global c7=.1\n 22. global c8=.1\n 23. global c9=.1\n 24. global d1=.1\n 25. global d2=.1\n 26. global d3=.1\n 27. global d4=.1\n 28. global d5=.1\n 29. global d6=.1\n 30. global d7=.1\n 31. global d8=.1\n 32. exit\n 33. }\n 34. \n. replace `1'=$a3*cyd3+$a4*cyd4+$a5*cyd5+$a6*cyd6+$a7*cyd7/*\n> */+exp($b2*cyd2+$b3*cyd3+$b4*cyd4+$b5*cyd5+$b6*cyd6+$b7*cyd7/*\n> */+$c1*wght_c+$c2*wdth_c+$c3*hght_c+$c4*hp_c+$c5*tran_c+$c6*ps_c+$c7*ac_c/*\n> */+$c8)+exp($b2*tyd2+($b3+.16)*tyd3+($b4+.16)*tyd4+($b5+.16)*tyd5+($b6+.16)*tyd6\n> +$c9*tyd7/*\n> */+$d1*wght_t+$d2*wdth_t+$d3*hght_t+$d4*hp_t+$d5*tran_t+$d6*ps_t+$d7*four_t+$d8)\n 35. \n. end\n\n. \n. nl ct_1 price\n(obs = 254)\n\nIteration 0:   residual SS =  1.51e+10\n...\nIteration 24:  residual SS =  1.01e+08\nIteration 25:  residual SS =  1.01e+08\n\n      Source |       SS       df       MS            Number of obs =       254\n-------------+------------------------------         F( 28,   226) =   1210.09\n       Model |  1.5069e+10    28   538194036         Prob > F      =    0.0000\n    Residual |   100515047   226  444756.844         R-squared     =    0.9934\n-------------+------------------------------         Adj R-squared =    0.9926\n       Total |  1.5170e+10   254  59724204.9         Root MSE      =  666.9009\n                                                     Res. dev.     =  3994.496\n(ct_1)\n------------------------------------------------------------------------------\n       price |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]\n-------------+----------------------------------------------------------------\n          a3 |   254.0918   317.1045     0.80   0.424    -370.7678    878.9513\n          a4 |   505.1058   325.6388     1.55   0.122    -136.5708    1146.782\n          a5 |   708.9466   317.3172     2.23   0.026       83.668    1334.225\n          a6 |   1082.054   322.4415     3.36   0.001     446.6773     1717.43\n          a7 |   1063.014   373.9703     2.84   0.005     326.0995    1799.929\n          b2 |   .0040633   .0329008     0.12   0.902    -.0607683    .0688948\n          b3 |   .0756038    .049061     1.54   0.125    -.0210716    .1722792\n          b4 |   .0828575   .0490467     1.69   0.093    -.0137897    .1795048\n          b5 |   .0327776    .050707     0.65   0.519    -.0671415    .1326967\n          b6 |   .0351224   .0514768     0.68   0.496    -.0663135    .1365582\n          b7 |   .0825554   .0557608     1.48   0.140    -.0273221    .1924329\n          c1 |   .0326037   .1117298     0.29   0.771    -.1875618    .2527691\n          c2 |    .385946   .1204171     3.21   0.002     .1486621    .6232299\n          c3 |  -.1929238   .0568197    -3.40   0.001     -.304888   -.0809596\n          c4 |    .715212   .0736084     9.72   0.000     .5701655    .8602585\n          c5 |   .1578585     .03381     4.67   0.000     .0912354    .2244816\n          c6 |   .0641097   .0247061     2.59   0.010     .0154259    .1127934\n          c7 |   .1829447   .0242773     7.54   0.000     .1351059    .2307836\n          c8 |   6.599831   .7305317     9.03   0.000     5.160306    8.039356\n          c9 |   .1171992   .0634238     1.85   0.066    -.0077785    .2421769\n          d1 |   .4917133   .0795807     6.18   0.000     .3348983    .6485283\n          d2 |   .2622177   .1757206     1.49   0.137    -.0840426    .6084779\n          d3 |  -.0451278   .0677055    -0.67   0.506    -.1785426     .088287\n          d4 |   .3030767   .1701249     1.78   0.076    -.0321571    .6383106\n          d5 |   .0397822   .0362731     1.10   0.274    -.0316947     .111259\n          d6 |   .0967659   .0501832     1.93   0.055    -.0021208    .1956526\n          d7 |   .3052359   .0715711     4.26   0.000     .1642038     .446268\n          d8 |   6.299805   .9622249     6.55   0.000     4.403726    8.195885\n------------------------------------------------------------------------------\n (SEs, P values, CIs, and correlations are asymptotic approximations)\n\n. \n. gen winv=1/exp(_b[b2]*cyd2+_b[b3]*cyd3+_b[b4]*cyd4+_b[b5]*cyd5+_b[b6]*cyd6+_b[b7\n> ]*cyd7/*\n> */+_b[c1]*wght_c+_b[c2]*wdth_c+_b[c3]*hght_c+_b[c4]*hp_c+_b[c5]*tran_c+_b[c6]*ps\n> _c/*\n> */+_b[c7]*ac_c+_b[c8])\n\n. \n. replace winv=1/exp((_b[b2]+0.16)*tyd2+(_b[b3]+.16)*tyd3+(_b[b4]+.16)*tyd4/*\n> */+(_b[b5]+.16)*tyd5+(_b[b6]+.16)*tyd6+_b[c9]*tyd7/*\n> */+_b[d1]*wght_t+_b[d2]*wdth_t+_b[d3]*hght_t+_b[d4]*hp_t/*\n> */+_b[d5]*tran_t+_b[d6]*ps_t+_b[d7]*four_t+_b[d8]) if ve==2\n(75 real changes made)\n\n. \n. gen nprice=price*winv\n\n. \n. \n. program define nlct_2\n  1. version 7.0\n  2. if \"`1'\"==\"?\"{\n  3. global S_1 \"a3 a4 a5 a6 a7 b2 b3 b4 b5 b6 b7 c1 c2 c3 c4 c5 c6 c7 c8 c9 d1 d2\n>  d3 d4 d5 d6 d7 d8\"\n  4. global a3=1\n  5. global a4=1\n  6. global a5=1\n  7. global a6=1\n  8. global a7=1\n  9. global b2=.1\n 10. global b3=.1\n 11. global b4=.1\n 12. global b5=.1\n 13. global b6=.1\n 14. global b7=.1\n 15. global c1=.1\n 16. global c2=.1\n 17. global c3=.1\n 18. global c4=.1\n 19. global c5=.1\n 20. global c6=.1\n 21. global c7=.1\n 22. global c8=.1\n 23. global c9=.1\n 24. global d1=.1\n 25. global d2=.1\n 26. global d3=.1\n 27. global d4=.1\n 28. global d5=.1\n 29. global d6=.1\n 30. global d7=.1\n 31. global d8=.1\n 32. exit\n 33. }\n 34. replace `1'=winv*($a3*cyd3+$a4*cyd4+$a5*cyd5+$a6*cyd6+$a7*cyd7)/*\n> */+winv*exp($b2*cyd2+$b3*cyd3+$b4*cyd4+$b5*cyd5+$b6*cyd6+$b7*cyd7/*\n> */+$c1*wght_c+$c2*wdth_c+$c3*hght_c+$c4*hp_c+$c5*tran_c+$c6*ps_c+$c7*ac_c/*\n> */+$c8)+winv*exp($b2*tyd2+($b3+.16)*tyd3+($b4+.16)*tyd4+($b5+.16)*tyd5+($b6+.16)\n> *tyd6+$c9*tyd7/*\n> */+$d1*wght_t+$d2*wdth_t+$d3*hght_t+$d4*hp_t+$d5*tran_t+$d6*ps_t+$d7*four_t+$d8)\n 35. \n. end\n\n. \n. nl ct_2 nprice\n(obs = 254)\n\nIteration 0:   residual SS =  353.5865\n...\nIteration 20:  residual SS =  2.957295\nIteration 21:  residual SS =  2.957295\n\n      Source |       SS       df       MS            Number of obs =       254\n-------------+------------------------------         F( 28,   226) =    958.75\n       Model |  351.277591    28  12.5456282         Prob > F      =    0.0000\n    Residual |  2.95729549   226  .013085378         R-squared     =    0.9917\n-------------+------------------------------         Adj R-squared =    0.9906\n       Total |  354.234886   254  1.39462554         Root MSE      =  .1143913\n                                                     Res. dev.     = -410.2562\n(ct_2)\n------------------------------------------------------------------------------\n      nprice |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]\n-------------+----------------------------------------------------------------\n          a3 |   367.9829    239.059     1.54   0.125    -103.0867    839.0525\n          a4 |    600.553   254.2261     2.36   0.019     99.59628     1101.51\n          a5 |   887.9399   243.5428     3.65   0.000     408.0348    1367.845\n          a6 |   1104.433   251.0245     4.40   0.000     609.7847     1599.08\n          a7 |   855.7993   366.2444     2.34   0.020     134.1088     1577.49\n          b2 |   .0130387   .0303131     0.43   0.668    -.0466937    .0727711\n          b3 |   .0674477   .0425176     1.59   0.114     -.016334    .1512294\n          b4 |   .0701234   .0441821     1.59   0.114    -.0169382     .157185\n          b5 |  -.0005627   .0470779    -0.01   0.990    -.0933305    .0922051\n          b6 |   .0179989   .0473905     0.38   0.704    -.0753848    .1113826\n          b7 |   .1007712   .0641587     1.57   0.118    -.0256545    .2271969\n          c1 |   .0492474   .1311096     0.38   0.708    -.2091061     .307601\n          c2 |   .3908689   .1383663     2.82   0.005     .1182159     .663522\n          c3 |  -.0618204   .0611492    -1.01   0.313    -.1823158     .058675\n          c4 |   .8103277   .1038045     7.81   0.000     .6057792    1.014876\n          c5 |   .1779391   .0355273     5.01   0.000     .1079319    .2479463\n          c6 |   .0693687   .0304968     2.27   0.024     .0092743     .129463\n          c7 |   .1567051   .0360384     4.35   0.000     .0856908    .2277193\n          c8 |   5.839036   .8621144     6.77   0.000     4.140226    7.537847\n          c9 |   .1059852   .0550545     1.93   0.055    -.0025007    .2144711\n          d1 |   .4759918   .1172145     4.06   0.000     .2450187    .7069649\n          d2 |   .2120021   .1419991     1.49   0.137    -.0678094    .4918136\n          d3 |  -.0270369    .074052    -0.37   0.715    -.1729575    .1188837\n          d4 |     .24435   .1516866     1.61   0.109    -.0545508    .5432508\n          d5 |   .0530065   .0356148     1.49   0.138     -.017173     .123186\n          d6 |   .0575178   .0639555     0.90   0.369    -.0685076    .1835431\n          d7 |   .2971909   .0566882     5.24   0.000      .185486    .4088959\n          d8 |   6.630805   .7652819     8.66   0.000     5.122804    8.138805\n------------------------------------------------------------------------------\n (SEs, P values, CIs, and correlations are asymptotic approximations)\n\n. \n. program drop _all\n\n. log close\n      name:  <unnamed>\n       log:  Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapt\n> er-8\\system_7985.log\n  log type:  text\n closed on:  19 Jun 2024, 21:59:28\n----------------------------------------------------------------------------------\n\n. exit\n\nend of do-file\n```\n\n### My code\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncar_7990 <- feenstra_88$car_7990 %>%\n  filter(year < 86) %>%\n  mutate(ve = 1) %>%\n  rename(\n    wdth_c = wdth, hght_c = hght, wght_c = wght, hp_c = hp, four_c = four,\n    tran_c = tran, ps_c = ps, ac_c = ac\n  )\n\ntruck_7990 <- feenstra_88$truck_7990 %>%\n  filter(year < 86) %>%\n  mutate(ve = 2) %>%\n  rename(\n    wdth_t = wdth, hght_t = hght, wght_t = weight, hp_t = hp, four_t = four,\n    tran_t = tran, ps_t = ps, ac_t = ac\n  )\n\ntruck_7990 <- truck_7990 %>%\n  bind_rows(car_7990) %>%\n  mutate(\n    wdth_c = ifelse(is.na(wdth_c), 0, wdth_c),\n    hght_c = ifelse(is.na(hght_c), 0, hght_c),\n    wght_c = ifelse(is.na(wght_c), 0, wght_c),\n    hp_c = ifelse(is.na(hp_c), 0, hp_c),\n    four_c = ifelse(is.na(four_c), 0, four_c),\n    tran_c = ifelse(is.na(tran_c), 0, tran_c),\n    ps_c = ifelse(is.na(ps_c), 0, ps_c),\n    ac_c = ifelse(is.na(ac_c), 0, ac_c),\n    wdth_t = ifelse(is.na(wdth_t), 0, wdth_t),\n    hght_t = ifelse(is.na(hght_t), 0, hght_t),\n    wght_t = ifelse(is.na(wght_t), 0, wght_t),\n    hp_t = ifelse(is.na(hp_t), 0, hp_t),\n    four_t = ifelse(is.na(four_t), 0, four_t),\n    tran_t = ifelse(is.na(tran_t), 0, tran_t),\n    ps_t = ifelse(is.na(ps_t), 0, ps_t),\n    ac_t = ifelse(is.na(ac_t), 0, ac_t)\n  )\n\ntruck_7990 %>%\n  group_by(year) %>%\n  summarise(freq = n()) %>%\n  ungroup() %>%\n  mutate(\n    percent = freq / sum(freq) * 100,\n    cum = cumsum(percent)\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 7 × 4\n   year  freq percent   cum\n  <dbl> <int>   <dbl> <dbl>\n1    79    31    12.2  12.2\n2    80    34    13.4  25.6\n3    81    35    13.8  39.4\n4    82    35    13.8  53.1\n5    83    36    14.2  67.3\n6    84    40    15.7  83.1\n7    85    43    16.9 100  \n```\n\n\n:::\n\n```{.r .cell-code}\n# expand the yd variable\n\ntruck_7990 <- truck_7990 %>%\n  mutate(yd = as.factor(year - min(year) + 1))\n\ntruck_7990_dummy <- model.matrix(~ yd - 1, data = truck_7990)\n\ntruck_7990 <- truck_7990 %>%\n  bind_cols(as.data.frame(truck_7990_dummy))\n\n# generate the cyd and tyd variables\n\ntruck_7990 <- truck_7990 %>%\n  mutate(\n    cyd2 = ifelse(type == \"JT\", 0, yd2),\n    cyd3 = ifelse(type == \"JT\", 0, yd3),\n    cyd4 = ifelse(type == \"JT\", 0, yd4),\n    cyd5 = ifelse(type == \"JT\", 0, yd5),\n    cyd6 = ifelse(type == \"JT\", 0, yd6),\n    cyd7 = ifelse(type == \"JT\", 0, yd7),\n    tyd2 = ifelse(type != \"JT\", 0, yd2),\n    tyd3 = ifelse(type != \"JT\", 0, yd3),\n    tyd4 = ifelse(type != \"JT\", 0, yd4),\n    tyd5 = ifelse(type != \"JT\", 0, yd5),\n    tyd6 = ifelse(type != \"JT\", 0, yd6),\n    tyd7 = ifelse(type != \"JT\", 0, yd7)\n  )\n\n# fit the models\n\ninitial_values <- list(\n  a3 = 1, a4 = 1, a5 = 1, a6 = 1, a7 = 1,\n  b2 = 0.1, b3 = 0.1, b4 = 0.1, b5 = 0.1, b6 = 0.1, b7 = 0.1,\n  c1 = 0.1, c2 = 0.1, c3 = 0.1, c4 = 0.1, c5 = 0.1, c6 = 0.1, c7 = 0.1,\n  c8 = 0.1, c9 = 0.1,\n  d1 = 0.1, d2 = 0.1, d3 = 0.1, d4 = 0.1, d5 = 0.1, d6 = 0.1, d7 = 0.1,\n  d8 = 0.1\n)\n\nfit <- nlsLM(\n  price ~ a3 * cyd3 + a4 * cyd4 + a5 * cyd5 + a6 * cyd6 + a7 * cyd7 +\n    exp(b2 * cyd2 + b3 * cyd3 + b4 * cyd4 + b5 * cyd5 + b6 * cyd6 + b7 * cyd7 +\n      c1 * wght_c + c2 * wdth_c + c3 * hght_c + c4 * hp_c + c5 * tran_c +\n      c6 * ps_c + c7 * ac_c + c8) +\n    exp(b2 * tyd2 + (b3 + 0.16) * tyd3 + (b4 + 0.16) * tyd4 +\n      (b5 + 0.16) * tyd5 + (b6 + 0.16) * tyd6 + c9 * tyd7 +\n      d1 * wght_t + d2 * wdth_t + d3 * hght_t + d4 * hp_t + d5 * tran_t +\n      d6 * ps_t + d7 * four_t + d8),\n  data = truck_7990,\n  start = initial_values\n)\n\nsummary(fit)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nFormula: price ~ a3 * cyd3 + a4 * cyd4 + a5 * cyd5 + a6 * cyd6 + a7 * \n    cyd7 + exp(b2 * cyd2 + b3 * cyd3 + b4 * cyd4 + b5 * cyd5 + \n    b6 * cyd6 + b7 * cyd7 + c1 * wght_c + c2 * wdth_c + c3 * \n    hght_c + c4 * hp_c + c5 * tran_c + c6 * ps_c + c7 * ac_c + \n    c8) + exp(b2 * tyd2 + (b3 + 0.16) * tyd3 + (b4 + 0.16) * \n    tyd4 + (b5 + 0.16) * tyd5 + (b6 + 0.16) * tyd6 + c9 * tyd7 + \n    d1 * wght_t + d2 * wdth_t + d3 * hght_t + d4 * hp_t + d5 * \n    tran_t + d6 * ps_t + d7 * four_t + d8)\n\nParameters:\n     Estimate Std. Error t value Pr(>|t|)    \na3  2.542e+02  3.171e+02   0.802 0.423598    \na4  5.052e+02  3.256e+02   1.552 0.122150    \na5  7.090e+02  3.173e+02   2.235 0.026415 *  \na6  1.082e+03  3.224e+02   3.356 0.000926 ***\na7  1.063e+03  3.739e+02   2.843 0.004876 ** \nb2  4.065e-03  3.290e-02   0.124 0.901779    \nb3  7.559e-02  4.906e-02   1.541 0.124732    \nb4  8.284e-02  4.904e-02   1.689 0.092555 .  \nb5  3.276e-02  5.070e-02   0.646 0.518840    \nb6  3.510e-02  5.147e-02   0.682 0.495934    \nb7  8.254e-02  5.576e-02   1.480 0.140197    \nc1  3.261e-02  1.117e-01   0.292 0.770715    \nc2  3.860e-01  1.204e-01   3.205 0.001545 ** \nc3 -1.929e-01  5.683e-02  -3.395 0.000811 ***\nc4  7.152e-01  7.362e-02   9.715  < 2e-16 ***\nc5  1.579e-01  3.382e-02   4.668 5.21e-06 ***\nc6  6.412e-02  2.471e-02   2.595 0.010082 *  \nc7  1.830e-01  2.428e-02   7.535 1.16e-12 ***\nc8  6.599e+00  7.307e-01   9.032  < 2e-16 ***\nc9  1.172e-01  6.342e-02   1.848 0.065932 .  \nd1  4.917e-01  7.958e-02   6.179 2.97e-09 ***\nd2  2.621e-01  1.757e-01   1.492 0.137107    \nd3 -4.513e-02  6.770e-02  -0.667 0.505752    \nd4  3.031e-01  1.701e-01   1.782 0.076158 .  \nd5  3.978e-02  3.627e-02   1.097 0.273899    \nd6  9.676e-02  5.018e-02   1.928 0.055072 .  \nd7  3.052e-01  7.156e-02   4.265 2.94e-05 ***\nd8  6.300e+00  9.620e-01   6.549 3.85e-10 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 666.9 on 226 degrees of freedom\n\nNumber of iterations to convergence: 30 \nAchieved convergence tolerance: 1.49e-08\n```\n\n\n:::\n\n```{.r .cell-code}\ntruck_7990 <- truck_7990 %>%\n  mutate(\n    winv = case_when(\n      ve == 1 ~ 1 / exp(coef(fit)[\"b2\"] * cyd2 + coef(fit)[\"b3\"] * cyd3 +\n        coef(fit)[\"b4\"] * cyd4 + coef(fit)[\"b5\"] * cyd5 +\n        coef(fit)[\"b6\"] * cyd6 + coef(fit)[\"b7\"] * cyd7 +\n        coef(fit)[\"c1\"] * wght_c + coef(fit)[\"c2\"] * wdth_c +\n        coef(fit)[\"c3\"] * hght_c + coef(fit)[\"c4\"] * hp_c +\n        coef(fit)[\"c5\"] * tran_c + coef(fit)[\"c6\"] * ps_c +\n        coef(fit)[\"c7\"] * ac_c + coef(fit)[\"c8\"]),\n      ve == 2 ~ 1 / exp((coef(fit)[\"b2\"] + 0.16) * tyd2 +\n        (coef(fit)[\"b3\"] + 0.16) * tyd3 + (coef(fit)[\"b4\"] + 0.16) * tyd4 +\n        (coef(fit)[\"b5\"] + 0.16) * tyd5 + (coef(fit)[\"b6\"] + 0.16) * tyd6 +\n        coef(fit)[\"c9\"] * tyd7 + coef(fit)[\"d1\"] * wght_t +\n        coef(fit)[\"d2\"] * wdth_t + coef(fit)[\"d3\"] * hght_t +\n        coef(fit)[\"d4\"] * hp_t + coef(fit)[\"d5\"] * tran_t +\n        coef(fit)[\"d6\"] * ps_t + coef(fit)[\"d7\"] * four_t +\n        coef(fit)[\"d8\"])\n    ),\n    nprice = price * winv\n  )\n\nfit2 <- nlsLM(\n  nprice ~ winv * (a3 * cyd3 + a4 * cyd4 + a5 * cyd5 + a6 * cyd6 + a7 * cyd7) +\n    winv * exp(b2 * cyd2 + b3 * cyd3 + b4 * cyd4 + b5 * cyd5 + b6 * cyd6 +\n      b7 * cyd7 + c1 * wght_c + c2 * wdth_c + c3 * hght_c + c4 * hp_c +\n      c5 * tran_c + c6 * ps_c + c7 * ac_c + c8) +\n    winv * exp(b2 * tyd2 + (b3 + 0.16) * tyd3 + (b4 + 0.16) * tyd4 +\n      (b5 + 0.16) * tyd5 + (b6 + 0.16) * tyd6 + c9 * tyd7 + d1 * wght_t +\n      d2 * wdth_t + d3 * hght_t + d4 * hp_t + d5 * tran_t + d6 * ps_t +\n      d7 * four_t + d8),\n  data = truck_7990,\n  start = initial_values\n)\n\nsummary(fit2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nFormula: nprice ~ winv * (a3 * cyd3 + a4 * cyd4 + a5 * cyd5 + a6 * cyd6 + \n    a7 * cyd7) + winv * exp(b2 * cyd2 + b3 * cyd3 + b4 * cyd4 + \n    b5 * cyd5 + b6 * cyd6 + b7 * cyd7 + c1 * wght_c + c2 * wdth_c + \n    c3 * hght_c + c4 * hp_c + c5 * tran_c + c6 * ps_c + c7 * \n    ac_c + c8) + winv * exp(b2 * tyd2 + (b3 + 0.16) * tyd3 + \n    (b4 + 0.16) * tyd4 + (b5 + 0.16) * tyd5 + (b6 + 0.16) * tyd6 + \n    c9 * tyd7 + d1 * wght_t + d2 * wdth_t + d3 * hght_t + d4 * \n    hp_t + d5 * tran_t + d6 * ps_t + d7 * four_t + d8)\n\nParameters:\n     Estimate Std. Error t value Pr(>|t|)    \na3  3.679e+02  2.391e+02   1.539 0.125219    \na4  6.005e+02  2.543e+02   2.362 0.019041 *  \na5  8.879e+02  2.436e+02   3.645 0.000332 ***\na6  1.104e+03  2.511e+02   4.399 1.68e-05 ***\na7  8.556e+02  3.663e+02   2.336 0.020379 *  \nb2  1.304e-02  3.031e-02   0.430 0.667488    \nb3  6.745e-02  4.252e-02   1.586 0.114086    \nb4  7.013e-02  4.419e-02   1.587 0.113886    \nb5 -5.484e-04  4.708e-02  -0.012 0.990718    \nb6  1.801e-02  4.740e-02   0.380 0.704268    \nb7  1.008e-01  6.416e-02   1.571 0.117554    \nc1  4.925e-02  1.311e-01   0.376 0.707523    \nc2  3.908e-01  1.383e-01   2.825 0.005153 ** \nc3 -6.182e-02  6.114e-02  -1.011 0.313088    \nc4  8.103e-01  1.038e-01   7.807 2.17e-13 ***\nc5  1.779e-01  3.552e-02   5.009 1.10e-06 ***\nc6  6.936e-02  3.049e-02   2.275 0.023864 *  \nc7  1.567e-01  3.604e-02   4.348 2.08e-05 ***\nc8  5.839e+00  8.619e-01   6.775 1.07e-10 ***\nc9  1.060e-01  5.506e-02   1.925 0.055494 .  \nd1  4.760e-01  1.172e-01   4.060 6.76e-05 ***\nd2  2.121e-01  1.420e-01   1.493 0.136773    \nd3 -2.704e-02  7.406e-02  -0.365 0.715380    \nd4  2.443e-01  1.517e-01   1.611 0.108659    \nd5  5.301e-02  3.562e-02   1.488 0.138112    \nd6  5.751e-02  6.396e-02   0.899 0.369534    \nd7  2.972e-01  5.670e-02   5.242 3.64e-07 ***\nd8  6.630e+00  7.655e-01   8.661 8.98e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.1144 on 226 degrees of freedom\n\nNumber of iterations to convergence: 31 \nAchieved convergence tolerance: 1.49e-08\n```\n\n\n:::\n:::\n\n\n\n\n\n### Extra step: formatting the tables\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntable_84_2 <- tidy(fit2) %>%\n  select(term, estimate, std.error) %>%\n  mutate(\n    vehicle = substr(term, 1, 1),\n    vehicle = case_when(\n      vehicle == \"c\" ~ \"car\",\n      vehicle == \"d\" ~ \"truck\",\n      TRUE ~ \"Exclude\"\n    )\n  ) %>%\n  filter(vehicle != \"Exclude\") %>%\n  mutate(\n    term = case_when(\n      term == \"c1\" | term == \"d1\" ~ \"Weight (tons)\",\n      term == \"c2\" | term == \"d2\" ~ \"Width (feet)\",\n      term == \"c3\" | term == \"d3\" ~ \"Height (feet)\",\n      term == \"c4\" | term == \"d4\" ~ \"Horsepower (100)\",\n      term == \"c5\" | term == \"d5\" ~ \"Transmission (5-speed or auto)\",\n      term == \"c6\" | term == \"d6\" ~ \"Power steering\",\n      term == \"c7\"                ~ \"Air conditioning\",\n      term == \"d7\"                ~ \"Four-wheel drive\",\n      term == \"c8\" | term == \"d8\" ~ \"Constant\",\n      TRUE ~ \"Exclude\"\n    )\n  ) %>%\n  filter(term != \"Exclude\") %>%\n  pivot_longer(cols = c(estimate, std.error), names_to = \"stat\") %>%\n  pivot_wider(names_from = \"vehicle\", values_from = \"value\") %>%\n  mutate_if(is.numeric, ~ round(., 3)) %>%\n  mutate(\n    term = factor(term, levels = c(\n      \"Constant\", \"Weight (tons)\", \"Width (feet)\", \"Height (feet)\",\n      \"Horsepower (100)\", \"Transmission (5-speed or auto)\", \"Power steering\",\n      \"Air conditioning\", \"Four-wheel drive\"\n    )),\n    stat = if_else(stat == \"estimate\", \"Estimate\", \"Std. Error\")\n  ) %>%\n  arrange(term)\n\ncolnames(table_84_2) <- c(\"Variable\", \"Statistic\", \"Car\", \"Truck\")\n\nkable(table_84_2)\n```\n\n::: {.cell-output-display}\n\n\n|Variable                       |Statistic  |    Car|  Truck|\n|:------------------------------|:----------|------:|------:|\n|Constant                       |Estimate   |  5.839|  6.630|\n|Constant                       |Std. Error |  0.862|  0.765|\n|Weight (tons)                  |Estimate   |  0.049|  0.476|\n|Weight (tons)                  |Std. Error |  0.131|  0.117|\n|Width (feet)                   |Estimate   |  0.391|  0.212|\n|Width (feet)                   |Std. Error |  0.138|  0.142|\n|Height (feet)                  |Estimate   | -0.062| -0.027|\n|Height (feet)                  |Std. Error |  0.061|  0.074|\n|Horsepower (100)               |Estimate   |  0.810|  0.244|\n|Horsepower (100)               |Std. Error |  0.104|  0.152|\n|Transmission (5-speed or auto) |Estimate   |  0.178|  0.053|\n|Transmission (5-speed or auto) |Std. Error |  0.036|  0.036|\n|Power steering                 |Estimate   |  0.069|  0.058|\n|Power steering                 |Std. Error |  0.030|  0.064|\n|Air conditioning               |Estimate   |  0.157|     NA|\n|Air conditioning               |Std. Error |  0.036|     NA|\n|Four-wheel drive               |Estimate   |     NA|  0.297|\n|Four-wheel drive               |Std. Error |     NA|  0.057|\n\n\n:::\n:::\n\n\n\n\n\n## Exercise 4\n\nRun the programs `unit_quality.do`, `qindex_c.do`, `qindex_t.do` to reproduce the quality indexes and unit-qualities for cars and trucks in Table 8.3. What formula is used for the quality of each model and the quality indexes, and how does this differ from the unit-quality?\n\n### Feenstra's code\n\n#### unit_quality.do\n\n```stata\ncapture log close\nlog using Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\unit_quality.log,replace\n\nuse Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\truck_7990,clear\ndrop if year>=86\ngen ve=2\nrename quan quan_t\nrename wdth wdth_t\nrename hght hght_t\nrename weight wght_t\nrename hp hp_t\nrename four four_t\nrename tran tran_t\nrename ps ps_t\nrename ac ac_t\n\nsave Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\truck_temp,replace\n\nuse Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\car_7990,clear\ndrop if year>=86\ngen ve=1\nrename quan quan_c\nrename wdth wdth_c\nrename hght hght_c\nrename wght wght_c\nrename hp hp_c\nrename four four_c\nrename tran tran_c\nrename ps ps_c\nrename ac ac_c\n\nappend using Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\truck_temp\n\nreplace wdth_c=0 if wdth_c==.\nreplace hght_c=0 if hght_c==.\nreplace wght_c=0 if wght_c==.\nreplace hp_c=0 if hp_c==.\nreplace four_c=0 if four_c==.\nreplace tran_c=0 if tran_c==.\nreplace ps_c=0 if ps_c==.\nreplace ac_c=0 if ac_c==.\nreplace wdth_t=0 if wdth_t==.\nreplace hght_t=0 if hght_t==.\nreplace wght_t=0 if wght_t==.\nreplace hp_t=0 if hp_t==.\nreplace four_t=0 if four_t==.\nreplace tran_t=0 if tran_t==.\nreplace ps_t=0 if ps_t==.\nreplace ac_t=0 if ac_t==.\n\ntab year, gen(yd)\n\ngen cyd2=yd2\ngen tyd2=yd2\nreplace cyd2=0 if type==\"JT\"\nreplace tyd2=0 if type~=\"JT\"\n\ngen cyd3=yd3\ngen tyd3=yd3\nreplace cyd3=0 if type==\"JT\"\nreplace tyd3=0 if type~=\"JT\"\n\ngen cyd4=yd4\ngen tyd4=yd4\nreplace cyd4=0 if type==\"JT\"\nreplace tyd4=0 if type~=\"JT\"\n\ngen cyd5=yd5\ngen tyd5=yd5\nreplace cyd5=0 if type==\"JT\"\nreplace tyd5=0 if type~=\"JT\"\n\ngen cyd6=yd6\ngen tyd6=yd6\nreplace cyd6=0 if type==\"JT\"\nreplace tyd6=0 if type~=\"JT\"\n\ngen cyd7=yd7\ngen tyd7=yd7\nreplace cyd7=0 if type==\"JT\"\nreplace tyd7=0 if type~=\"JT\"\n\nprogram define nlct_1\nversion 7.0\nif \"`1'\"==\"?\"{\nglobal S_1 \"a3 a4 a5 a6 a7 b2 b3 b4 b5 b6 b7 c1 c2 c3 c4 c5 c6 c7 c8 c9 d1 d2 d3 d4 d5 d6 d7 d8\"\nglobal a3=1\nglobal a4=1\nglobal a5=1\nglobal a6=1\nglobal a7=1\nglobal b2=.1\nglobal b3=.1\nglobal b4=.1\nglobal b5=.1\nglobal b6=.1\nglobal b7=.1\nglobal c1=.1\nglobal c2=.1\nglobal c3=.1\nglobal c4=.1\nglobal c5=.1\nglobal c6=.1\nglobal c7=.1\nglobal c8=.1\nglobal c9=.1\nglobal d1=.1\nglobal d2=.1\nglobal d3=.1\nglobal d4=.1\nglobal d5=.1\nglobal d6=.1\nglobal d7=.1\nglobal d8=.1\nexit\n}\n\nreplace `1'=$a3*cyd3+$a4*cyd4+$a5*cyd5+$a6*cyd6+$a7*cyd7/*\n*/+exp($b2*cyd2+$b3*cyd3+$b4*cyd4+$b5*cyd5+$b6*cyd6+$b7*cyd7/*\n*/+$c1*wght_c+$c2*wdth_c+$c3*hght_c+$c4*hp_c+$c5*tran_c+$c6*ps_c+$c7*ac_c/*\n*/+$c8)+exp($b2*tyd2+($b3+.16)*tyd3+($b4+.16)*tyd4+($b5+.16)*tyd5+($b6+.16)*tyd6+$c9*tyd7/*\n*/+$d1*wght_t+$d2*wdth_t+$d3*hght_t+$d4*hp_t+$d5*tran_t+$d6*ps_t+$d7*four_t+$d8)\n\nend\n\nnl ct_1 price\n\ngen winv=1/exp(_b[b2]*cyd2+_b[b3]*cyd3+_b[b4]*cyd4+_b[b5]*cyd5+_b[b6]*cyd6+_b[b7]*cyd7/*\n*/+_b[c1]*wght_c+_b[c2]*wdth_c+_b[c3]*hght_c+_b[c4]*hp_c+_b[c5]*tran_c+_b[c6]*ps_c/*\n*/+_b[c7]*ac_c+_b[c8])\n\nreplace winv=1/exp((_b[b2]+0.16)*tyd2+(_b[b3]+.16)*tyd3+(_b[b4]+.16)*tyd4/*\n*/+(_b[b5]+.16)*tyd5+(_b[b6]+.16)*tyd6+_b[c9]*tyd7/*\n*/+_b[d1]*wght_t+_b[d2]*wdth_t+_b[d3]*hght_t+_b[d4]*hp_t/*\n*/+_b[d5]*tran_t+_b[d6]*ps_t+_b[d7]*four_t+_b[d8]) if ve==2\n\ngen nprice=price*winv\n\n\nprogram define nlct_2\nversion 7.0\nif \"`1'\"==\"?\"{\nglobal S_1 \"a3 a4 a5 a6 a7 b2 b3 b4 b5 b6 b7 c1 c2 c3 c4 c5 c6 c7 c8 c9 d1 d2 d3 d4 d5 d6 d7 d8\"\nglobal a3=1\nglobal a4=1\nglobal a5=1\nglobal a6=1\nglobal a7=1\nglobal b2=.1\nglobal b3=.1\nglobal b4=.1\nglobal b5=.1\nglobal b6=.1\nglobal b7=.1\nglobal c1=.1\nglobal c2=.1\nglobal c3=.1\nglobal c4=.1\nglobal c5=.1\nglobal c6=.1\nglobal c7=.1\nglobal c8=.1\nglobal c9=.1\nglobal d1=.1\nglobal d2=.1\nglobal d3=.1\nglobal d4=.1\nglobal d5=.1\nglobal d6=.1\nglobal d7=.1\nglobal d8=.1\nexit\n}\nreplace `1'=winv*($a3*cyd3+$a4*cyd4+$a5*cyd5+$a6*cyd6+$a7*cyd7)/*\n*/+winv*exp($b2*cyd2+$b3*cyd3+$b4*cyd4+$b5*cyd5+$b6*cyd6+$b7*cyd7/*\n*/+$c1*wght_c+$c2*wdth_c+$c3*hght_c+$c4*hp_c+$c5*tran_c+$c6*ps_c+$c7*ac_c/*\n*/+$c8)+winv*exp($b2*tyd2+($b3+.16)*tyd3+($b4+.16)*tyd4+($b5+.16)*tyd5+($b6+.16)*tyd6+$c9*tyd7/*\n*/+$d1*wght_t+$d2*wdth_t+$d3*hght_t+$d4*hp_t+$d5*tran_t+$d6*ps_t+$d7*four_t+$d8)\n\nend\n\nnl ct_2 nprice\n\n\npreserve\nkeep if ve==1\n\ngen quality=exp(_b[c8]+_b[b2]+_b[c1]*wght_c+_b[c2]*wdth_c+_b[c3]*hght_c+_b[c4]*hp_c/*\n*/+_b[c5]*tran_c+_b[c6]*ps_c+_b[c7]*ac_c)\n\nsave Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\quality_c,replace\n\ngen nvalue=quality*quan_c\negen aquan=mean(quan_c), by(year)\negen anvalue=mean(nvalue),by(year)\ngen uquality=anvalue/aquan\ncollapse (mean)uquality, by(year)\nlist\nrestore\n\npreserve\nkeep if ve==2\n\ngen quality=exp(_b[d8]+_b[b2]+_b[d1]*wght_t+_b[d2]*wdth_t+_b[d3]*hght_t+_b[d4]*hp_t/*\n*/+_b[d5]*tran_t+_b[d6]*ps_t+_b[d7]*four_t)\n\nsave Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\quality_t,replace\n\ngen nvalue=quality*quan_t\negen aquan=mean(quan_t),by(year)\negen anvalue=mean(nvalue), by(year)\ngen uquality=anvalue/aquan\ncollapse (mean)uquality, by(year)\nlist\nrestore\n\nprogram drop _all\nlog close\nexit\n```\n\nOutput:\n\n```stata\n. capture log close\n\n. log using Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapte\n> r-8\\unit_quality.log,replace\n(note: file Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapte\n> r-8\\unit_quality.log not found)\n----------------------------------------------------------------------------------\n      name:  <unnamed>\n       log:  Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapt\n> er-8\\unit_quality.log\n  log type:  text\n opened on:  19 Jun 2024, 23:03:32\n\n. \n. use Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\tr\n> uck_7990,clear\n\n. drop if year>=86\n(45 observations deleted)\n\n. gen ve=2\n\n. rename quan quan_t\n\n. rename wdth wdth_t\n\n. rename hght hght_t\n\n. rename weight wght_t\n\n. rename hp hp_t\n\n. rename four four_t\n\n. rename tran tran_t\n\n. rename ps ps_t\n\n. rename ac ac_t\n\n. \n. save Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\t\n> ruck_temp,replace\nfile Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\tru\n> ck_temp.dta saved\n\n. \n. use Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\ca\n> r_7990,clear\n\n. drop if year>=86\n(105 observations deleted)\n\n. gen ve=1\n\n. rename quan quan_c\n\n. rename wdth wdth_c\n\n. rename hght hght_c\n\n. rename wght wght_c\n\n. rename hp hp_c\n\n. rename four four_c\n\n. rename tran tran_c\n\n. rename ps ps_c\n\n. rename ac ac_c\n\n. \n. append using Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Cha\n> pter-8\\truck_temp\n\n. \n. replace wdth_c=0 if wdth_c==.\n(75 real changes made)\n\n. replace hght_c=0 if hght_c==.\n(75 real changes made)\n\n. replace wght_c=0 if wght_c==.\n(75 real changes made)\n\n. replace hp_c=0 if hp_c==.\n(75 real changes made)\n\n. replace four_c=0 if four_c==.\n(75 real changes made)\n\n. replace tran_c=0 if tran_c==.\n(75 real changes made)\n\n. replace ps_c=0 if ps_c==.\n(75 real changes made)\n\n. replace ac_c=0 if ac_c==.\n(75 real changes made)\n\n. replace wdth_t=0 if wdth_t==.\n(179 real changes made)\n\n. replace hght_t=0 if hght_t==.\n(179 real changes made)\n\n. replace wght_t=0 if wght_t==.\n(179 real changes made)\n\n. replace hp_t=0 if hp_t==.\n(179 real changes made)\n\n. replace four_t=0 if four_t==.\n(179 real changes made)\n\n. replace tran_t=0 if tran_t==.\n(179 real changes made)\n\n. replace ps_t=0 if ps_t==.\n(179 real changes made)\n\n. replace ac_t=0 if ac_t==.\n(179 real changes made)\n\n. \n. tab year, gen(yd)\n\n       year |      Freq.     Percent        Cum.\n------------+-----------------------------------\n         79 |         31       12.20       12.20\n         80 |         34       13.39       25.59\n         81 |         35       13.78       39.37\n         82 |         35       13.78       53.15\n         83 |         36       14.17       67.32\n         84 |         40       15.75       83.07\n         85 |         43       16.93      100.00\n------------+-----------------------------------\n      Total |        254      100.00\n\n. \n. gen cyd2=yd2\n\n. gen tyd2=yd2\n\n. replace cyd2=0 if type==\"JT\"\n(8 real changes made)\n\n. replace tyd2=0 if type~=\"JT\"\n(26 real changes made)\n\n. \n. gen cyd3=yd3\n\n. gen tyd3=yd3\n\n. replace cyd3=0 if type==\"JT\"\n(9 real changes made)\n\n. replace tyd3=0 if type~=\"JT\"\n(26 real changes made)\n\n. \n. gen cyd4=yd4\n\n. gen tyd4=yd4\n\n. replace cyd4=0 if type==\"JT\"\n(9 real changes made)\n\n. replace tyd4=0 if type~=\"JT\"\n(26 real changes made)\n\n. \n. gen cyd5=yd5\n\n. gen tyd5=yd5\n\n. replace cyd5=0 if type==\"JT\"\n(7 real changes made)\n\n. replace tyd5=0 if type~=\"JT\"\n(29 real changes made)\n\n. \n. gen cyd6=yd6\n\n. gen tyd6=yd6\n\n. replace cyd6=0 if type==\"JT\"\n(7 real changes made)\n\n. replace tyd6=0 if type~=\"JT\"\n(33 real changes made)\n\n. \n. gen cyd7=yd7\n\n. gen tyd7=yd7\n\n. replace cyd7=0 if type==\"JT\"\n(7 real changes made)\n\n. replace tyd7=0 if type~=\"JT\"\n(36 real changes made)\n\n. \n. program define nlct_1\n  1. version 7.0\n  2. if \"`1'\"==\"?\"{\n  3. global S_1 \"a3 a4 a5 a6 a7 b2 b3 b4 b5 b6 b7 c1 c2 c3 c4 c5 c6 c7 c8 c9 d1 d2\n>  d3 d4 d5 d6 d7 d8\"\n  4. global a3=1\n  5. global a4=1\n  6. global a5=1\n  7. global a6=1\n  8. global a7=1\n  9. global b2=.1\n 10. global b3=.1\n 11. global b4=.1\n 12. global b5=.1\n 13. global b6=.1\n 14. global b7=.1\n 15. global c1=.1\n 16. global c2=.1\n 17. global c3=.1\n 18. global c4=.1\n 19. global c5=.1\n 20. global c6=.1\n 21. global c7=.1\n 22. global c8=.1\n 23. global c9=.1\n 24. global d1=.1\n 25. global d2=.1\n 26. global d3=.1\n 27. global d4=.1\n 28. global d5=.1\n 29. global d6=.1\n 30. global d7=.1\n 31. global d8=.1\n 32. exit\n 33. }\n 34. \n. replace `1'=$a3*cyd3+$a4*cyd4+$a5*cyd5+$a6*cyd6+$a7*cyd7/*\n> */+exp($b2*cyd2+$b3*cyd3+$b4*cyd4+$b5*cyd5+$b6*cyd6+$b7*cyd7/*\n> */+$c1*wght_c+$c2*wdth_c+$c3*hght_c+$c4*hp_c+$c5*tran_c+$c6*ps_c+$c7*ac_c/*\n> */+$c8)+exp($b2*tyd2+($b3+.16)*tyd3+($b4+.16)*tyd4+($b5+.16)*tyd5+($b6+.16)*tyd6\n> +$c9*tyd7/*\n> */+$d1*wght_t+$d2*wdth_t+$d3*hght_t+$d4*hp_t+$d5*tran_t+$d6*ps_t+$d7*four_t+$d8)\n 35. \n. end\n\n. \n. nl ct_1 price\n(obs = 254)\n\nIteration 0:   residual SS =  1.51e+10\n...\nIteration 24:  residual SS =  1.01e+08\nIteration 25:  residual SS =  1.01e+08\n\n      Source |       SS       df       MS            Number of obs =       254\n-------------+------------------------------         F( 28,   226) =   1210.09\n       Model |  1.5069e+10    28   538194036         Prob > F      =    0.0000\n    Residual |   100515047   226  444756.844         R-squared     =    0.9934\n-------------+------------------------------         Adj R-squared =    0.9926\n       Total |  1.5170e+10   254  59724204.9         Root MSE      =  666.9009\n                                                     Res. dev.     =  3994.496\n(ct_1)\n------------------------------------------------------------------------------\n       price |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]\n-------------+----------------------------------------------------------------\n          a3 |   254.0918   317.1045     0.80   0.424    -370.7678    878.9513\n          a4 |   505.1058   325.6388     1.55   0.122    -136.5708    1146.782\n          a5 |   708.9466   317.3172     2.23   0.026       83.668    1334.225\n          a6 |   1082.054   322.4415     3.36   0.001     446.6773     1717.43\n          a7 |   1063.014   373.9703     2.84   0.005     326.0995    1799.929\n          b2 |   .0040633   .0329008     0.12   0.902    -.0607683    .0688948\n          b3 |   .0756038    .049061     1.54   0.125    -.0210716    .1722792\n          b4 |   .0828575   .0490467     1.69   0.093    -.0137897    .1795048\n          b5 |   .0327776    .050707     0.65   0.519    -.0671415    .1326967\n          b6 |   .0351224   .0514768     0.68   0.496    -.0663135    .1365582\n          b7 |   .0825554   .0557608     1.48   0.140    -.0273221    .1924329\n          c1 |   .0326037   .1117298     0.29   0.771    -.1875618    .2527691\n          c2 |    .385946   .1204171     3.21   0.002     .1486621    .6232299\n          c3 |  -.1929238   .0568197    -3.40   0.001     -.304888   -.0809596\n          c4 |    .715212   .0736084     9.72   0.000     .5701655    .8602585\n          c5 |   .1578585     .03381     4.67   0.000     .0912354    .2244816\n          c6 |   .0641097   .0247061     2.59   0.010     .0154259    .1127934\n          c7 |   .1829447   .0242773     7.54   0.000     .1351059    .2307836\n          c8 |   6.599831   .7305317     9.03   0.000     5.160306    8.039356\n          c9 |   .1171992   .0634238     1.85   0.066    -.0077785    .2421769\n          d1 |   .4917133   .0795807     6.18   0.000     .3348983    .6485283\n          d2 |   .2622177   .1757206     1.49   0.137    -.0840426    .6084779\n          d3 |  -.0451278   .0677055    -0.67   0.506    -.1785426     .088287\n          d4 |   .3030767   .1701249     1.78   0.076    -.0321571    .6383106\n          d5 |   .0397822   .0362731     1.10   0.274    -.0316947     .111259\n          d6 |   .0967659   .0501832     1.93   0.055    -.0021208    .1956526\n          d7 |   .3052359   .0715711     4.26   0.000     .1642038     .446268\n          d8 |   6.299805   .9622249     6.55   0.000     4.403726    8.195885\n------------------------------------------------------------------------------\n (SEs, P values, CIs, and correlations are asymptotic approximations)\n\n. \n. gen winv=1/exp(_b[b2]*cyd2+_b[b3]*cyd3+_b[b4]*cyd4+_b[b5]*cyd5+_b[b6]*cyd6+_b[b7\n> ]*cyd7/*\n> */+_b[c1]*wght_c+_b[c2]*wdth_c+_b[c3]*hght_c+_b[c4]*hp_c+_b[c5]*tran_c+_b[c6]*ps\n> _c/*\n> */+_b[c7]*ac_c+_b[c8])\n\n. \n. replace winv=1/exp((_b[b2]+0.16)*tyd2+(_b[b3]+.16)*tyd3+(_b[b4]+.16)*tyd4/*\n> */+(_b[b5]+.16)*tyd5+(_b[b6]+.16)*tyd6+_b[c9]*tyd7/*\n> */+_b[d1]*wght_t+_b[d2]*wdth_t+_b[d3]*hght_t+_b[d4]*hp_t/*\n> */+_b[d5]*tran_t+_b[d6]*ps_t+_b[d7]*four_t+_b[d8]) if ve==2\n(75 real changes made)\n\n. \n. gen nprice=price*winv\n\n. \n. \n. program define nlct_2\n  1. version 7.0\n  2. if \"`1'\"==\"?\"{\n  3. global S_1 \"a3 a4 a5 a6 a7 b2 b3 b4 b5 b6 b7 c1 c2 c3 c4 c5 c6 c7 c8 c9 d1 d2\n>  d3 d4 d5 d6 d7 d8\"\n  4. global a3=1\n  5. global a4=1\n  6. global a5=1\n  7. global a6=1\n  8. global a7=1\n  9. global b2=.1\n 10. global b3=.1\n 11. global b4=.1\n 12. global b5=.1\n 13. global b6=.1\n 14. global b7=.1\n 15. global c1=.1\n 16. global c2=.1\n 17. global c3=.1\n 18. global c4=.1\n 19. global c5=.1\n 20. global c6=.1\n 21. global c7=.1\n 22. global c8=.1\n 23. global c9=.1\n 24. global d1=.1\n 25. global d2=.1\n 26. global d3=.1\n 27. global d4=.1\n 28. global d5=.1\n 29. global d6=.1\n 30. global d7=.1\n 31. global d8=.1\n 32. exit\n 33. }\n 34. replace `1'=winv*($a3*cyd3+$a4*cyd4+$a5*cyd5+$a6*cyd6+$a7*cyd7)/*\n> */+winv*exp($b2*cyd2+$b3*cyd3+$b4*cyd4+$b5*cyd5+$b6*cyd6+$b7*cyd7/*\n> */+$c1*wght_c+$c2*wdth_c+$c3*hght_c+$c4*hp_c+$c5*tran_c+$c6*ps_c+$c7*ac_c/*\n> */+$c8)+winv*exp($b2*tyd2+($b3+.16)*tyd3+($b4+.16)*tyd4+($b5+.16)*tyd5+($b6+.16)\n> *tyd6+$c9*tyd7/*\n> */+$d1*wght_t+$d2*wdth_t+$d3*hght_t+$d4*hp_t+$d5*tran_t+$d6*ps_t+$d7*four_t+$d8)\n 35. \n. end\n\n. \n. nl ct_2 nprice\n(obs = 254)\n\nIteration 0:   residual SS =  353.5865\n...\nIteration 20:  residual SS =  2.957295\nIteration 21:  residual SS =  2.957295\n\n      Source |       SS       df       MS            Number of obs =       254\n-------------+------------------------------         F( 28,   226) =    958.75\n       Model |  351.277591    28  12.5456282         Prob > F      =    0.0000\n    Residual |  2.95729549   226  .013085378         R-squared     =    0.9917\n-------------+------------------------------         Adj R-squared =    0.9906\n       Total |  354.234886   254  1.39462554         Root MSE      =  .1143913\n                                                     Res. dev.     = -410.2562\n(ct_2)\n------------------------------------------------------------------------------\n      nprice |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]\n-------------+----------------------------------------------------------------\n          a3 |   367.9829    239.059     1.54   0.125    -103.0867    839.0525\n          a4 |    600.553   254.2261     2.36   0.019     99.59628     1101.51\n          a5 |   887.9399   243.5428     3.65   0.000     408.0348    1367.845\n          a6 |   1104.433   251.0245     4.40   0.000     609.7847     1599.08\n          a7 |   855.7993   366.2444     2.34   0.020     134.1088     1577.49\n          b2 |   .0130387   .0303131     0.43   0.668    -.0466937    .0727711\n          b3 |   .0674477   .0425176     1.59   0.114     -.016334    .1512294\n          b4 |   .0701234   .0441821     1.59   0.114    -.0169382     .157185\n          b5 |  -.0005627   .0470779    -0.01   0.990    -.0933305    .0922051\n          b6 |   .0179989   .0473905     0.38   0.704    -.0753848    .1113826\n          b7 |   .1007712   .0641587     1.57   0.118    -.0256545    .2271969\n          c1 |   .0492474   .1311096     0.38   0.708    -.2091061     .307601\n          c2 |   .3908689   .1383663     2.82   0.005     .1182159     .663522\n          c3 |  -.0618204   .0611492    -1.01   0.313    -.1823158     .058675\n          c4 |   .8103277   .1038045     7.81   0.000     .6057792    1.014876\n          c5 |   .1779391   .0355273     5.01   0.000     .1079319    .2479463\n          c6 |   .0693687   .0304968     2.27   0.024     .0092743     .129463\n          c7 |   .1567051   .0360384     4.35   0.000     .0856908    .2277193\n          c8 |   5.839036   .8621144     6.77   0.000     4.140226    7.537847\n          c9 |   .1059852   .0550545     1.93   0.055    -.0025007    .2144711\n          d1 |   .4759918   .1172145     4.06   0.000     .2450187    .7069649\n          d2 |   .2120021   .1419991     1.49   0.137    -.0678094    .4918136\n          d3 |  -.0270369    .074052    -0.37   0.715    -.1729575    .1188837\n          d4 |     .24435   .1516866     1.61   0.109    -.0545508    .5432508\n          d5 |   .0530065   .0356148     1.49   0.138     -.017173     .123186\n          d6 |   .0575178   .0639555     0.90   0.369    -.0685076    .1835431\n          d7 |   .2971909   .0566882     5.24   0.000      .185486    .4088959\n          d8 |   6.630805   .7652819     8.66   0.000     5.122804    8.138805\n------------------------------------------------------------------------------\n (SEs, P values, CIs, and correlations are asymptotic approximations)\n\n. \n. \n. preserve\n\n. keep if ve==1\n(75 observations deleted)\n\n. \n. gen quality=exp(_b[c8]+_b[b2]+_b[c1]*wght_c+_b[c2]*wdth_c+_b[c3]*hght_c+_b[c4]*h\n> p_c/*\n> */+_b[c5]*tran_c+_b[c6]*ps_c+_b[c7]*ac_c)\n\n. \n. save Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\q\n> uality_c,replace\nfile Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\qua\n> lity_c.dta saved\n\n. \n. gen nvalue=quality*quan_c\n\n. egen aquan=mean(quan_c), by(year)\n\n. egen anvalue=mean(nvalue),by(year)\n\n. gen uquality=anvalue/aquan\n\n. collapse (mean)uquality, by(year)\n\n. list\n\n     +-----------------+\n     | year   uquality |\n     |-----------------|\n  1. |   79   4360.772 |\n  2. |   80   4472.789 |\n  3. |   81   4867.316 |\n  4. |   82   5252.845 |\n  5. |   83   5636.667 |\n     |-----------------|\n  6. |   84    5862.13 |\n  7. |   85   6130.052 |\n     +-----------------+\n\n. restore\n\n. \n. preserve\n\n. keep if ve==2\n(179 observations deleted)\n\n. \n. gen quality=exp(_b[d8]+_b[b2]+_b[d1]*wght_t+_b[d2]*wdth_t+_b[d3]*hght_t+_b[d4]*h\n> p_t/*\n> */+_b[d5]*tran_t+_b[d6]*ps_t+_b[d7]*four_t)\n\n. \n. save Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\q\n> uality_t,replace\nfile Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\qua\n> lity_t.dta saved\n\n. \n. gen nvalue=quality*quan_t\n\n. egen aquan=mean(quan_t),by(year)\n\n. egen anvalue=mean(nvalue), by(year)\n\n. gen uquality=anvalue/aquan\n\n. collapse (mean)uquality, by(year)\n\n. list\n\n     +-----------------+\n     | year   uquality |\n     |-----------------|\n  1. |   79   4626.836 |\n  2. |   80   4637.583 |\n  3. |   81   4791.255 |\n  4. |   82   4929.792 |\n  5. |   83   4997.103 |\n     |-----------------|\n  6. |   84   5009.971 |\n  7. |   85   5432.772 |\n     +-----------------+\n\n. restore\n\n. \n. program drop _all\n\n. log close\n      name:  <unnamed>\n       log:  Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapt\n> er-8\\unit_quality.log\n  log type:  text\n closed on:  19 Jun 2024, 23:03:38\n----------------------------------------------------------------------------------\n\n. exit\n\nend of do-file\n```\n\n#### qindex_c.do\n\n```stata\nclear\ncapture log close\nlog using Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\qindex_c.log,replace\n\nuse Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\quality_c,clear\nkeep year model type quality quan_c\nren quan_c quan\n\npreserve\nkeep if year==80\nkeep model type quality quan\nren quality quality_80\nren quan quan_80\nsort model\nsave Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\quality_80_c,replace\nrestore\n\nsort model\nmerge model using Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\quality_80_c\nkeep if _merge==3\ndrop _merge\n\nsort year model\negen value_80=sum(quality_80*quan_80), by(year)\negen value_cp=sum(quality*quan_80), by(year)\ngen lasp=value_cp/value_80\n\negen value_c=sum(quality*quan),by(year)\negen value_cq=sum(quality_80*quan), by(year)\ngen pasp=value_c/value_cq\n\ngen qindex=(lasp*pasp)^0.5\ncollapse (mean) qindex, by(year)\n\nlist\nlog close\n```\n\nOutput:\n\n```stata\n. clear\n\n. capture log close\n\n. log using Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapte\n> r-8\\qindex_c.log,replace\n(note: file Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapte\n> r-8\\qindex_c.log not found)\n----------------------------------------------------------------------------------\n      name:  <unnamed>\n       log:  Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapt\n> er-8\\qindex_c.log\n  log type:  text\n opened on:  19 Jun 2024, 23:06:51\n\n. \n. use Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\qu\n> ality_c,clear\n\n. keep year model type quality quan_c\n\n. ren quan_c quan\n\n. \n. preserve\n\n. keep if year==80\n(155 observations deleted)\n\n. keep model type quality quan\n\n. ren quality quality_80\n\n. ren quan quan_80\n\n. sort model\n\n. save Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\q\n> uality_80_c,replace\nfile Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\qua\n> lity_80_c.dta saved\n\n. restore\n\n. \n. sort model\n\n. merge model using Z:\\home\\pacha\\github\\advanced-international-trade\\first-editio\n> n\\Chapter-8\\quality_80_c\n(note: you are using old merge syntax; see [R] merge for new syntax)\nvariable model does not uniquely identify observations in the master data\n\n. keep if _merge==3\n(23 observations deleted)\n\n. drop _merge\n\n. \n. sort year model\n\n. egen value_80=sum(quality_80*quan_80), by(year)\n\n. egen value_cp=sum(quality*quan_80), by(year)\n\n. gen lasp=value_cp/value_80\n\n. \n. egen value_c=sum(quality*quan),by(year)\n\n. egen value_cq=sum(quality_80*quan), by(year)\n\n. gen pasp=value_c/value_cq\n\n. \n. gen qindex=(lasp*pasp)^0.5\n\n. collapse (mean) qindex, by(year)\n\n. \n. list\n\n     +-----------------+\n     | year     qindex |\n     |-----------------|\n  1. |   79    .986878 |\n  2. |   80          1 |\n  3. |   81   1.085813 |\n  4. |   82    1.15183 |\n  5. |   83   1.212675 |\n     |-----------------|\n  6. |   84   1.266379 |\n  7. |   85   1.305744 |\n     +-----------------+\n\n. log close\n      name:  <unnamed>\n       log:  Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapt\n> er-8\\qindex_c.log\n  log type:  text\n closed on:  19 Jun 2024, 23:06:53\n----------------------------------------------------------------------------------\n\n. \nend of do-file\n```\n\n#### qindex_t.do\n\n```stata\n. clear\n\n. capture log close\n\n. log using Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapte\n> r-8\\qindex_t.log,replace\n(note: file Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapte\n> r-8\\qindex_t.log not found)\n----------------------------------------------------------------------------------\n      name:  <unnamed>\n       log:  Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapt\n> er-8\\qindex_t.log\n  log type:  text\n opened on:  19 Jun 2024, 23:09:00\n\n. \n. use Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\qu\n> ality_t,clear\n\n. keep year model type quality quan_t\n\n. ren quan_t quan\n\n. \n. preserve\n\n. keep if year==80\n(65 observations deleted)\n\n. keep model type quality quan\n\n. ren quality quality_80\n\n. ren quan quan_80\n\n. sort model\n\n. save Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\q\n> uality_80_t,replace\nfile Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\qua\n> lity_80_t.dta saved\n\n. restore\n\n. \n. sort model\n\n. merge model using Z:\\home\\pacha\\github\\advanced-international-trade\\first-editio\n> n\\Chapter-8\\quality_80_t\n(note: you are using old merge syntax; see [R] merge for new syntax)\nvariable model does not uniquely identify observations in the master data\n\n. keep if _merge==3\n(14 observations deleted)\n\n. drop _merge\n\n. \n. sort year model\n\n. egen value_80=sum(quality_80*quan_80), by(year)\n\n. egen value_cp=sum(quality*quan_80), by(year)\n\n. gen lasp=value_cp/value_80\n\n. \n. egen value_c=sum(quality*quan),by(year)\n\n. egen value_cq=sum(quality_80*quan), by(year)\n\n. gen pasp=value_c/value_cq\n\n. \n. gen qindex=(lasp*pasp)^0.5\n\n. collapse (mean) qindex, by(year)\n\n. \n. list\n\n     +-----------------+\n     | year     qindex |\n     |-----------------|\n  1. |   79   .9956951 |\n  2. |   80          1 |\n  3. |   81   1.035043 |\n  4. |   82   1.058717 |\n  5. |   83   1.057227 |\n     |-----------------|\n  6. |   84   1.053449 |\n  7. |   85   1.160353 |\n     +-----------------+\n\n. log close\n      name:  <unnamed>\n       log:  Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapt\n> er-8\\qindex_t.log\n  log type:  text\n closed on:  19 Jun 2024, 23:09:01\n----------------------------------------------------------------------------------\n\n. \nend of do-file\n```\n\n### My code\n\n#### unit_quality.do\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntruck_7990 <- feenstra_88$truck_7990 %>%\n  filter(year < 86) %>%\n  mutate(ve = 2) %>%\n  rename(\n    quan_t = quan,\n    wdth_t = wdth,\n    hght_t = hght,\n    wght_t = weight,\n    hp_t = hp,\n    four_t = four,\n    tran_t = tran,\n    ps_t = ps,\n    ac_t = ac\n  )\n\ncar_7990 <- feenstra_88$car_7990 %>%\n  filter(year < 86) %>%\n  mutate(ve = 1) %>%\n  rename(\n    quan_c = quan,\n    wdth_c = wdth,\n    hght_c = hght,\n    wght_c = wght,\n    hp_c = hp,\n    four_c = four,\n    tran_c = tran,\n    ps_c = ps,\n    ac_c = ac\n  )\n\ntruck_7990 <- truck_7990 %>%\n  bind_rows(car_7990) %>%\n  mutate(\n    wdth_c = ifelse(is.na(wdth_c), 0, wdth_c),\n    hght_c = ifelse(is.na(hght_c), 0, hght_c),\n    wght_c = ifelse(is.na(wght_c), 0, wght_c),\n    hp_c = ifelse(is.na(hp_c), 0, hp_c),\n    four_c = ifelse(is.na(four_c), 0, four_c),\n    tran_c = ifelse(is.na(tran_c), 0, tran_c),\n    ps_c = ifelse(is.na(ps_c), 0, ps_c),\n    ac_c = ifelse(is.na(ac_c), 0, ac_c),\n    wdth_t = ifelse(is.na(wdth_t), 0, wdth_t),\n    hght_t = ifelse(is.na(hght_t), 0, hght_t),\n    wght_t = ifelse(is.na(wght_t), 0, wght_t),\n    hp_t = ifelse(is.na(hp_t), 0, hp_t),\n    four_t = ifelse(is.na(four_t), 0, four_t),\n    tran_t = ifelse(is.na(tran_t), 0, tran_t),\n    ps_t = ifelse(is.na(ps_t), 0, ps_t),\n    ac_t = ifelse(is.na(ac_t), 0, ac_t)\n  )\n\ntruck_7990 %>%\n  group_by(year) %>%\n  summarise(freq = n()) %>%\n  ungroup() %>%\n  mutate(\n    percent = freq / sum(freq) * 100,\n    cum = cumsum(percent)\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 7 × 4\n   year  freq percent   cum\n  <dbl> <int>   <dbl> <dbl>\n1    79    31    12.2  12.2\n2    80    34    13.4  25.6\n3    81    35    13.8  39.4\n4    82    35    13.8  53.1\n5    83    36    14.2  67.3\n6    84    40    15.7  83.1\n7    85    43    16.9 100  \n```\n\n\n:::\n\n```{.r .cell-code}\ntruck_7990 <- truck_7990 %>%\n  mutate(yd = as.factor(year - min(year) + 1))\n\ntruck_7990_dummy <- model.matrix(~ yd - 1, data = truck_7990)\n\ntruck_7990 <- truck_7990 %>%\n  bind_cols(as.data.frame(truck_7990_dummy))\n\ntruck_7990 <- truck_7990 %>%\n  mutate(\n    cyd2 = ifelse(type == \"JT\", 0, yd2),\n    cyd3 = ifelse(type == \"JT\", 0, yd3),\n    cyd4 = ifelse(type == \"JT\", 0, yd4),\n    cyd5 = ifelse(type == \"JT\", 0, yd5),\n    cyd6 = ifelse(type == \"JT\", 0, yd6),\n    cyd7 = ifelse(type == \"JT\", 0, yd7),\n    tyd2 = ifelse(type != \"JT\", 0, yd2),\n    tyd3 = ifelse(type != \"JT\", 0, yd3),\n    tyd4 = ifelse(type != \"JT\", 0, yd4),\n    tyd5 = ifelse(type != \"JT\", 0, yd5),\n    tyd6 = ifelse(type != \"JT\", 0, yd6),\n    tyd7 = ifelse(type != \"JT\", 0, yd7)\n  )\n\ninitial_values <- list(\n  a3 = 1, a4 = 1, a5 = 1, a6 = 1, a7 = 1,\n  b2 = 0.1, b3 = 0.1, b4 = 0.1, b5 = 0.1, b6 = 0.1, b7 = 0.1,\n  c1 = 0.1, c2 = 0.1, c3 = 0.1, c4 = 0.1, c5 = 0.1, c6 = 0.1, c7 = 0.1,\n  c8 = 0.1, c9 = 0.1,\n  d1 = 0.1, d2 = 0.1, d3 = 0.1, d4 = 0.1, d5 = 0.1, d6 = 0.1, d7 = 0.1,\n  d8 = 0.1\n)\n\nfit <- nlsLM(\n  price ~ a3 * cyd3 + a4 * cyd4 + a5 * cyd5 + a6 * cyd6 + a7 * cyd7 +\n    exp(b2 * cyd2 + b3 * cyd3 + b4 * cyd4 + b5 * cyd5 + b6 * cyd6 +\n      b7 * cyd7 + c1 * wght_c + c2 * wdth_c + c3 * hght_c + c4 * hp_c +\n      c5 * tran_c + c6 * ps_c + c7 * ac_c + c8) +\n    exp(b2 * tyd2 + (b3 + 0.16) * tyd3 + (b4 + 0.16) * tyd4 +\n      (b5 + 0.16) * tyd5 + (b6 + 0.16) * tyd6 + c9 * tyd7 + d1 * wght_t +\n      d2 * wdth_t + d3 * hght_t + d4 * hp_t + d5 * tran_t + d6 * ps_t +\n      d7 * four_t + d8),\n  data = truck_7990,\n  start = initial_values\n)\n\nsummary(fit)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nFormula: price ~ a3 * cyd3 + a4 * cyd4 + a5 * cyd5 + a6 * cyd6 + a7 * \n    cyd7 + exp(b2 * cyd2 + b3 * cyd3 + b4 * cyd4 + b5 * cyd5 + \n    b6 * cyd6 + b7 * cyd7 + c1 * wght_c + c2 * wdth_c + c3 * \n    hght_c + c4 * hp_c + c5 * tran_c + c6 * ps_c + c7 * ac_c + \n    c8) + exp(b2 * tyd2 + (b3 + 0.16) * tyd3 + (b4 + 0.16) * \n    tyd4 + (b5 + 0.16) * tyd5 + (b6 + 0.16) * tyd6 + c9 * tyd7 + \n    d1 * wght_t + d2 * wdth_t + d3 * hght_t + d4 * hp_t + d5 * \n    tran_t + d6 * ps_t + d7 * four_t + d8)\n\nParameters:\n     Estimate Std. Error t value Pr(>|t|)    \na3  2.542e+02  3.171e+02   0.802 0.423598    \na4  5.052e+02  3.256e+02   1.552 0.122150    \na5  7.090e+02  3.173e+02   2.235 0.026415 *  \na6  1.082e+03  3.224e+02   3.356 0.000926 ***\na7  1.063e+03  3.739e+02   2.843 0.004876 ** \nb2  4.065e-03  3.290e-02   0.124 0.901779    \nb3  7.559e-02  4.906e-02   1.541 0.124732    \nb4  8.284e-02  4.904e-02   1.689 0.092555 .  \nb5  3.276e-02  5.070e-02   0.646 0.518840    \nb6  3.510e-02  5.147e-02   0.682 0.495934    \nb7  8.254e-02  5.576e-02   1.480 0.140197    \nc1  3.261e-02  1.117e-01   0.292 0.770715    \nc2  3.860e-01  1.204e-01   3.205 0.001545 ** \nc3 -1.929e-01  5.683e-02  -3.395 0.000811 ***\nc4  7.152e-01  7.362e-02   9.715  < 2e-16 ***\nc5  1.579e-01  3.382e-02   4.668 5.21e-06 ***\nc6  6.412e-02  2.471e-02   2.595 0.010082 *  \nc7  1.830e-01  2.428e-02   7.535 1.16e-12 ***\nc8  6.599e+00  7.307e-01   9.032  < 2e-16 ***\nc9  1.172e-01  6.342e-02   1.848 0.065932 .  \nd1  4.917e-01  7.958e-02   6.179 2.97e-09 ***\nd2  2.621e-01  1.757e-01   1.492 0.137107    \nd3 -4.513e-02  6.770e-02  -0.667 0.505752    \nd4  3.031e-01  1.701e-01   1.782 0.076158 .  \nd5  3.978e-02  3.627e-02   1.097 0.273899    \nd6  9.676e-02  5.018e-02   1.928 0.055072 .  \nd7  3.052e-01  7.156e-02   4.265 2.94e-05 ***\nd8  6.300e+00  9.620e-01   6.549 3.85e-10 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 666.9 on 226 degrees of freedom\n\nNumber of iterations to convergence: 30 \nAchieved convergence tolerance: 1.49e-08\n```\n\n\n:::\n\n```{.r .cell-code}\nfit_coef <- coef(fit)\n\ntruck_7990 <- truck_7990 %>%\n  mutate(\n    winv = case_when(\n      ve == 1 ~ 1 / exp(fit_coef[\"b2\"] * cyd2 + fit_coef[\"b3\"] * cyd3 +\n        fit_coef[\"b4\"] * cyd4 + fit_coef[\"b5\"] * cyd5 +\n        fit_coef[\"b6\"] * cyd6 + fit_coef[\"b7\"] * cyd7 +\n        fit_coef[\"c1\"] * wght_c + fit_coef[\"c2\"] * wdth_c +\n        fit_coef[\"c3\"] * hght_c + fit_coef[\"c4\"] * hp_c +\n        fit_coef[\"c5\"] * tran_c + fit_coef[\"c6\"] * ps_c +\n        fit_coef[\"c7\"] * ac_c + fit_coef[\"c8\"]),\n      ve == 2 ~ 1 / exp((fit_coef[\"b2\"] + 0.16) * tyd2 +\n        (fit_coef[\"b3\"] + 0.16) * tyd3 + (fit_coef[\"b4\"] + 0.16) * tyd4 +\n        (fit_coef[\"b5\"] + 0.16) * tyd5 + (fit_coef[\"b6\"] + 0.16) * tyd6 +\n        fit_coef[\"c9\"] * tyd7 + fit_coef[\"d1\"] * wght_t +\n        fit_coef[\"d2\"] * wdth_t + fit_coef[\"d3\"] * hght_t +\n        fit_coef[\"d4\"] * hp_t + fit_coef[\"d5\"] * tran_t +\n        fit_coef[\"d6\"] * ps_t + fit_coef[\"d7\"] * four_t + fit_coef[\"d8\"])\n    ),\n    nprice = price * winv\n  )\n\nfit2 <- nlsLM(\n  nprice ~ winv * (a3 * cyd3 + a4 * cyd4 + a5 * cyd5 + a6 * cyd6 + a7 * cyd7) +\n    winv * exp(b2 * cyd2 + b3 * cyd3 + b4 * cyd4 + b5 * cyd5 + b6 * cyd6 +\n      b7 * cyd7 + c1 * wght_c + c2 * wdth_c + c3 * hght_c + c4 * hp_c +\n      c5 * tran_c + c6 * ps_c + c7 * ac_c + c8) +\n    winv * exp(b2 * tyd2 + (b3 + 0.16) * tyd3 + (b4 + 0.16) * tyd4 +\n      (b5 + 0.16) * tyd5 + (b6 + 0.16) * tyd6 + c9 * tyd7 + d1 * wght_t +\n      d2 * wdth_t + d3 * hght_t + d4 * hp_t + d5 * tran_t + d6 * ps_t +\n      d7 * four_t + d8),\n  data = truck_7990,\n  start = initial_values\n)\n\nsummary(fit2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nFormula: nprice ~ winv * (a3 * cyd3 + a4 * cyd4 + a5 * cyd5 + a6 * cyd6 + \n    a7 * cyd7) + winv * exp(b2 * cyd2 + b3 * cyd3 + b4 * cyd4 + \n    b5 * cyd5 + b6 * cyd6 + b7 * cyd7 + c1 * wght_c + c2 * wdth_c + \n    c3 * hght_c + c4 * hp_c + c5 * tran_c + c6 * ps_c + c7 * \n    ac_c + c8) + winv * exp(b2 * tyd2 + (b3 + 0.16) * tyd3 + \n    (b4 + 0.16) * tyd4 + (b5 + 0.16) * tyd5 + (b6 + 0.16) * tyd6 + \n    c9 * tyd7 + d1 * wght_t + d2 * wdth_t + d3 * hght_t + d4 * \n    hp_t + d5 * tran_t + d6 * ps_t + d7 * four_t + d8)\n\nParameters:\n     Estimate Std. Error t value Pr(>|t|)    \na3  3.679e+02  2.391e+02   1.539 0.125219    \na4  6.005e+02  2.543e+02   2.362 0.019041 *  \na5  8.879e+02  2.436e+02   3.645 0.000332 ***\na6  1.104e+03  2.511e+02   4.399 1.68e-05 ***\na7  8.556e+02  3.663e+02   2.336 0.020379 *  \nb2  1.304e-02  3.031e-02   0.430 0.667488    \nb3  6.745e-02  4.252e-02   1.586 0.114086    \nb4  7.013e-02  4.419e-02   1.587 0.113886    \nb5 -5.484e-04  4.708e-02  -0.012 0.990718    \nb6  1.801e-02  4.740e-02   0.380 0.704268    \nb7  1.008e-01  6.416e-02   1.571 0.117554    \nc1  4.925e-02  1.311e-01   0.376 0.707523    \nc2  3.908e-01  1.383e-01   2.825 0.005153 ** \nc3 -6.182e-02  6.114e-02  -1.011 0.313088    \nc4  8.103e-01  1.038e-01   7.807 2.17e-13 ***\nc5  1.779e-01  3.552e-02   5.009 1.10e-06 ***\nc6  6.936e-02  3.049e-02   2.275 0.023864 *  \nc7  1.567e-01  3.604e-02   4.348 2.08e-05 ***\nc8  5.839e+00  8.619e-01   6.775 1.07e-10 ***\nc9  1.060e-01  5.506e-02   1.925 0.055494 .  \nd1  4.760e-01  1.172e-01   4.060 6.76e-05 ***\nd2  2.121e-01  1.420e-01   1.493 0.136773    \nd3 -2.704e-02  7.406e-02  -0.365 0.715380    \nd4  2.443e-01  1.517e-01   1.611 0.108659    \nd5  5.301e-02  3.562e-02   1.488 0.138112    \nd6  5.751e-02  6.396e-02   0.899 0.369534    \nd7  2.972e-01  5.670e-02   5.242 3.64e-07 ***\nd8  6.630e+00  7.655e-01   8.661 8.98e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.1144 on 226 degrees of freedom\n\nNumber of iterations to convergence: 31 \nAchieved convergence tolerance: 1.49e-08\n```\n\n\n:::\n\n```{.r .cell-code}\nfit2_coef <- coef(fit2)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntruck_7990_2 <- truck_7990 %>%\n  filter(ve == 1) %>%\n  mutate(\n    quality = exp(fit2_coef[\"c8\"] + fit2_coef[\"b2\"] + fit2_coef[\"c1\"] * wght_c +\n      fit2_coef[\"c2\"] * wdth_c + fit2_coef[\"c3\"] * hght_c +\n      fit2_coef[\"c4\"] * hp_c + fit2_coef[\"c5\"] * tran_c +\n      fit2_coef[\"c6\"] * ps_c + fit2_coef[\"c7\"] * ac_c),\n    nvalue = quality * quan_c\n  )\n\ncar_uquality <- truck_7990_2 %>%\n  group_by(year) %>%\n  summarise(\n    aquan = mean(quan_c),\n    anvalue = mean(nvalue)\n  ) %>%\n  ungroup() %>%\n  mutate(uquality = anvalue / aquan) %>%\n  group_by(year) %>%\n  summarise(mean_uquality = mean(uquality))\n\ncar_uquality\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 7 × 2\n   year mean_uquality\n  <dbl>         <dbl>\n1    79         4361.\n2    80         4473.\n3    81         4868.\n4    82         5253.\n5    83         5637.\n6    84         5862.\n7    85         6130.\n```\n\n\n:::\n\n```{.r .cell-code}\ntruck_7990_3 <- truck_7990 %>%\n  filter(ve == 2) %>%\n  mutate(\n    quality = exp(fit2_coef[\"d8\"] + fit2_coef[\"b2\"] + fit2_coef[\"d1\"] * wght_t +\n      fit2_coef[\"d2\"] * wdth_t + fit2_coef[\"d3\"] * hght_t +\n      fit2_coef[\"d4\"] * hp_t + fit2_coef[\"d5\"] * tran_t +\n      fit2_coef[\"d6\"] * ps_t + fit2_coef[\"d7\"] * four_t),\n    nvalue = quality * quan_t\n  )\n\ntruck_uquality <- truck_7990_3 %>%\n  group_by(year) %>%\n  summarise(\n    aquan = mean(quan_t),\n    anvalue = mean(nvalue)\n  ) %>%\n  ungroup() %>%\n  mutate(uquality = anvalue / aquan) %>%\n  group_by(year) %>%\n  summarise(mean_uquality = mean(uquality))\n\ntruck_uquality\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 7 × 2\n   year mean_uquality\n  <dbl>         <dbl>\n1    79         4627.\n2    80         4637.\n3    81         4791.\n4    82         4930.\n5    83         4997.\n6    84         5010.\n7    85         5433.\n```\n\n\n:::\n:::\n\n\n\n\n\n#### qindex_c.do\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncar_7990_2_80 <- truck_7990_2 %>%\n  filter(year == 80) %>%\n  select(model, type, quality, quan_c) %>%\n  rename(\n    quality_80 = quality,\n    quan_80 = quan_c\n  )\n\ncar_qindex <- truck_7990_2 %>%\n  select(year, model, type, quality, quan_c) %>%\n  inner_join(car_7990_2_80, by = c(\"model\", \"type\")) %>%\n  group_by(year, model) %>%\n  mutate(\n    value_80 = sum(quality_80 * quan_80),\n    value_cp = sum(quality * quan_80),\n    lasp = value_cp / value_80\n  ) %>%\n  group_by(year) %>%\n  mutate(\n    value_c = sum(quality * quan_c),\n    value_cq = sum(quality_80 * quan_c),\n    pasp = value_c / value_cq,\n    qindex = sqrt(lasp * pasp)\n  ) %>%\n  summarise(mean_qindex = mean(qindex))\n\ncar_qindex\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 7 × 2\n   year mean_qindex\n  <dbl>       <dbl>\n1    79       0.985\n2    80       1    \n3    81       1.09 \n4    82       1.14 \n5    83       1.20 \n6    84       1.26 \n7    85       1.33 \n```\n\n\n:::\n:::\n\n\n\n\n\n#### qindex_t.do\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntruck_7990_3_80 <- truck_7990_3 %>%\n  filter(year == 80) %>%\n  select(model, type, quality, quan_t) %>%\n  rename(\n    quality_80 = quality,\n    quan_80 = quan_t\n  )\n\ntruck_qindex <- truck_7990_3 %>%\n  select(year, model, type, quality, quan_t) %>%\n  inner_join(truck_7990_3_80, by = c(\"model\", \"type\")) %>%\n  group_by(year, model) %>%\n  mutate(\n    value_80 = sum(quality_80 * quan_80),\n    value_tp = sum(quality * quan_80),\n    lasp = value_tp / value_80\n  ) %>%\n  group_by(year) %>%\n  mutate(\n    value_t = sum(quality * quan_t),\n    value_tq = sum(quality_80 * quan_t),\n    pasp = value_t / value_tq,\n    qindex = sqrt(lasp * pasp)\n  ) %>%\n  summarise(mean_qindex = mean(qindex))\n\ntruck_qindex\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 7 × 2\n   year mean_qindex\n  <dbl>       <dbl>\n1    79       0.983\n2    80       1    \n3    81       1.03 \n4    82       1.06 \n5    83       1.05 \n6    84       1.07 \n7    85       1.17 \n```\n\n\n:::\n:::\n\n\n\n\n\n### Extra step: formatting the tables\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# function to avoid code quadruplication\nreshape_qindex <- function(data, mean_qindex_col, group, measurement) {\n  data %>%\n    rename(mean_qindex = !!mean_qindex_col) %>%\n    mutate(\n      qindex_pct = (mean_qindex - lag(mean_qindex)) / mean_qindex\n    ) %>%\n    pivot_longer(\n      cols = c(mean_qindex, qindex_pct),\n      names_to = \"metric\",\n      values_to = \"value\"\n    ) %>%\n    pivot_wider(names_from = year, values_from = value) %>%\n    mutate(type = group) %>%\n    mutate(metric = c(measurement, paste(measurement, \"(% Change)\"))) %>%\n    select(type, metric, everything()) %>%\n    mutate_if(is.numeric, ~ round(., 3))\n}\n\ntable83 <- reshape_qindex(car_uquality, \"mean_uquality\", \"Japanese Cars\", \"Unit quality\") %>%\n  bind_rows(\n    reshape_qindex(car_qindex, \"mean_qindex\", \"Japanese Cars\", \"Quality index\")\n  ) %>%\n  bind_rows(\n    reshape_qindex(truck_uquality, \"mean_uquality\", \"Japanese Trucks\", \"Unit quality\")\n  ) %>%\n  bind_rows(\n    reshape_qindex(truck_qindex, \"mean_qindex\", \"Japanese Trucks\", \"Quality index\")\n  )\n\ncolnames(table83) <- c(\"Type\", \"Metric\", paste0(\"19\", 79:85))\n\nkable(table83)\n```\n\n::: {.cell-output-display}\n\n\n|Type            |Metric                   |     1979|     1980|     1981|     1982|     1983|     1984|     1985|\n|:---------------|:------------------------|--------:|--------:|--------:|--------:|--------:|--------:|--------:|\n|Japanese Cars   |Unit quality             | 4361.162| 4473.178| 4867.702| 5253.221| 5637.037| 5862.490| 6130.408|\n|Japanese Cars   |Unit quality (% Change)  |       NA|    0.025|    0.081|    0.073|    0.068|    0.038|    0.044|\n|Japanese Cars   |Quality index            |    0.985|    1.000|    1.085|    1.144|    1.204|    1.263|    1.328|\n|Japanese Cars   |Quality index (% Change) |       NA|    0.015|    0.079|    0.052|    0.049|    0.047|    0.049|\n|Japanese Trucks |Unit quality             | 4626.649| 4637.404| 4791.084| 4929.624| 4996.917| 5009.782| 5432.585|\n|Japanese Trucks |Unit quality (% Change)  |       NA|    0.002|    0.032|    0.028|    0.013|    0.003|    0.078|\n|Japanese Trucks |Quality index            |    0.983|    1.000|    1.032|    1.056|    1.054|    1.068|    1.167|\n|Japanese Trucks |Quality index (% Change) |       NA|    0.017|    0.031|    0.023|   -0.002|    0.013|    0.085|\n\n\n:::\n:::\n\n\n\n\n\n## Exercise 5\n\nPooling car and truck data, run `system_nocom.do` and `system_wcon.do` to reproduce columns (1) – (4) in Table 8.5, with constraints specified in equation (8.22).\n\n### Feenstra's code\n\n#### system_nocom.do\n\nIn the original code:\n\n```stata\ngen cyd10=yd10\ngen tyd10=yd10\nreplace cyd7=10 if type==\"JT\"\nreplace tyd7=10 if type~=\"JT\"\n\ngen cyd11=yd11\ngen tyd11=yd11\nreplace cyd7=11 if type==\"JT\"\nreplace tyd7=11 if type~=\"JT\"\n\ngen cyd12=yd12\ngen tyd12=yd12\nreplace cyd7=12 if type==\"JT\"\nreplace tyd7=12 if type~=\"JT\"\n```\n\nCan be simplified to:\n\n```stata\ngen cyd10=yd10\ngen tyd10=yd10\n\ngen cyd11=yd11\ngen tyd11=yd11\n\ngen cyd12=yd12\ngen tyd12=yd12\n\nreplace cyd7=12 if type==\"JT\"\nreplace tyd7=12 if type~=\"JT\"\n```\n\nThe original code is:\n\n```stata\ncapture log close\nlog using Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\system_nocon.log,replace\n\nset matsize 400\n\nuse Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\truck_7990,clear\ngen ve=2\nrename wdth wdth_t\nrename hght hght_t\nrename weight wght_t\nrename hp hp_t\nrename four four_t\nrename tran tran_t\nrename ps ps_t\nrename ac ac_t\n\nsave Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\truck_temp,replace\n\nuse Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\car_7990,clear\ngen ve=1\nrename wdth wdth_c\nrename hght hght_c\nrename wght wght_c\nrename hp hp_c\nrename four four_c\nrename tran tran_c\nrename ps ps_c\nrename ac ac_c\n\nappend using Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\truck_temp\n\nreplace wdth_c=0 if wdth_c==.\nreplace hght_c=0 if hght_c==.\nreplace wght_c=0 if wght_c==.\nreplace hp_c=0 if hp_c==.\nreplace four_c=0 if four_c==.\nreplace tran_c=0 if tran_c==.\nreplace ps_c=0 if ps_c==.\nreplace ac_c=0 if ac_c==.\nreplace wdth_t=0 if wdth_t==.\nreplace hght_t=0 if hght_t==.\nreplace wght_t=0 if wght_t==.\nreplace hp_t=0 if hp_t==.\nreplace four_t=0 if four_t==.\nreplace tran_t=0 if tran_t==.\nreplace ps_t=0 if ps_t==.\nreplace ac_t=0 if ac_t==.\n\ntab year, gen(yd)\n\ngen cyd2=yd2\ngen tyd2=yd2\nreplace cyd2=0 if type==\"JT\"\nreplace tyd2=0 if type~=\"JT\"\n\ngen cyd3=yd3\ngen tyd3=yd3\nreplace cyd3=0 if type==\"JT\"\nreplace tyd3=0 if type~=\"JT\"\n\ngen cyd4=yd4\ngen tyd4=yd4\nreplace cyd4=0 if type==\"JT\"\nreplace tyd4=0 if type~=\"JT\"\n\ngen cyd5=yd5\ngen tyd5=yd5\nreplace cyd5=0 if type==\"JT\"\nreplace tyd5=0 if type~=\"JT\"\n\ngen cyd6=yd6\ngen tyd6=yd6\nreplace cyd6=0 if type==\"JT\"\nreplace tyd6=0 if type~=\"JT\"\n\ngen cyd7=yd7\ngen tyd7=yd7\nreplace cyd7=0 if type==\"JT\"\nreplace tyd7=0 if type~=\"JT\"\n\ngen cyd8=yd8\ngen tyd8=yd8\nreplace cyd8=0 if type==\"JT\"\nreplace tyd8=0 if type~=\"JT\"\n\ngen cyd9=yd9\ngen tyd9=yd9\nreplace cyd9=0 if type==\"JT\"\nreplace tyd9=0 if type~=\"JT\"\n\ngen cyd10=yd10\ngen tyd10=yd10\nreplace cyd7=10 if type==\"JT\"\nreplace tyd7=10 if type~=\"JT\"\n\ngen cyd11=yd11\ngen tyd11=yd11\nreplace cyd7=11 if type==\"JT\"\nreplace tyd7=11 if type~=\"JT\"\n\ngen cyd12=yd12\ngen tyd12=yd12\nreplace cyd7=12 if type==\"JT\"\nreplace tyd7=12 if type~=\"JT\"\n\nprogram define nlct_1\nversion 7.0\nif \"`1'\"==\"?\"{\nglobal S_1 \"a3 a4 a5 a6 a7 a8 a9 a10 a11 a12 b2 b3 b4 b5 b6 b7 b8 b9 b10 b11 b12 c1 c2 c3 c4 c5 c6 c7 c8 d1 d2 d3 d4 d5 d6 d7 d8 e2 e3 e4 e5 e6 e7 e8 e9 e10 e11 e12\"\nglobal a3=1\nglobal a4=1\nglobal a5=1\nglobal a6=1\nglobal a7=1\nglobal a8=1\nglobal a9=1\nglobal a10=1\nglobal a11=1\nglobal a12=1\nglobal b2=.1\nglobal b3=.1\nglobal b4=.1\nglobal b5=.1\nglobal b6=.1\nglobal b7=.1\nglobal b8=.1\nglobal b9=.1\nglobal b10=.1\nglobal b11=.1\nglobal b12=.1\nglobal c1=.1\nglobal c2=.1\nglobal c3=.1\nglobal c4=.1\nglobal c5=.1\nglobal c6=.1\nglobal c7=.1\nglobal c8=.1\nglobal d1=.1\nglobal d2=.1\nglobal d3=.1\nglobal d4=.1\nglobal d5=.1\nglobal d6=.1\nglobal d7=.1\nglobal d8=.1\nglobal e2=.1\nglobal e3=.1\nglobal e4=.1\nglobal e5=.1\nglobal e6=.1\nglobal e7=.1\nglobal e8=.1\nglobal e9=.1\nglobal e10=.1\nglobal e11=.1\nglobal e12=.1\nexit\n}\n\nreplace `1'=$a3*cyd3+$a4*cyd4+$a5*cyd5+$a6*cyd6+$a7*cyd7/*\n*/+$a8*cyd8+$a9*cyd9+$a10*cyd10+$a11*cyd11+$a12*cyd12/*\n*/+exp($b2*cyd2+$b3*cyd3+$b4*cyd4+$b5*cyd5+$b6*cyd6+$b7*cyd7/*\n*/+$b8*cyd8+$b9*cyd9+$b10*cyd10+$b11*cyd11+$b12*cyd12/*\n*/+$c1*wght_c+$c2*wdth_c+$c3*hght_c+$c4*hp_c+$c5*tran_c+$c6*ps_c+$c7*ac_c/*\n*/+$c8)+exp($e2*tyd2+$e3*tyd3+$e4*tyd4+$e5*tyd5+$e6*tyd6+$e7*tyd7/*\n*/+$e8*tyd8+$e9*tyd9+$e10*tyd10+$e11*tyd11+$e12*tyd12/*\n*/+$d1*wght_t+$d2*wdth_t+$d3*hght_t+$d4*hp_t+$d5*tran_t+$d6*ps_t+$d7*four_t+$d8)\n\nend\n\nnl ct_1 price\n\ngen winv=1/exp(_b[b2]*cyd2+_b[b3]*cyd3+_b[b4]*cyd4+_b[b5]*cyd5+_b[b6]*cyd6+_b[b7]*cyd7/*\n*/+_b[b8]*cyd8+_b[b9]*cyd9+_b[b10]*cyd10+_b[b11]*cyd11+_b[b12]*cyd12/*\n*/+_b[c1]*wght_c+_b[c2]*wdth_c+_b[c3]*hght_c+_b[c4]*hp_c+_b[c5]*tran_c+_b[c6]*ps_c/*\n*/+_b[c7]*ac_c+_b[c8])\n\nreplace winv=1/exp(_b[e2]*tyd2+_b[e3]*tyd3+_b[e4]*tyd4+_b[e5]*tyd5+_b[e6]*tyd6/*\n*/+_b[e7]*tyd7+_b[e8]*tyd8+_b[e9]*tyd9+_b[e10]*tyd10+_b[e11]*tyd11+_b[e12]*tyd12/*\n*/+_b[d1]*wght_t+_b[d2]*wdth_t+_b[d3]*hght_t+_b[d4]*hp_t/*\n*/+_b[d5]*tran_t+_b[d6]*ps_t+_b[d7]*four_t+_b[d8]) if ve==2\n\ngen nprice=price*winv\n\n\nprogram define nlct_2\nversion 7.0\nif \"`1'\"==\"?\"{\nglobal S_1 \"a3 a4 a5 a6 a7 a8 a9 a10 a11 a12 b2 b3 b4 b5 b6 b7 b8 b9 b10 b11 b12 c1 c2 c3 c4 c5 c6 c7 c8 d1 d2 d3 d4 d5 d6 d7 d8 e2 e3 e4 e5 e6 e7 e8 e9 e10 e11 e12\"\nglobal a3=1\nglobal a4=1\nglobal a5=1\nglobal a6=1\nglobal a7=1\nglobal a8=1\nglobal a9=1\nglobal a10=1\nglobal a11=1\nglobal a12=1\nglobal b2=.1\nglobal b3=.1\nglobal b4=.1\nglobal b5=.1\nglobal b6=.1\nglobal b7=.1\nglobal b8=.1\nglobal b9=.1\nglobal b10=.1\nglobal b11=.1\nglobal b12=.1\nglobal c1=.1\nglobal c2=.1\nglobal c3=.1\nglobal c4=.1\nglobal c5=.1\nglobal c6=.1\nglobal c7=.1\nglobal c8=.1\nglobal d1=.1\nglobal d2=.1\nglobal d3=.1\nglobal d4=.1\nglobal d5=.1\nglobal d6=.1\nglobal d7=.1\nglobal d8=.1\nglobal e2=.1\nglobal e3=.1\nglobal e4=.1\nglobal e5=.1\nglobal e6=.1\nglobal e7=.1\nglobal e8=.1\nglobal e9=.1\nglobal e10=.1\nglobal e11=.1\nglobal e12=.1\nexit\n}\n\nreplace `1'=winv*($a3*cyd3+$a4*cyd4+$a5*cyd5+$a6*cyd6+$a7*cyd7/*\n*/+$a8*cyd8+$a9*cyd9+$a10*cyd10+$a11*cyd11+$a12*cyd12)/*\n*/+winv*exp($b2*cyd2+$b3*cyd3+$b4*cyd4+$b5*cyd5+$b6*cyd6+$b7*cyd7/*\n*/+$b8*cyd8+$b9*cyd9+$b10*cyd10+$b11*cyd11+$b12*cyd12/*\n*/+$c1*wght_c+$c2*wdth_c+$c3*hght_c+$c4*hp_c+$c5*tran_c+$c6*ps_c+$c7*ac_c/*\n*/+$c8)+winv*exp($e2*tyd2+$e3*tyd3+$e4*tyd4+$e5*tyd5+$e6*tyd6+$e7*tyd7/*\n*/+$e8*tyd8+$e9*tyd9+$e10*tyd10+$e11*tyd11+$e12*tyd12/*\n*/+$d1*wght_t+$d2*wdth_t+$d3*hght_t+$d4*hp_t+$d5*tran_t+$d6*ps_t+$d7*four_t+$d8)\n\nend\n\nnl ct_2 nprice\n\nprogram drop _all\nlog close\nexit\n```\n\nOutput:\n\n```stata\n\n. capture log close\n\n. log using Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapte\n> r-8\\system_nocon.log,replace\n----------------------------------------------------------------------------------\n      name:  <unnamed>\n       log:  Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapt\n> er-8\\system_nocon.log\n  log type:  text\n opened on:   6 Jul 2024, 23:01:56\n\n. \n. set matsize 400\n\nCurrent memory allocation\n\n                    current                                 memory usage\n    settable          value     description                 (1M = 1024k)\n    --------------------------------------------------------------------\n    set maxvar         5000     max. variables allowed           1.909M\n    set memory           50M    max. data space                 50.000M\n    set matsize         400     max. RHS vars in models          1.254M\n                                                            -----------\n                                                                53.163M\n\n. \n. use Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\tr\n> uck_7990,clear\n\n. gen ve=2\n\n. rename wdth wdth_t\n\n. rename hght hght_t\n\n. rename weight wght_t\n\n. rename hp hp_t\n\n. rename four four_t\n\n. rename tran tran_t\n\n. rename ps ps_t\n\n. rename ac ac_t\n\n. \n. save Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\t\n> ruck_temp,replace\nfile Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\tru\n> ck_temp.dta saved\n\n. \n. use Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-8\\ca\n> r_7990,clear\n\n. gen ve=1\n\n. rename wdth wdth_c\n\n. rename hght hght_c\n\n. rename wght wght_c\n\n. rename hp hp_c\n\n. rename four four_c\n\n. rename tran tran_c\n\n. rename ps ps_c\n\n. rename ac ac_c\n\n. \n. append using Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Cha\n> pter-8\\truck_temp\n\n. \n. replace wdth_c=0 if wdth_c==.\n(120 real changes made)\n\n. replace hght_c=0 if hght_c==.\n(120 real changes made)\n\n. replace wght_c=0 if wght_c==.\n(120 real changes made)\n\n. replace hp_c=0 if hp_c==.\n(120 real changes made)\n\n. replace four_c=0 if four_c==.\n(120 real changes made)\n\n. replace tran_c=0 if tran_c==.\n(120 real changes made)\n\n. replace ps_c=0 if ps_c==.\n(120 real changes made)\n\n. replace ac_c=0 if ac_c==.\n(120 real changes made)\n\n. replace wdth_t=0 if wdth_t==.\n(284 real changes made)\n\n. replace hght_t=0 if hght_t==.\n(284 real changes made)\n\n. replace wght_t=0 if wght_t==.\n(284 real changes made)\n\n. replace hp_t=0 if hp_t==.\n(284 real changes made)\n\n. replace four_t=0 if four_t==.\n(284 real changes made)\n\n. replace tran_t=0 if tran_t==.\n(284 real changes made)\n\n. replace ps_t=0 if ps_t==.\n(284 real changes made)\n\n. replace ac_t=0 if ac_t==.\n(284 real changes made)\n\n. \n. tab year, gen(yd)\n\n       year |      Freq.     Percent        Cum.\n------------+-----------------------------------\n         79 |         31        7.67        7.67\n         80 |         34        8.42       16.09\n         81 |         35        8.66       24.75\n         82 |         35        8.66       33.42\n         83 |         36        8.91       42.33\n         84 |         40        9.90       52.23\n         85 |         43       10.64       62.87\n         86 |         33        8.17       71.04\n         87 |         35        8.66       79.70\n         88 |         30        7.43       87.13\n         89 |         26        6.44       93.56\n         90 |         26        6.44      100.00\n------------+-----------------------------------\n      Total |        404      100.00\n\n. \n. gen cyd2=yd2\n\n. gen tyd2=yd2\n\n. replace cyd2=0 if type==\"JT\"\n(8 real changes made)\n\n. replace tyd2=0 if type~=\"JT\"\n(26 real changes made)\n\n. \n. gen cyd3=yd3\n\n. gen tyd3=yd3\n\n. replace cyd3=0 if type==\"JT\"\n(9 real changes made)\n\n. replace tyd3=0 if type~=\"JT\"\n(26 real changes made)\n\n. \n. gen cyd4=yd4\n\n. gen tyd4=yd4\n\n. replace cyd4=0 if type==\"JT\"\n(9 real changes made)\n\n. replace tyd4=0 if type~=\"JT\"\n(26 real changes made)\n\n. \n. gen cyd5=yd5\n\n. gen tyd5=yd5\n\n. replace cyd5=0 if type==\"JT\"\n(7 real changes made)\n\n. replace tyd5=0 if type~=\"JT\"\n(29 real changes made)\n\n. \n. gen cyd6=yd6\n\n. gen tyd6=yd6\n\n. replace cyd6=0 if type==\"JT\"\n(7 real changes made)\n\n. replace tyd6=0 if type~=\"JT\"\n(33 real changes made)\n\n. \n. gen cyd7=yd7\n\n. gen tyd7=yd7\n\n. replace cyd7=0 if type==\"JT\"\n(7 real changes made)\n\n. replace tyd7=0 if type~=\"JT\"\n(36 real changes made)\n\n. \n. gen cyd8=yd8\n\n. gen tyd8=yd8\n\n. replace cyd8=0 if type==\"JT\"\n(7 real changes made)\n\n. replace tyd8=0 if type~=\"JT\"\n(26 real changes made)\n\n. \n. gen cyd9=yd9\n\n. gen tyd9=yd9\n\n. replace cyd9=0 if type==\"JT\"\n(6 real changes made)\n\n. replace tyd9=0 if type~=\"JT\"\n(29 real changes made)\n\n. \n. gen cyd10=yd10\n\n. gen tyd10=yd10\n\n. replace cyd7=10 if type==\"JT\"\n(84 real changes made)\n\n. replace tyd7=10 if type~=\"JT\"\n(320 real changes made)\n\n. \n. gen cyd11=yd11\n\n. gen tyd11=yd11\n\n. replace cyd7=11 if type==\"JT\"\n(84 real changes made)\n\n. replace tyd7=11 if type~=\"JT\"\n(320 real changes made)\n\n. \n. gen cyd12=yd12\n\n. gen tyd12=yd12\n\n. replace cyd7=12 if type==\"JT\"\n(84 real changes made)\n\n. replace tyd7=12 if type~=\"JT\"\n(320 real changes made)\n\n. \n. program define nlct_1\n  1. version 7.0\n  2. if \"`1'\"==\"?\"{\n  3. global S_1 \"a3 a4 a5 a6 a7 a8 a9 a10 a11 a12 b2 b3 b4 b5 b6 b7 b8 b9 b10 b11 \n> b12 c1 c2 c3 c4 c5 c6 c7 c8 d1 d2 d3 d4 d5 d6 d7 d8 e2 e3 e4 e5 e6 e7 e8 e9 e10 \n> e11 e12\"\n  4. global a3=1\n  5. global a4=1\n  6. global a5=1\n  7. global a6=1\n  8. global a7=1\n  9. global a8=1\n 10. global a9=1\n 11. global a10=1\n 12. global a11=1\n 13. global a12=1\n 14. global b2=.1\n 15. global b3=.1\n 16. global b4=.1\n 17. global b5=.1\n 18. global b6=.1\n 19. global b7=.1\n 20. global b8=.1\n 21. global b9=.1\n 22. global b10=.1\n 23. global b11=.1\n 24. global b12=.1\n 25. global c1=.1\n 26. global c2=.1\n 27. global c3=.1\n 28. global c4=.1\n 29. global c5=.1\n 30. global c6=.1\n 31. global c7=.1\n 32. global c8=.1\n 33. global d1=.1\n 34. global d2=.1\n 35. global d3=.1\n 36. global d4=.1\n 37. global d5=.1\n 38. global d6=.1\n 39. global d7=.1\n 40. global d8=.1\n 41. global e2=.1\n 42. global e3=.1\n 43. global e4=.1\n 44. global e5=.1\n 45. global e6=.1\n 46. global e7=.1\n 47. global e8=.1\n 48. global e9=.1\n 49. global e10=.1\n 50. global e11=.1\n 51. global e12=.1\n 52. exit\n 53. }\n 54. \n. replace `1'=$a3*cyd3+$a4*cyd4+$a5*cyd5+$a6*cyd6+$a7*cyd7/*\n> */+$a8*cyd8+$a9*cyd9+$a10*cyd10+$a11*cyd11+$a12*cyd12/*\n> */+exp($b2*cyd2+$b3*cyd3+$b4*cyd4+$b5*cyd5+$b6*cyd6+$b7*cyd7/*\n> */+$b8*cyd8+$b9*cyd9+$b10*cyd10+$b11*cyd11+$b12*cyd12/*\n> */+$c1*wght_c+$c2*wdth_c+$c3*hght_c+$c4*hp_c+$c5*tran_c+$c6*ps_c+$c7*ac_c/*\n> */+$c8)+exp($e2*tyd2+$e3*tyd3+$e4*tyd4+$e5*tyd5+$e6*tyd6+$e7*tyd7/*\n> */+$e8*tyd8+$e9*tyd9+$e10*tyd10+$e11*tyd11+$e12*tyd12/*\n> */+$d1*wght_t+$d2*wdth_t+$d3*hght_t+$d4*hp_t+$d5*tran_t+$d6*ps_t+$d7*four_t+$d8)\n 55. \n. end\n\n. \n. nl ct_1 price\n(obs = 404)\n\nIteration 0:   residual SS =  3.68e+10\n...\nIteration 24:  residual SS =  3.13e+08\nIteration 25:  residual SS =  3.13e+08\n\n      Source |       SS       df       MS            Number of obs =       404\n-------------+------------------------------         F( 46,   357) =    147.07\n       Model |  5.9297e+09    46   128906902         Prob > F      =    0.0000\n    Residual |   312918865   357  876523.431         R-squared     =    0.9499\n-------------+------------------------------         Adj R-squared =    0.9434\n       Total |  6.2426e+09   403  15490412.8         Root MSE      =  936.2283\n                                                     Res. dev.     =  6624.758\n(ct_1)\n------------------------------------------------------------------------------\n       price |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]\n-------------+----------------------------------------------------------------\n          a3 |   277.0869   551.2618     0.50   0.616    -807.0417    1361.215\n          a4 |   21.66828   535.0463     0.04   0.968    -1030.571    1073.907\n          a5 |   147.2889   494.2067     0.30   0.766    -824.6333    1119.211\n          a6 |    556.957   484.3219     1.15   0.251    -395.5256     1509.44\n          a7 |  -7.057291   101.5543    -0.07   0.945    -206.7772    192.6626\n          a8 |   771.0952   521.6698     1.48   0.140     -254.837    1797.027\n          a9 |    1191.93   517.0276     2.31   0.022     175.1272    2208.733\n         a10 |   657.8229   728.4691     0.90   0.367    -774.8072    2090.453\n         a11 |  -450.8028   817.0406    -0.55   0.581     -2057.62    1156.015\n         a12 |  -433.4064   772.5761    -0.56   0.575    -1952.779    1085.966\n          b2 |  -.0841009     .04192    -2.01   0.046    -.1665421   -.0016597\n          b3 |  -.0056866   .0864787    -0.07   0.948    -.1757583    .1643851\n          b4 |   .0872793   .0747481     1.17   0.244    -.0597227    .2342813\n          b5 |   .0666161   .0692594     0.96   0.337    -.0695916    .2028239\n          b6 |   .0749652   .0668452     1.12   0.263    -.0564948    .2064251\n          b7 |   .1526226   .0314581     4.85   0.000     .0907562    .2144891\n          b8 |   .1437711    .065557     2.19   0.029     .0148446    .2726975\n          b9 |   .1988908    .062616     3.18   0.002     .0757482    .3220335\n         b10 |   .2857005   .0719646     3.97   0.000     .1441727    .4272282\n         b11 |   .4104976   .0690287     5.95   0.000     .2747436    .5462515\n         b12 |   .3679665   .0684655     5.37   0.000     .2333201    .5026129\n          c1 |   .4662111   .0865907     5.38   0.000     .2959191    .6365031\n          c2 |   .5300141   .0640388     8.28   0.000     .4040735    .6559547\n          c3 |  -.3625191   .0443666    -8.17   0.000    -.4497719   -.2752663\n          c4 |   .2502107   .0387283     6.46   0.000     .1740464     .326375\n          c5 |    .063748   .0203705     3.13   0.002     .0236867    .1038093\n          c6 |    .108309   .0205511     5.27   0.000     .0678925    .1487255\n          c7 |   .1667295   .0205709     8.11   0.000     .1262742    .2071848\n          c8 |   6.664738   .3769454    17.68   0.000     5.923426    7.406051\n          d1 |   .4827909   .0948538     5.09   0.000     .2962486    .6693333\n          d2 |   .6237576   .3207663     1.94   0.053    -.0070714    1.254587\n          d3 |  -.1758063   .0807852    -2.18   0.030    -.3346811   -.0169316\n          d4 |   .4714717   .1961516     2.40   0.017     .0857138    .8572296\n          d5 |   .0368238   .0705556     0.52   0.602     -.101933    .1755805\n          d6 |   .0595696    .060131     0.99   0.323    -.0586858     .177825\n          d7 |    .184348   .0926225     1.99   0.047     .0021937    .3665023\n          d8 |   2.773037   1.807071     1.53   0.126    -.7808051     6.32688\n          e2 |  -2.59e+09          .        .       .            .           .\n          e3 |   1.002811   .5449131     1.84   0.067    -.0688323    2.074454\n          e4 |   1.089538   .5484653     1.99   0.048     .0109092    2.168167\n          e5 |   .7809413   .5636633     1.39   0.167    -.3275767    1.889459\n          e6 |   .8176126   .5623188     1.45   0.147    -.2882611    1.923486\n          e7 |   .1963533   .0542407     3.62   0.000     .0896819    .3030248\n          e8 |   .9909852   .5576036     1.78   0.076    -.1056155    2.087586\n          e9 |   1.011894   .5669185     1.78   0.075    -.1030257    2.126813\n         e10 |   .0766676   .1003499     0.76   0.445    -.1206836    .2740188\n         e11 |   .3305375   .0754574     4.38   0.000     .1821406    .4789343\n         e12 |   .4674833   .0740926     6.31   0.000     .3217704    .6131961\n------------------------------------------------------------------------------\n* Parameter e2 taken as constant term in model & ANOVA table\n (SEs, P values, CIs, and correlations are asymptotic approximations)\n\n. \n. gen winv=1/exp(_b[b2]*cyd2+_b[b3]*cyd3+_b[b4]*cyd4+_b[b5]*cyd5+_b[b6]*cyd6+_b[b7\n> ]*cyd7/*\n> */+_b[b8]*cyd8+_b[b9]*cyd9+_b[b10]*cyd10+_b[b11]*cyd11+_b[b12]*cyd12/*\n> */+_b[c1]*wght_c+_b[c2]*wdth_c+_b[c3]*hght_c+_b[c4]*hp_c+_b[c5]*tran_c+_b[c6]*ps\n> _c/*\n> */+_b[c7]*ac_c+_b[c8])\n\n. \n. replace winv=1/exp(_b[e2]*tyd2+_b[e3]*tyd3+_b[e4]*tyd4+_b[e5]*tyd5+_b[e6]*tyd6/*\n> */+_b[e7]*tyd7+_b[e8]*tyd8+_b[e9]*tyd9+_b[e10]*tyd10+_b[e11]*tyd11+_b[e12]*tyd12\n> /*\n> */+_b[d1]*wght_t+_b[d2]*wdth_t+_b[d3]*hght_t+_b[d4]*hp_t/*\n> */+_b[d5]*tran_t+_b[d6]*ps_t+_b[d7]*four_t+_b[d8]) if ve==2\n(120 real changes made, 8 to missing)\n\n. \n. gen nprice=price*winv\n(8 missing values generated)\n\n. \n. \n. program define nlct_2\n  1. version 7.0\n  2. if \"`1'\"==\"?\"{\n  3. global S_1 \"a3 a4 a5 a6 a7 a8 a9 a10 a11 a12 b2 b3 b4 b5 b6 b7 b8 b9 b10 b11 \n> b12 c1 c2 c3 c4 c5 c6 c7 c8 d1 d2 d3 d4 d5 d6 d7 d8 e2 e3 e4 e5 e6 e7 e8 e9 e10 \n> e11 e12\"\n  4. global a3=1\n  5. global a4=1\n  6. global a5=1\n  7. global a6=1\n  8. global a7=1\n  9. global a8=1\n 10. global a9=1\n 11. global a10=1\n 12. global a11=1\n 13. global a12=1\n 14. global b2=.1\n 15. global b3=.1\n 16. global b4=.1\n 17. global b5=.1\n 18. global b6=.1\n 19. global b7=.1\n 20. global b8=.1\n 21. global b9=.1\n 22. global b10=.1\n 23. global b11=.1\n 24. global b12=.1\n 25. global c1=.1\n 26. global c2=.1\n 27. global c3=.1\n 28. global c4=.1\n 29. global c5=.1\n 30. global c6=.1\n 31. global c7=.1\n 32. global c8=.1\n 33. global d1=.1\n 34. global d2=.1\n 35. global d3=.1\n 36. global d4=.1\n 37. global d5=.1\n 38. global d6=.1\n 39. global d7=.1\n 40. global d8=.1\n 41. global e2=.1\n 42. global e3=.1\n 43. global e4=.1\n 44. global e5=.1\n 45. global e6=.1\n 46. global e7=.1\n 47. global e8=.1\n 48. global e9=.1\n 49. global e10=.1\n 50. global e11=.1\n 51. global e12=.1\n 52. exit\n 53. }\n 54. \n. replace `1'=winv*($a3*cyd3+$a4*cyd4+$a5*cyd5+$a6*cyd6+$a7*cyd7/*\n> */+$a8*cyd8+$a9*cyd9+$a10*cyd10+$a11*cyd11+$a12*cyd12)/*\n> */+winv*exp($b2*cyd2+$b3*cyd3+$b4*cyd4+$b5*cyd5+$b6*cyd6+$b7*cyd7/*\n> */+$b8*cyd8+$b9*cyd9+$b10*cyd10+$b11*cyd11+$b12*cyd12/*\n> */+$c1*wght_c+$c2*wdth_c+$c3*hght_c+$c4*hp_c+$c5*tran_c+$c6*ps_c+$c7*ac_c/*\n> */+$c8)+winv*exp($e2*tyd2+$e3*tyd3+$e4*tyd4+$e5*tyd5+$e6*tyd6+$e7*tyd7/*\n> */+$e8*tyd8+$e9*tyd9+$e10*tyd10+$e11*tyd11+$e12*tyd12/*\n> */+$d1*wght_t+$d2*wdth_t+$d3*hght_t+$d4*hp_t+$d5*tran_t+$d6*ps_t+$d7*four_t+$d8)\n 55. \n. end\n\n. \n. nl ct_2 nprice\n(obs = 396)\n\nIteration 0:   residual SS =  3738.817\n...\nIteration 32:  residual SS =  15.11498\nIteration 33:  residual SS =  15.11498\n\n      Source |       SS       df       MS            Number of obs =       396\n-------------+------------------------------         F( 46,   349) =   1037.51\n       Model |  2066.95212    46  44.9337418         Prob > F      =    0.0000\n    Residual |  15.1149771   349   .04330939         R-squared     =    0.9927\n-------------+------------------------------         Adj R-squared =    0.9918\n       Total |   2082.0671   395  5.27105594         Root MSE      =  .2081091\n                                                     Res. dev.     =  -169.429\n(ct_2)\n------------------------------------------------------------------------------\n      nprice |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]\n-------------+----------------------------------------------------------------\n          a3 |   165.6435   524.1069     0.32   0.752    -865.1618    1196.449\n          a4 |   255.2019   575.0953     0.44   0.657    -875.8867     1386.29\n          a5 |    382.162   544.9258     0.70   0.484    -689.5897    1453.914\n          a6 |    561.334   534.9376     1.05   0.295    -490.7731    1613.441\n          a7 |    32.3127   99.45926     0.32   0.745    -163.3022    227.9276\n          a8 |    427.688   694.9132     0.62   0.539    -939.0566    1794.433\n          a9 |   1338.024   667.4732     2.00   0.046     25.24802      2650.8\n         a10 |   1354.805   1272.661     1.06   0.288    -1148.245    3857.854\n         a11 |   3732.851    1148.03     3.25   0.001     1474.923    5990.778\n         a12 |   4310.495   998.1988     4.32   0.000     2347.253    6273.737\n          b2 |   -.053796    .124424    -0.43   0.666    -.2985112    .1909192\n          b3 |   .1024193   .1947552     0.53   0.599    -.2806223    .4854609\n          b4 |   .1508038   .1964602     0.77   0.443    -.2355911    .5371987\n          b5 |    .104406   .1879434     0.56   0.579    -.2652381      .47405\n          b6 |    .161327   .1825493     0.88   0.377    -.1977082    .5203622\n          b7 |    .299865   .1270196     2.36   0.019     .0500448    .5496851\n          b8 |   .4180167   .1963952     2.13   0.034     .0317497    .8042836\n          b9 |   .4275378    .190593     2.24   0.026     .0526824    .8023932\n         b10 |    .473833   .1983748     2.39   0.017     .0836725    .8639936\n         b11 |   .3078561    .206895     1.49   0.138    -.0990619    .7147741\n         b12 |   .1790811   .2035596     0.88   0.380    -.2212767     .579439\n          c1 |   .6665196   .3118486     2.14   0.033     .0531805    1.279859\n          c2 |   1.066573   .3592669     2.97   0.003     .3599729    1.773174\n          c3 |  -.3333017   .1511001    -2.21   0.028    -.6304831   -.0361203\n          c4 |   .4277256   .1382984     3.09   0.002     .1557224    .6997287\n          c5 |   .2157146   .0848215     2.54   0.011     .0488889    .3825402\n          c6 |   .1948046   .0696014     2.80   0.005     .0579136    .3316957\n          c7 |   .1545815   .0715104     2.16   0.031      .013936     .295227\n          c8 |   2.456385    2.09751     1.17   0.242    -1.668965    6.581735\n          d1 |   .5464099   .0950598     5.75   0.000     .3594477    .7333721\n          d2 |   .0486571   .0432501     1.13   0.261    -.0364066    .1337208\n          d3 |  -.0695537   .0449695    -1.55   0.123     -.157999    .0188915\n          d4 |   .3998404   .0759349     5.27   0.000     .2504929    .5491879\n          d5 |   .0875427   .0184166     4.75   0.000     .0513213    .1237641\n          d6 |    .039679    .075099     0.53   0.598    -.1080246    .1873827\n          d7 |  -.0740434   .1046904    -0.71   0.480    -.2799468      .13186\n          d8 |   7.377294   .2976717    24.78   0.000     6.791838     7.96275\n          e2 |         .1          .        .       .            .           .\n          e3 |   .2699934   .0481155     5.61   0.000     .1753605    .3646263\n          e4 |   .2654374    .048439     5.48   0.000     .1701684    .3607065\n          e5 |   .1633878    .033666     4.85   0.000      .097174    .2296016\n          e6 |   .1719965   .0352488     4.88   0.000     .1026697    .2413233\n          e7 |   .0506695    .015178     3.34   0.001     .0208177    .0805213\n          e8 |   .1550894   .0392545     3.95   0.000     .0778843    .2322944\n          e9 |   .1318401   .0385509     3.42   0.001     .0560188    .2076615\n         e10 |   -.047726   .2001646    -0.24   0.812    -.4414067    .3459547\n         e11 |  -.5569037   .3050303    -1.83   0.069    -1.156833    .0430251\n         e12 |  -.6348534    .314223    -2.02   0.044    -1.252862   -.0168445\n------------------------------------------------------------------------------\n* Parameter e2 taken as constant term in model & ANOVA table\n (SEs, P values, CIs, and correlations are asymptotic approximations)\n\n. \n. program drop _all\n\n. log close\n      name:  <unnamed>\n       log:  Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapt\n> er-8\\system_nocon.log\n  log type:  text\n closed on:   6 Jul 2024, 23:02:18\n----------------------------------------------------------------------------------\n\n. exit\n\nend of do-file\n```\n\n### My code\n\n#### system_nocom.do\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntruck_7990 <- feenstra_88$truck_7990 %>%\n  mutate(ve = 2) %>%\n  rename(\n    wdth_t = wdth, hght_t = hght, wght_t = weight, hp_t = hp, four_t = four,\n    tran_t = tran, ps_t = ps, ac_t = ac\n  )\n\ncar_7990 <- feenstra_88$car_7990 %>%\n  mutate(ve = 1) %>%\n  rename(\n    wdth_c = wdth, hght_c = hght, wght_c = wght, hp_c = hp, four_c = four,\n    tran_c = tran, ps_c = ps, ac_c = ac\n  )\n\ntruck_7990 <- truck_7990 %>%\n  bind_rows(car_7990) %>%\n  mutate(\n    wdth_c = ifelse(is.na(wdth_c), 0, wdth_c),\n    hght_c = ifelse(is.na(hght_c), 0, hght_c),\n    wght_c = ifelse(is.na(wght_c), 0, wght_c),\n    hp_c = ifelse(is.na(hp_c), 0, hp_c),\n    four_c = ifelse(is.na(four_c), 0, four_c),\n    tran_c = ifelse(is.na(tran_c), 0, tran_c),\n    ps_c = ifelse(is.na(ps_c), 0, ps_c),\n    ac_c = ifelse(is.na(ac_c), 0, ac_c),\n    wdth_t = ifelse(is.na(wdth_t), 0, wdth_t),\n    hght_t = ifelse(is.na(hght_t), 0, hght_t),\n    wght_t = ifelse(is.na(wght_t), 0, wght_t),\n    hp_t = ifelse(is.na(hp_t), 0, hp_t),\n    four_t = ifelse(is.na(four_t), 0, four_t),\n    tran_t = ifelse(is.na(tran_t), 0, tran_t),\n    ps_t = ifelse(is.na(ps_t), 0, ps_t),\n    ac_t = ifelse(is.na(ac_t), 0, ac_t)\n  )\n\ntruck_7990 %>%\n  group_by(year) %>%\n  summarise(freq = n()) %>%\n  ungroup() %>%\n  mutate(\n    percent = freq / sum(freq) * 100,\n    cum = cumsum(percent)\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 12 × 4\n    year  freq percent    cum\n   <dbl> <int>   <dbl>  <dbl>\n 1    79    31    7.67   7.67\n 2    80    34    8.42  16.1 \n 3    81    35    8.66  24.8 \n 4    82    35    8.66  33.4 \n 5    83    36    8.91  42.3 \n 6    84    40    9.90  52.2 \n 7    85    43   10.6   62.9 \n 8    86    33    8.17  71.0 \n 9    87    35    8.66  79.7 \n10    88    30    7.43  87.1 \n11    89    26    6.44  93.6 \n12    90    26    6.44 100   \n```\n\n\n:::\n\n```{.r .cell-code}\ntruck_7990 <- truck_7990 %>%\n  mutate(yd = as.factor(year - min(year) + 1))\n\ntruck_7990_dummy <- model.matrix(~ yd - 1, data = truck_7990)\n\ntruck_7990 <- truck_7990 %>%\n  bind_cols(as.data.frame(truck_7990_dummy))\n\ntruck_7990 <- truck_7990 %>%\n  mutate(\n    cyd2 = ifelse(type == \"JT\", 0, yd2),\n    cyd3 = ifelse(type == \"JT\", 0, yd3),\n    cyd4 = ifelse(type == \"JT\", 0, yd4),\n    cyd5 = ifelse(type == \"JT\", 0, yd5),\n    cyd6 = ifelse(type == \"JT\", 0, yd6),\n    cyd7 = ifelse(type == \"JT\", 12, yd7),\n    cyd8 = ifelse(type == \"JT\", 0, yd8),\n    cyd9 = ifelse(type == \"JT\", 0, yd9),\n    cyd10 = yd10,\n    cyd11 = yd11,\n    cyd12 = yd12,\n    tyd2 = ifelse(type != \"JT\", 0, yd2),\n    tyd3 = ifelse(type != \"JT\", 0, yd3),\n    tyd4 = ifelse(type != \"JT\", 0, yd4),\n    tyd5 = ifelse(type != \"JT\", 0, yd5),\n    tyd6 = ifelse(type != \"JT\", 0, yd6),\n    tyd7 = ifelse(type != \"JT\", 12, yd7),\n    tyd8 = ifelse(type != \"JT\", 0, yd8),\n    tyd9 = ifelse(type != \"JT\", 0, yd9),\n    tyd10 = yd10,\n    tyd11 = yd11,\n    tyd12 = yd12\n  )\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ninitial_values <- list(\n  a3 = 1, a4 = 1, a5 = 1, a6 = 1, a7 = 1, a8 = 1, a9 = 1, a10 = 1, a11 = 1,\n  a12 = 1,\n  b2 = 0.1, b3 = 0.1, b4 = 0.1, b5 = 0.1, b6 = 0.1, b7 = 0.1, b8 = 0.1,\n  b9 = 0.1, b10 = 0.1, b11 = 0.1, b12 = 0.1,\n  c1 = 0.1, c2 = 0.1, c3 = 0.1, c4 = 0.1, c5 = 0.1, c6 = 0.1, c7 = 0.1,\n  c8 = 0.1,\n  d1 = 0.1, d2 = 0.1, d3 = 0.1, d4 = 0.1, d5 = 0.1, d6 = 0.1, d7 = 0.1,\n  d8 = 0.1,\n  e2 = 0.1, e3 = 0.1, e4 = 0.1, e5 = 0.1, e6 = 0.1, e7 = 0.1, e8 = 0.1,\n  e9 = 0.1, e10 = 0.1, e11 = 0.1, e12 = 0.1\n)\n\nfit <- nlsLM(\n  price ~ a3 * cyd3 + a4 * cyd4 + a5 * cyd5 + a6 * cyd6 + a7 * cyd7 +\n    a8 * cyd8 + a9 * cyd9 + a10 * cyd10 + a11 * cyd11 + a12 * cyd12 +\n    exp(b2 * cyd2 + b3 * cyd3 + b4 * cyd4 + b5 * cyd5 + b6 * cyd6 + b7 * cyd7 +\n      b8 * cyd8 + b9 * cyd9 + b10 * cyd10 + b11 * cyd11 + b12 * cyd12 +\n      c1 * wght_c + c2 * wdth_c + c3 * hght_c + c4 * hp_c + c5 * tran_c +\n      c6 * ps_c + c7 * ac_c + c8) +\n    exp(e2 * tyd2 + e3 * tyd3 + e4 * tyd4 + e5 * tyd5 + e6 * tyd6 + e7 * tyd7 +\n      e8 * tyd8 + e9 * tyd9 + e10 * tyd10 + e11 * tyd11 + e12 * tyd12 +\n      d1 * wght_t + d2 * wdth_t + d3 * hght_t + d4 * hp_t + d5 * tran_t +\n      d6 * ps_t + d7 * four_t + d8),\n  data = truck_7990,\n  start = initial_values,\n  # adjust parameters to account to slow convergence\n  control = nls.lm.control(maxiter = 1000, maxfev = 10000)\n)\n\nsummary(fit)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nFormula: price ~ a3 * cyd3 + a4 * cyd4 + a5 * cyd5 + a6 * cyd6 + a7 * \n    cyd7 + a8 * cyd8 + a9 * cyd9 + a10 * cyd10 + a11 * cyd11 + \n    a12 * cyd12 + exp(b2 * cyd2 + b3 * cyd3 + b4 * cyd4 + b5 * \n    cyd5 + b6 * cyd6 + b7 * cyd7 + b8 * cyd8 + b9 * cyd9 + b10 * \n    cyd10 + b11 * cyd11 + b12 * cyd12 + c1 * wght_c + c2 * wdth_c + \n    c3 * hght_c + c4 * hp_c + c5 * tran_c + c6 * ps_c + c7 * \n    ac_c + c8) + exp(e2 * tyd2 + e3 * tyd3 + e4 * tyd4 + e5 * \n    tyd5 + e6 * tyd6 + e7 * tyd7 + e8 * tyd8 + e9 * tyd9 + e10 * \n    tyd10 + e11 * tyd11 + e12 * tyd12 + d1 * wght_t + d2 * wdth_t + \n    d3 * hght_t + d4 * hp_t + d5 * tran_t + d6 * ps_t + d7 * \n    four_t + d8)\n\nParameters:\n      Estimate Std. Error t value Pr(>|t|)    \na3   2.596e+02  5.491e+02   0.473  0.63663    \na4   2.159e+01  5.320e+02   0.041  0.96766    \na5   1.385e+02  4.921e+02   0.282  0.77849    \na6   5.621e+02  4.804e+02   1.170  0.24277    \na7  -2.020e+01  1.035e+02  -0.195  0.84547    \na8   7.438e+02  5.206e+02   1.429  0.15399    \na9   1.175e+03  5.175e+02   2.270  0.02378 *  \na10  7.411e+02  7.438e+02   0.996  0.31973    \na11 -4.744e+02  8.253e+02  -0.575  0.56579    \na12 -5.577e+02  7.820e+02  -0.713  0.47623    \nb2  -8.778e-02  4.246e-02  -2.067  0.03943 *  \nb3  -6.198e-03  8.692e-02  -0.071  0.94319    \nb4   8.501e-02  7.549e-02   1.126  0.26086    \nb5   6.504e-02  7.007e-02   0.928  0.35391    \nb6   7.187e-02  6.775e-02   1.061  0.28952    \nb7   1.512e-01  3.346e-02   4.519 8.46e-06 ***\nb8   1.445e-01  6.653e-02   2.173  0.03046 *  \nb9   1.986e-01  6.371e-02   3.117  0.00198 ** \nb10  2.789e-01  7.397e-02   3.771  0.00019 ***\nb11  4.093e-01  7.059e-02   5.799 1.48e-08 ***\nb12  3.709e-01  6.936e-02   5.347 1.60e-07 ***\nc1   4.691e-01  8.868e-02   5.289 2.15e-07 ***\nc2   5.440e-01  7.051e-02   7.715 1.23e-13 ***\nc3  -3.623e-01  4.558e-02  -7.949 2.51e-14 ***\nc4   2.486e-01  3.892e-02   6.388 5.25e-10 ***\nc5   6.424e-02  2.068e-02   3.106  0.00205 ** \nc6   1.090e-01  2.102e-02   5.188 3.59e-07 ***\nc7   1.667e-01  2.075e-02   8.033 1.41e-14 ***\nc8   6.581e+00  4.161e-01  15.814  < 2e-16 ***\nd1   4.809e-01  9.247e-02   5.200 3.36e-07 ***\nd2   5.697e-01  2.951e-01   1.930  0.05436 .  \nd3  -1.723e-01  7.918e-02  -2.176  0.03021 *  \nd4   4.761e-01  1.876e-01   2.538  0.01157 *  \nd5   4.939e-02  6.314e-02   0.782  0.43462    \nd6   5.430e-02  5.794e-02   0.937  0.34930    \nd7   1.797e-01  9.133e-02   1.968  0.04986 *  \nd8   3.724e+00  1.851e+00   2.012  0.04497 *  \ne2  -2.764e-01  6.097e-01  -0.453  0.65061    \ne3   6.840e-01  4.056e-01   1.687  0.09255 .  \ne4   7.412e-01  4.242e-01   1.747  0.08141 .  \ne5   5.277e-01  3.852e-01   1.370  0.17157    \ne6   5.536e-01  3.897e-01   1.421  0.15624    \ne7   1.408e-01  6.125e-02   2.298  0.02212 *  \ne8   6.340e-01  4.319e-01   1.468  0.14302    \ne9   6.354e-01  4.490e-01   1.415  0.15788    \ne10  5.881e-02  1.012e-01   0.581  0.56144    \ne11  3.243e-01  7.533e-02   4.305 2.16e-05 ***\ne12  4.668e-01  7.319e-02   6.378 5.59e-10 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 936.3 on 356 degrees of freedom\n\nNumber of iterations to convergence: 42 \nAchieved convergence tolerance: 1.49e-08\n```\n\n\n:::\n\n```{.r .cell-code}\nfit_coef <- coef(fit)\n\ntruck_7990 <- truck_7990 %>%\n  mutate(\n    winv = case_when(\n      ve == 1 ~ 1 / exp(fit_coef[\"b2\"] * cyd2 + fit_coef[\"b3\"] * cyd3 +\n        fit_coef[\"b4\"] * cyd4 + fit_coef[\"b5\"] * cyd5 + fit_coef[\"b6\"] * cyd6 +\n        fit_coef[\"b7\"] * cyd7 + fit_coef[\"b8\"] * cyd8 + fit_coef[\"b9\"] * cyd9 +\n        fit_coef[\"b10\"] * cyd10 + fit_coef[\"b11\"] * cyd11 +\n        fit_coef[\"b12\"] * cyd12 + fit_coef[\"c1\"] * wght_c +\n        fit_coef[\"c2\"] * wdth_c + fit_coef[\"c3\"] * hght_c +\n        fit_coef[\"c4\"] * hp_c + fit_coef[\"c5\"] * tran_c +\n        fit_coef[\"c6\"] * ps_c + fit_coef[\"c7\"] * ac_c + fit_coef[\"c8\"]),\n      ve == 2 ~ 1 / exp(fit_coef[\"e2\"] * tyd2 + fit_coef[\"e3\"] * tyd3 +\n        fit_coef[\"e4\"] * tyd4 + fit_coef[\"e5\"] * tyd5 + fit_coef[\"e6\"] * tyd6 +\n        fit_coef[\"e7\"] * tyd7 + fit_coef[\"e8\"] * tyd8 + fit_coef[\"e9\"] * tyd9 +\n        fit_coef[\"e10\"] * tyd10 + fit_coef[\"e11\"] * tyd11 +\n        fit_coef[\"e12\"] * tyd12 + fit_coef[\"d1\"] * wght_t +\n        fit_coef[\"d2\"] * wdth_t + fit_coef[\"d3\"] * hght_t +\n        fit_coef[\"d4\"] * hp_t + fit_coef[\"d5\"] * tran_t +\n        fit_coef[\"d6\"] * ps_t + fit_coef[\"d7\"] * four_t + fit_coef[\"d8\"]),\n    ),\n    nprice = price * winv\n  )\n\nfit2 <- nlsLM(\n  nprice ~ winv * (a3 * cyd3 + a4 * cyd4 + a5 * cyd5 + a6 * cyd6 + a7 * cyd7 +\n    a8 * cyd8 + a9 * cyd9 + a10 * cyd10 + a11 * cyd11 + a12 * cyd12) +\n    winv * exp(b2 * cyd2 + b3 * cyd3 + b4 * cyd4 + b5 * cyd5 + b6 * cyd6 +\n      b7 * cyd7 + b8 * cyd8 + b9 * cyd9 + b10 * cyd10 + b11 * cyd11 +\n      b12 * cyd12 + c1 * wght_c + c2 * wdth_c + c3 * hght_c + c4 * hp_c +\n      c5 * tran_c + c6 * ps_c + c7 * ac_c + c8) +\n    winv * exp(e2 * tyd2 + e3 * tyd3 + e4 * tyd4 + e5 * tyd5 + e6 * tyd6 +\n      e7 * tyd7 + e8 * tyd8 + e9 * tyd9 + e10 * tyd10 + e11 * tyd11 +\n      e12 * tyd12 + d1 * wght_t + d2 * wdth_t + d3 * hght_t + d4 * hp_t +\n      d5 * tran_t + d6 * ps_t + d7 * four_t + d8),\n  data = truck_7990,\n  start = initial_values,\n  control = nls.lm.control(maxiter = 1000, maxfev = 10000)\n)\n\nsummary(fit2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nFormula: nprice ~ winv * (a3 * cyd3 + a4 * cyd4 + a5 * cyd5 + a6 * cyd6 + \n    a7 * cyd7 + a8 * cyd8 + a9 * cyd9 + a10 * cyd10 + a11 * cyd11 + \n    a12 * cyd12) + winv * exp(b2 * cyd2 + b3 * cyd3 + b4 * cyd4 + \n    b5 * cyd5 + b6 * cyd6 + b7 * cyd7 + b8 * cyd8 + b9 * cyd9 + \n    b10 * cyd10 + b11 * cyd11 + b12 * cyd12 + c1 * wght_c + c2 * \n    wdth_c + c3 * hght_c + c4 * hp_c + c5 * tran_c + c6 * ps_c + \n    c7 * ac_c + c8) + winv * exp(e2 * tyd2 + e3 * tyd3 + e4 * \n    tyd4 + e5 * tyd5 + e6 * tyd6 + e7 * tyd7 + e8 * tyd8 + e9 * \n    tyd9 + e10 * tyd10 + e11 * tyd11 + e12 * tyd12 + d1 * wght_t + \n    d2 * wdth_t + d3 * hght_t + d4 * hp_t + d5 * tran_t + d6 * \n    ps_t + d7 * four_t + d8)\n\nParameters:\n      Estimate Std. Error t value Pr(>|t|)    \na3   2.558e+02  4.717e+02   0.542 0.587994    \na4   3.602e+02  5.124e+02   0.703 0.482532    \na5   5.100e+02  4.823e+02   1.057 0.291011    \na6   6.946e+02  4.770e+02   1.456 0.146214    \na7   6.024e+01  9.338e+01   0.645 0.519292    \na8   6.719e+02  6.023e+02   1.116 0.265324    \na9   1.317e+03  5.831e+02   2.259 0.024505 *  \na10  8.590e+02  1.067e+03   0.805 0.421102    \na11  8.514e+02  1.135e+03   0.750 0.453477    \na12  8.496e+02  1.123e+03   0.756 0.449875    \nb2  -4.359e-02  6.986e-02  -0.624 0.533015    \nb3   6.083e-02  1.322e-01   0.460 0.645668    \nb4   9.350e-02  1.340e-01   0.698 0.485782    \nb5   5.018e-02  1.275e-01   0.393 0.694188    \nb6   9.386e-02  1.238e-01   0.758 0.448940    \nb7   2.288e-01  7.452e-02   3.071 0.002300 ** \nb8   2.835e-01  1.330e-01   2.131 0.033774 *  \nb9   3.347e-01  1.255e-01   2.667 0.008003 ** \nb10  4.105e-01  1.389e-01   2.956 0.003328 ** \nb11  4.014e-01  1.454e-01   2.761 0.006058 ** \nb12  3.202e-01  1.418e-01   2.258 0.024519 *  \nc1   4.797e-01  2.005e-01   2.392 0.017269 *  \nc2   8.180e-01  2.096e-01   3.903 0.000114 ***\nc3  -2.666e-01  9.648e-02  -2.763 0.006022 ** \nc4   4.243e-01  9.175e-02   4.624 5.27e-06 ***\nc5   1.603e-01  5.221e-02   3.070 0.002302 ** \nc6   1.633e-01  4.580e-02   3.567 0.000411 ***\nc7   1.522e-01  4.696e-02   3.241 0.001306 ** \nc8   4.049e+00  1.249e+00   3.243 0.001296 ** \nd1   4.943e-01  9.277e-02   5.328 1.77e-07 ***\nd2   7.392e-02  6.277e-02   1.178 0.239734    \nd3  -3.155e-02  5.003e-02  -0.631 0.528681    \nd4   3.573e-01  8.138e-02   4.390 1.49e-05 ***\nd5   9.111e-02  2.193e-02   4.154 4.10e-05 ***\nd6   8.898e-03  5.962e-02   0.149 0.881454    \nd7   8.680e-02  1.017e-01   0.853 0.394034    \nd8   6.958e+00  4.030e-01  17.264  < 2e-16 ***\ne2  -6.496e-03  1.990e-02  -0.326 0.744316    \ne3   3.050e-01  5.749e-02   5.306 1.98e-07 ***\ne4   3.021e-01  5.829e-02   5.182 3.68e-07 ***\ne5   1.918e-01  4.357e-02   4.402 1.42e-05 ***\ne6   2.001e-01  4.508e-02   4.439 1.21e-05 ***\ne7   5.227e-02  1.667e-02   3.135 0.001862 ** \ne8   2.051e-01  5.229e-02   3.923 0.000105 ***\ne9   1.869e-01  5.223e-02   3.578 0.000395 ***\ne10  5.322e-02  1.533e-01   0.347 0.728665    \ne11  1.145e-01  1.635e-01   0.700 0.484378    \ne12  2.044e-01  1.760e-01   1.161 0.246236    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.1606 on 356 degrees of freedom\n\nNumber of iterations to convergence: 40 \nAchieved convergence tolerance: 1.49e-08\n```\n\n\n:::\n:::\n\n\n\n\n\n#### system_nocom.do\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfit3 <- nlsLM(\n  nprice ~ a3 * cyd3 + a4 * cyd4 + a5 * cyd5 + a6 * cyd6 + a7 * cyd7 +\n    a8 * cyd8 + a9 * cyd9 + a10 * cyd10 + a11 * cyd11 + a12 * cyd12 +\n    exp(b2 * cyd2 + b3 * cyd3 + b4 * cyd4 + b5 * cyd5 + b6 * cyd6 + b7 * cyd7 +\n      b8 * cyd8 + b9 * cyd9 + b10 * cyd10 + b11 * cyd11 + b12 * cyd12 +\n      c1 * wght_c + c2 * wdth_c + c3 * hght_c + c4 * hp_c + c5 * tran_c +\n      c6 * ps_c + c7 * ac_c + c8) +\n    exp(e2 * tyd2 + e3 * tyd3 + e4 * tyd4 + e5 * tyd5 + e6 * tyd6 + e7 * tyd7 +\n      e8 * tyd8 + e9 * tyd9 + e10 * tyd10 + e11 * tyd11 + e12 * tyd12 +\n      d1 * wght_t + d2 * wdth_t + d3 * hght_t + d4 * hp_t + d5 * tran_t +\n      d6 * ps_t + d7 * four_t + d8),\n  data = truck_7990,\n  start = initial_values,\n  control = nls.lm.control(maxiter = 1000, maxfev = 10000)\n)\n\nsummary(fit3)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nFormula: nprice ~ a3 * cyd3 + a4 * cyd4 + a5 * cyd5 + a6 * cyd6 + a7 * \n    cyd7 + a8 * cyd8 + a9 * cyd9 + a10 * cyd10 + a11 * cyd11 + \n    a12 * cyd12 + exp(b2 * cyd2 + b3 * cyd3 + b4 * cyd4 + b5 * \n    cyd5 + b6 * cyd6 + b7 * cyd7 + b8 * cyd8 + b9 * cyd9 + b10 * \n    cyd10 + b11 * cyd11 + b12 * cyd12 + c1 * wght_c + c2 * wdth_c + \n    c3 * hght_c + c4 * hp_c + c5 * tran_c + c6 * ps_c + c7 * \n    ac_c + c8) + exp(e2 * tyd2 + e3 * tyd3 + e4 * tyd4 + e5 * \n    tyd5 + e6 * tyd6 + e7 * tyd7 + e8 * tyd8 + e9 * tyd9 + e10 * \n    tyd10 + e11 * tyd11 + e12 * tyd12 + d1 * wght_t + d2 * wdth_t + \n    d3 * hght_t + d4 * hp_t + d5 * tran_t + d6 * ps_t + d7 * \n    four_t + d8)\n\nParameters:\n      Estimate Std. Error t value Pr(>|t|)    \na3   2.624e-02  4.140e-01   0.063 0.949491    \na4   8.697e-02  4.183e-01   0.208 0.835437    \na5  -8.312e-02  4.548e-01  -0.183 0.855098    \na6  -1.323e-01  4.526e-01  -0.292 0.770199    \na7   2.344e-01  1.482e-02  15.813  < 2e-16 ***\na8   3.986e-01  3.092e-01   1.289 0.198254    \na9   5.016e-01  2.736e-01   1.833 0.067611 .  \na10  5.424e-01  3.662e-01   1.481 0.139457    \na11  9.750e-01  2.681e-01   3.637 0.000316 ***\na12  9.776e-01  3.251e-01   3.007 0.002822 ** \nb2   9.341e-02  5.898e-02   1.584 0.114102    \nb3   1.123e-01  4.512e-01   0.249 0.803509    \nb4  -1.732e-02  5.231e-01  -0.033 0.973612    \nb5   1.847e-01  4.491e-01   0.411 0.681186    \nb6   2.756e-01  3.967e-01   0.695 0.487667    \nb7  -2.069e-01  7.952e-02  -2.602 0.009669 ** \nb8  -3.091e-01  5.138e-01  -0.602 0.547748    \nb9  -3.748e-01  4.893e-01  -0.766 0.444214    \nb10 -6.060e-01  7.450e-01  -0.813 0.416582    \nb11 -1.343e+01  2.169e+05   0.000 0.999951    \nb12 -7.439e+00  6.761e+02  -0.011 0.991227    \nc1  -3.546e-01  1.945e-01  -1.823 0.069162 .  \nc2  -3.473e-01  1.416e-01  -2.453 0.014648 *  \nc3   3.854e-01  1.320e-01   2.919 0.003736 ** \nc4   3.652e-01  1.556e-01   2.346 0.019500 *  \nc5   8.554e-02  4.351e-02   1.966 0.050062 .  \nc6  -4.309e-02  4.620e-02  -0.933 0.351609    \nc7  -4.548e-02  5.820e-02  -0.781 0.435036    \nc8  -9.251e-03  9.580e-02  -0.097 0.923125    \nd1  -1.943e-01  3.195e-01  -0.608 0.543525    \nd2  -9.550e-01  1.593e-01  -5.995 5.00e-09 ***\nd3   8.712e-01  1.543e-01   5.646 3.36e-08 ***\nd4   9.527e-02  1.540e-01   0.619 0.536598    \nd5   1.438e-01  5.331e-02   2.697 0.007324 ** \nd6   8.713e-02  2.299e+00   0.038 0.969795    \nd7  -1.475e+00  3.011e+00  -0.490 0.624490    \nd8   1.564e+00  8.814e-01   1.775 0.076812 .  \ne2   6.017e-01  5.035e-02  11.951  < 2e-16 ***\ne3  -2.292e+00  7.305e-01  -3.138 0.001844 ** \ne4  -1.671e+01  1.301e+06   0.000 0.999990    \ne5  -1.534e+00  2.857e-01  -5.371 1.42e-07 ***\ne6  -1.676e+00  3.323e-01  -5.043 7.30e-07 ***\ne7  -2.786e-01  5.847e-02  -4.765 2.76e-06 ***\ne8  -1.922e+01  1.849e+07   0.000 0.999999    \ne9  -1.872e+01  1.117e+07   0.000 0.999999    \ne10  3.423e-02  1.998e-01   0.171 0.864101    \ne11 -1.734e+00  6.989e-01  -2.482 0.013532 *  \ne12 -1.259e+01  4.935e+04   0.000 0.999797    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.1665 on 356 degrees of freedom\n\nNumber of iterations to convergence: 135 \nAchieved convergence tolerance: 1.49e-08\n```\n\n\n:::\n\n```{.r .cell-code}\nfit4 <- nlsLM(\n  nprice ~ winv * (a3 * cyd3 + a4 * cyd4 + a5 * cyd5 + a6 * cyd6 + a7 * cyd7 +\n    a8 * cyd8 + a9 * cyd9 + a10 * cyd10 + a11 * cyd11 + a12 * cyd12) +\n    winv * exp(b2 * cyd2 + b3 * cyd3 + b4 * cyd4 + b5 * cyd5 + b6 * cyd6 +\n      b7 * cyd7 + b8 * cyd8 + b9 * cyd9 + b10 * cyd10 + b11 * cyd11 +\n      b12 * cyd12 + c1 * wght_c + c2 * wdth_c + c3 * hght_c + c4 * hp_c +\n      c5 * tran_c + c6 * ps_c + c7 * ac_c + c8) +\n    winv * exp(e2 * tyd2 + e3 * tyd3 + e4 * tyd4 + e5 * tyd5 + e6 * tyd6 +\n      e7 * tyd7 + e8 * tyd8 + e9 * tyd9 + e10 * tyd10 + e11 * tyd11 +\n      e12 * tyd12 + d1 * wght_t + d2 * wdth_t + d3 * hght_t + d4 * hp_t +\n      d5 * tran_t + d6 * ps_t + d7 * four_t + d8),\n  data = truck_7990,\n  start = initial_values,\n  control = nls.lm.control(maxiter = 1000, maxfev = 10000)\n)\n\nsummary(fit4)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nFormula: nprice ~ winv * (a3 * cyd3 + a4 * cyd4 + a5 * cyd5 + a6 * cyd6 + \n    a7 * cyd7 + a8 * cyd8 + a9 * cyd9 + a10 * cyd10 + a11 * cyd11 + \n    a12 * cyd12) + winv * exp(b2 * cyd2 + b3 * cyd3 + b4 * cyd4 + \n    b5 * cyd5 + b6 * cyd6 + b7 * cyd7 + b8 * cyd8 + b9 * cyd9 + \n    b10 * cyd10 + b11 * cyd11 + b12 * cyd12 + c1 * wght_c + c2 * \n    wdth_c + c3 * hght_c + c4 * hp_c + c5 * tran_c + c6 * ps_c + \n    c7 * ac_c + c8) + winv * exp(e2 * tyd2 + e3 * tyd3 + e4 * \n    tyd4 + e5 * tyd5 + e6 * tyd6 + e7 * tyd7 + e8 * tyd8 + e9 * \n    tyd9 + e10 * tyd10 + e11 * tyd11 + e12 * tyd12 + d1 * wght_t + \n    d2 * wdth_t + d3 * hght_t + d4 * hp_t + d5 * tran_t + d6 * \n    ps_t + d7 * four_t + d8)\n\nParameters:\n      Estimate Std. Error t value Pr(>|t|)    \na3   2.558e+02  4.717e+02   0.542 0.587994    \na4   3.602e+02  5.124e+02   0.703 0.482532    \na5   5.100e+02  4.823e+02   1.057 0.291011    \na6   6.946e+02  4.770e+02   1.456 0.146214    \na7   6.024e+01  9.338e+01   0.645 0.519292    \na8   6.719e+02  6.023e+02   1.116 0.265324    \na9   1.317e+03  5.831e+02   2.259 0.024505 *  \na10  8.590e+02  1.067e+03   0.805 0.421102    \na11  8.514e+02  1.135e+03   0.750 0.453477    \na12  8.496e+02  1.123e+03   0.756 0.449875    \nb2  -4.359e-02  6.986e-02  -0.624 0.533015    \nb3   6.083e-02  1.322e-01   0.460 0.645668    \nb4   9.350e-02  1.340e-01   0.698 0.485782    \nb5   5.018e-02  1.275e-01   0.393 0.694188    \nb6   9.386e-02  1.238e-01   0.758 0.448940    \nb7   2.288e-01  7.452e-02   3.071 0.002300 ** \nb8   2.835e-01  1.330e-01   2.131 0.033774 *  \nb9   3.347e-01  1.255e-01   2.667 0.008003 ** \nb10  4.105e-01  1.389e-01   2.956 0.003328 ** \nb11  4.014e-01  1.454e-01   2.761 0.006058 ** \nb12  3.202e-01  1.418e-01   2.258 0.024519 *  \nc1   4.797e-01  2.005e-01   2.392 0.017269 *  \nc2   8.180e-01  2.096e-01   3.903 0.000114 ***\nc3  -2.666e-01  9.648e-02  -2.763 0.006022 ** \nc4   4.243e-01  9.175e-02   4.624 5.27e-06 ***\nc5   1.603e-01  5.221e-02   3.070 0.002302 ** \nc6   1.633e-01  4.580e-02   3.567 0.000411 ***\nc7   1.522e-01  4.696e-02   3.241 0.001306 ** \nc8   4.049e+00  1.249e+00   3.243 0.001296 ** \nd1   4.943e-01  9.277e-02   5.328 1.77e-07 ***\nd2   7.392e-02  6.277e-02   1.178 0.239734    \nd3  -3.155e-02  5.003e-02  -0.631 0.528681    \nd4   3.573e-01  8.138e-02   4.390 1.49e-05 ***\nd5   9.111e-02  2.193e-02   4.154 4.10e-05 ***\nd6   8.898e-03  5.962e-02   0.149 0.881454    \nd7   8.680e-02  1.017e-01   0.853 0.394034    \nd8   6.958e+00  4.030e-01  17.264  < 2e-16 ***\ne2  -6.496e-03  1.990e-02  -0.326 0.744316    \ne3   3.050e-01  5.749e-02   5.306 1.98e-07 ***\ne4   3.021e-01  5.829e-02   5.182 3.68e-07 ***\ne5   1.918e-01  4.357e-02   4.402 1.42e-05 ***\ne6   2.001e-01  4.508e-02   4.439 1.21e-05 ***\ne7   5.227e-02  1.667e-02   3.135 0.001862 ** \ne8   2.051e-01  5.229e-02   3.923 0.000105 ***\ne9   1.869e-01  5.223e-02   3.578 0.000395 ***\ne10  5.322e-02  1.533e-01   0.347 0.728665    \ne11  1.145e-01  1.635e-01   0.700 0.484378    \ne12  2.044e-01  1.760e-01   1.161 0.246236    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.1606 on 356 degrees of freedom\n\nNumber of iterations to convergence: 40 \nAchieved convergence tolerance: 1.49e-08\n```\n\n\n:::\n:::\n\n\n\n\n\n### Extra step: formatting the tables\n\nI need to replace variables such as \"c1\" with \"Weight (tons)\" to replicate Table 3.5. I can do this by looking at the coefficients of the variables in the non-linear regression function.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# function to avoid repeating the same code four times\nreshape_estimates <- function(fit, vehicle, term_prefix, term_mappings) {\n  tidy(fit) %>%\n    filter(term %in% paste0(term_prefix, 1:8)) %>%\n    mutate(\n      term = case_when(\n        term == paste0(term_prefix, \"1\") ~ term_mappings[1],\n        term == paste0(term_prefix, \"2\") ~ term_mappings[2],\n        term == paste0(term_prefix, \"3\") ~ term_mappings[3],\n        term == paste0(term_prefix, \"4\") ~ term_mappings[4],\n        term == paste0(term_prefix, \"5\") ~ term_mappings[5],\n        term == paste0(term_prefix, \"6\") ~ term_mappings[6],\n        term == paste0(term_prefix, \"7\") ~ term_mappings[7],\n        term == paste0(term_prefix, \"8\") ~ term_mappings[8]\n      )\n    ) %>%\n    select(term, estimate, std.error) %>%\n    pivot_longer(\n      cols = c(estimate, std.error), names_to = \"stat\",\n      values_to = \"value\"\n    ) %>%\n    mutate(\n      stat = if_else(stat == \"estimate\", \"Estimate\", \"Std. Error\"),\n      value = round(value, 3)\n    ) %>%\n    rename(!!sym(vehicle) := value)\n}\n\ncar_vars <- c(\n  \"Weight (tons)\", \"Width (feet)\", \"Height (feet)\", \"Horsepower (100)\",\n  \"Transmission (5-speed or auto)\", \"Power steering\", \"Air conditioning\", \"Constant\"\n)\n\ntruck_vars <- c(\n  \"Weight (tons)\", \"Width (feet)\", \"Height (feet)\", \"Horsepower (100)\",\n  \"Transmission (5-speed or auto)\", \"Power steering\", \"Four-wheel drive\", \"Constant\"\n)\n\nordered_vars <- unique(c(car_vars, truck_vars))\nordered_vars <- c(\"Constant\", ordered_vars[!ordered_vars %in% \"Constant\"])\n\ntable_85 <- reshape_estimates(fit2, \"cars\", \"c\", car_vars) %>%\n  full_join(reshape_estimates(fit2, \"trucks\", \"d\", truck_vars)) %>%\n  full_join(reshape_estimates(fit4, \"cars\", \"c\", car_vars),\n    by = c(\"term\", \"stat\")\n  ) %>%\n  full_join(reshape_estimates(fit4, \"trucks\", \"d\", truck_vars),\n    by = c(\"term\", \"stat\")\n  ) %>%\n  mutate(\n    term = factor(term, levels = ordered_vars)\n  ) %>%\n  arrange(term)\n\ncolnames(table_85) <- c(\n  \"Variable\", \"Statistic\", \"Cars (No Con)\", \"Trucks (No Con)\",\n  \"Cars (W Con)\", \"Trucks (W Con)\"\n)\n\nkable(table_85)\n```\n\n::: {.cell-output-display}\n\n\n|Variable                       |Statistic  | Cars (No Con)| Trucks (No Con)| Cars (W Con)| Trucks (W Con)|\n|:------------------------------|:----------|-------------:|---------------:|------------:|--------------:|\n|Constant                       |Estimate   |         4.049|           6.958|        4.049|          6.958|\n|Constant                       |Std. Error |         1.249|           0.403|        1.249|          0.403|\n|Weight (tons)                  |Estimate   |         0.480|           0.494|        0.480|          0.494|\n|Weight (tons)                  |Std. Error |         0.201|           0.093|        0.201|          0.093|\n|Width (feet)                   |Estimate   |         0.818|           0.074|        0.818|          0.074|\n|Width (feet)                   |Std. Error |         0.210|           0.063|        0.210|          0.063|\n|Height (feet)                  |Estimate   |        -0.267|          -0.032|       -0.267|         -0.032|\n|Height (feet)                  |Std. Error |         0.096|           0.050|        0.096|          0.050|\n|Horsepower (100)               |Estimate   |         0.424|           0.357|        0.424|          0.357|\n|Horsepower (100)               |Std. Error |         0.092|           0.081|        0.092|          0.081|\n|Transmission (5-speed or auto) |Estimate   |         0.160|           0.091|        0.160|          0.091|\n|Transmission (5-speed or auto) |Std. Error |         0.052|           0.022|        0.052|          0.022|\n|Power steering                 |Estimate   |         0.163|           0.009|        0.163|          0.009|\n|Power steering                 |Std. Error |         0.046|           0.060|        0.046|          0.060|\n|Air conditioning               |Estimate   |         0.152|              NA|        0.152|             NA|\n|Air conditioning               |Std. Error |         0.047|              NA|        0.047|             NA|\n|Four-wheel drive               |Estimate   |            NA|           0.087|           NA|          0.087|\n|Four-wheel drive               |Std. Error |            NA|           0.102|           NA|          0.102|\n\n\n:::\n:::\n",
    "supporting": [
      "chapter8_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}