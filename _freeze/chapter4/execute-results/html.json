{
  "hash": "2277ddf30961197e4187c30100a008e6",
  "result": {
    "markdown": "\n# Chapter 4. Trade in Intermediate Inputs and Wages\n\n## Data Description\n\nHere are some variable definitions in data file `data_Chp4` to help you in the replication exercise. The variable names also give you a hint as to the naming conventions used by Feenstra & Hanson with their other variables.\n\n### Sources\n\n#### NBER productivity dataset (Bartelsman, Becker, Gray):\n\n| Variable | Description |\n|----------|-------------|\n| sic      | Standard Industrial Classification (4-digit manufacturing) |\n| year     | Year ranges from 58 to 97 |\n| emp      | Total employment in 1000s |\n| pay      | Total payroll in $1,000,000 |\n| prode    | Production workers in 1000s |\n| prodh    | Production worker hours in 1,000,000 |\n| prodw    | Production worker wages in $1,000,000 |\n| vship    | Total value of shipments in $1,000,000 |\n| material | Total cost of materials in $1,000,000 |\n| vadd     | Total value added in $1,000,000 |\n| invest   | Total capital expenditure in $1,000,000 |\n| invent   | End-of-year inventories in $1,000,000 |\n| energy   | Cost of electric & fuels in $1,000,000 |\n| cap      | Total real capital stock in $1,000,000 |\n| equip    | Real capital: equipment in $1,000,000 |\n| plant    | Real capital: structures in $1,000,000 |\n| piship   | Deflator for VSHIP 1987=1.000 |\n| pimat    | Deflator for MATCOST 1987=1.000 |\n| piinv    | Deflator for INVEST 1987=1.000 |\n| pien     | Deflator for ENERGY 1987=1.000 |\n\n#### Other variables created by Feenstra and Hanson:\n\nThe prefix \"a\" generally denotes an average of that variable over two periods.\n\nThe prefix \"d\" indicates annual average change in that variable x 100.\n\n| Variable | Description |\n|----------|-------------|\n| sic72    | 4 digit SIC code |\n| sic2     | 2 digit SIC code |\n| ptfp     | primary TFP |\n| err      | error as defined in (4.26) of Chapter 4, or (3) in Feenstra and Hanson (1999) |\n| simat1a  | Share of imported materials (broad outsourcing) |\n| simat1b  | share of imported materials from inside 2-digit industry (narrow outsourcing) |\n| diffout  | = simat1a – simat1b = share of imported materials from outside 2-digit industry |\n| imat     | imported materials |\n| amsh     | average material share |\n| aosh     | average energy share |\n| adlhw    | annual change in log production wage |\n| adlnw    | annual chage in log non-production wage |\n| adlpk    | annual change in log capital price |\n| amesh    | aosh + amsh |\n| apsh     | average production share |\n| ansh     | average non-production share |\n| aksh     | average capital share |\n| nwsh     | nonproduction share of the total wages |\n| dlpvad    | change in log value-added                                                                            |\n| dlpmx     | change in log material price                                                                         |\n| dlpe      | change in log energy price                                                                           |\n| dlp       | change in log price                                                                                  |\n| dlky      | change in log capital stock to real shipments ratio                                                  |\n| dly       | change in log real shipments                                                                         |\n| mvshipsh  | industry share of total manufacturing shipments, averaged over the first and last period             |\n| dsimat1b  | change in outsourcing (narrow); that is, change in imported inputs from the same 2-digit industry divided by total materials purchases |\n| dsimat1a  | change in outsourcing (broad); that is, imported inputs divided by total material purchases           |\n| dofsh     | change in office equipment/total capital (capital=pstk x ex post rental price)                       |\n| dofsh1    | change in office equipment/total capital (capital=pstk x ex ante rental price)                       |\n| dhtsh     | change in High-tech capital/total capital (capital=pstk x ex post rental price)                       |\n| dhtsh1    | change in High-tech capital/total capital (capital=pstk x ex ante rental price)                       |\n| ci        | computer investment/total investment                                                                 |\n\n## Exercise 1\n\nDownload the NBER productivity dataset at http://www.nber.org/nberces/nbprod96.htm, compute the relative wage and relative employment for 1958 – 1996, and reconstruct Figure 4.1 and 4.2.\n\nNote: Given this data, you need to first compute the wage rates in production and nonproduction sectors using the following formula ($i$ denotes the industry):\n\n\\begin{align}\n  \\text{Production worker wage rate} &= \\frac{\\sum_i \\text{production worker wage bill}_i}{\\sum_i \\text{production workers}_i} \\\\\n  \\text{Non production worker wage rate} &= \\frac{\\sum_i \\text{non production worker wage bill}_i}{\\sum_i \\text{non production workers}_i} \\\\\n  &= \\frac{\\sum_i (\\text{total pay roll}_i - \\text{production worker wage bill}_i)}{\\sum_i (\\text{total employment}_i - \\text{production workers}_i)}\n\\end{align}\n\n### My code\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Packages ----\n\nlibrary(readr)\nlibrary(janitor)\nlibrary(dplyr)\nlibrary(ggplot2)\n\n# Download and read ----\n\n# the refered link is not available anymore\n# I found a backup here: https://web.archive.org/web/20051224023622/http://www.nber.org/nberces/nbprod96.htm\n\nurl <- \"https://web.archive.org/web/20051224023622/http://www.nber.org/nberces/bbg96_87.txt\"\nfinp <- gsub(\".*/\", \"first-edition/Chapter-4/\", url)\n\nif (!file.exists(finp)) {\n  download.file(url, finp)\n}\n\nfout <- gsub(\"txt\", \"rds\", finp)\n\nif (!file.exists(fout)) {\n  bbg96_87 <- read_csv(finp) %>%\n    clean_names() %>%\n    mutate(year = year + 1900) %>%\n    filter(year >= 1958, year <= 1996)\n\n  saveRDS(bbg96_87, fout)\n} else {\n  bbg96_87 <- readRDS(fout)\n}\n\n# Compute the wage rates in production and nonproduction sectors ----\n\n# \\begin{align}\n#   \\text{Production worker wage rate} &= \\frac{\\sum_i \\text{production worker wage bill}_i}{\\sum_i \\text{production workers}_i} \\\\\n#   \\text{Non production worker wage rate} &= \\frac{\\sum_i \\text{non production worker wage bill}_i}{\\sum_i \\text{non production workers}_i} \\\\\n#   &= \\frac{\\sum_i (\\text{total pay roll}_i - \\text{production worker wage bill}_i)}{\\sum_i (\\text{total employment}_i - \\text{production workers}_i)}\n# \\end{align}\n\n# from the NBER website\n# prodw Production worker wages in $1,000,000\n# prode: Production workers in 1000s\n# pay Total payroll in $1,000,000\n# emp Total employment in 1000s\n\n# calculated variables\n# pwwr: Production worker wage rate\n# npwwr: Non production worker wage rate\n\nwage_rates <- bbg96_87 %>%\n  group_by(year) %>%\n  summarise(\n    pwwr = sum(prodw) / sum(prode),\n    npwwr = (sum(pay) - sum(prodw)) / (sum(emp) - sum(prode))\n  ) %>%\n  mutate(npwwr_pwwr = npwwr / pwwr)\n\n# Compute the relative nonproduction/production employment ----\n\nemployment_rates <- bbg96_87 %>%\n  group_by(year) %>%\n  summarise(\n    pemp = sum(prode),\n    npemp = sum(emp) - pemp\n  ) %>%\n  mutate(npemp_pemp = npemp / pemp)\n\n# Figure 4.1: Relative wage of nonproduction / production workers ----\n\nggplot(wage_rates, aes(x = year, y = npwwr_pwwr)) +\n  geom_line() +\n  geom_point(size = 4) +\n  theme_minimal(base_size = 13) +\n  labs(\n    title = \"Relative wage of nonproduction / production workers, U.S. Manufacturing\",\n    subtitle = \"Source: NBER productivity database (Bartelsman and Gray 1996)\",\n    x = \"Year\",\n    y = \"Relative wage\"\n  )\n```\n\n::: {.cell-output-display}\n![](chapter4_files/figure-html/ch4_ex1-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Figure 4.2: Relative employment of nonproduction / production workers ----\n\nggplot(employment_rates, aes(x = year, y = npemp_pemp)) +\n  geom_line() +\n  geom_point(size = 4) +\n  theme_minimal(base_size = 13) +\n  labs(\n    title = \"Relative employment of nonproduction / production workers, U.S. Manufacturing\",\n    subtitle = \"Source: NBER productivity database (Bartelsman and Gray 1996)\",\n    x = \"Year\",\n    y = \"Relative employment\"\n  )\n```\n\n::: {.cell-output-display}\n![](chapter4_files/figure-html/ch4_ex1-2.png){width=672}\n:::\n:::\n\n\n## Exercise 2\n\nRun the STATA program `Problem_4_2.do` to reproduce the regressions in Table 4.4 (which is simplified from Table III in Feenstra and Hanson, 1999). Then answer:\n\na. What weights are used in these regressions?\nb. How are the results affected if these weights are not used?\n\n### Feenstra's code\n\n```stata\nset mem 300m\n\nlog using c:\\Empirical_Exercise\\Chapter_4\\log_4_2.log,replace\n\nuse c:\\Empirical_Exercise\\Chapter_4\\data_Chp4,clear\ndrop if year==1972|year==1987\ndrop if sic72==2067|sic72==2794|sic72==3483\n\negen wagebill=sum(pay), by(year)\ngen share=pay/wagebill\n\nsort sic72 year\nby sic72: gen lagshare=share[_n-1]\ngen ashare=(share+lagshare)/2\n\nby sic72: gen lagnwsh=nwsh[_n-1]\ngen chanwsh=(nwsh-lagnwsh)*100/11\n\ngen wchanwsh=chanwsh*ashare\ngen wdlky=dlky*ashare\ngen wdly=dly*ashare\ngen wdsimat1a=dsimat1a*ashare\ngen wdsimat1b=dsimat1a*ashare\ngen diffout=dsimat1a-dsimat1b\ngen wdiffout=(dsimat1a-dsimat1b)*ashare\ngen wcosh_exp=dofsh*ashare\ngen htsh_exp=dhtsh-dofsh\ngen whtsh_exp=(dhtsh-dofsh)*ashare\ngen wcosh_exa=dofsh1*ashare\ngen htsh_exa=dhtsh1-dofsh1\ngen whtsh_exa=(dhtsh1-dofsh1)*ashare\ngen wcosh=ci*ashare\ngen whtsh=dhtsh*ashare\n\n* Check with the first column of Table 4.4 *\n\ntabstat wchanwsh wdlky wdly wdsimat1a wcosh_exp whtsh_exp wcosh_exa whtsh_exa wcosh whtsh, stats(sum)\n\n* Reproduce the rest of the columns in Table 4.4 *\n\nregress chanwsh dlky dly dsimat1a dofsh htsh_exp [aw=ashare], cluster (sic2)\n\nregress chanwsh dlky dly dsimat1a dofsh1 htsh_exa [aw=ashare], cluster (sic2)\n\nregress chanwsh dlky dly dsimat1a ci dhtsh [aw=ashare], cluster (sic2)\n\n* To instead distinguish narrow and other outsourcing, we can reproduce column (1) of table III in Feenstra and Hanson, 1999 *\n\ntabstat wchanwsh wdlky wdly wdsimat1b wdiffout wcosh_exp whtsh_exp wcosh_exa whtsh_exa wcosh whtsh, stats(sum)\n\n* Reproduce the rest of the columns in Table III *\n\nregress chanwsh dlky dly dsimat1b diffout dofsh htsh_exp [aw=ashare], cluster (sic2)\n\nregress chanwsh dlky dly dsimat1b diffout dofsh1 htsh_exa [aw=ashare], cluster (sic2)\n\nregress chanwsh dlky dly dsimat1b diffout ci dhtsh [aw=ashare], cluster (sic2)\n\nlog close\n\nclear\nexit\n```\n\nOutput:\n\n```stata\n. set mem 300m\n\nCurrent memory allocation\n\n                    current                                 memory usage\n    settable          value     description                 (1M = 1024k)\n    --------------------------------------------------------------------\n    set maxvar         5000     max. variables allowed           1.909M\n    set memory          300M    max. data space                300.000M\n    set matsize         100     max. RHS vars in models          0.085M\n                                                            -----------\n                                                               301.994M\n\n. \n. log using Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapte\n> r-4\\log_4_2.log,replace\n(note: file Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapte\n> r-4\\log_4_2.log not found)\n----------------------------------------------------------------------------------\n      name:  <unnamed>\n       log:  Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapt\n> er-4\\log_4_2.log\n  log type:  text\n opened on:  19 Jun 2024, 14:02:42\n\n. \n. use Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-4\\da\n> ta_Chp4,clear\n(Matrl Cons (72 SIC), 67-92)\n\n. drop if year==1972|year==1987\n(900 observations deleted)\n\n. drop if sic72==2067|sic72==2794|sic72==3483\n(6 observations deleted)\n\n. \n. egen wagebill=sum(pay), by(year)\n\n. gen share=pay/wagebill\n\n. \n. sort sic72 year\n\n. by sic72: gen lagshare=share[_n-1]\n(447 missing values generated)\n\n. gen ashare=(share+lagshare)/2\n(447 missing values generated)\n\n. \n. by sic72: gen lagnwsh=nwsh[_n-1]\n(447 missing values generated)\n\n. gen chanwsh=(nwsh-lagnwsh)*100/11\n(447 missing values generated)\n\n. \n. gen wchanwsh=chanwsh*ashare\n(447 missing values generated)\n\n. gen wdlky=dlky*ashare\n(447 missing values generated)\n\n. gen wdly=dly*ashare\n(447 missing values generated)\n\n. gen wdsimat1a=dsimat1a*ashare\n(447 missing values generated)\n\n. gen wdsimat1b=dsimat1a*ashare\n(447 missing values generated)\n\n. gen diffout=dsimat1a-dsimat1b\n\n. gen wdiffout=(dsimat1a-dsimat1b)*ashare\n(447 missing values generated)\n\n. gen wcosh_exp=dofsh*ashare\n(447 missing values generated)\n\n. gen htsh_exp=dhtsh-dofsh\n\n. gen whtsh_exp=(dhtsh-dofsh)*ashare\n(447 missing values generated)\n\n. gen wcosh_exa=dofsh1*ashare\n(447 missing values generated)\n\n. gen htsh_exa=dhtsh1-dofsh1\n\n. gen whtsh_exa=(dhtsh1-dofsh1)*ashare\n(447 missing values generated)\n\n. gen wcosh=ci*ashare\n(447 missing values generated)\n\n. gen whtsh=dhtsh*ashare\n(447 missing values generated)\n\n. \n. * Check with the first column of Table 4.4 *\n. \n. tabstat wchanwsh wdlky wdly wdsimat1a wcosh_exp whtsh_exp wcosh_exa whtsh_exa wc\n> osh whtsh, stats(sum)\n\n   stats |  wchanwsh     wdlky      wdly  wdsim~1a  wcosh_~p  whtsh_~p  wcosh_~a\n---------+----------------------------------------------------------------------\n     sum |  .3889885  .7063639  1.540769  .4225266  .2505536  .1444164  .0703266\n--------------------------------------------------------------------------------\n\n   stats |  whtsh_~a     wcosh     whtsh\n---------+------------------------------\n     sum |  .1655768  6.561565    .39497\n----------------------------------------\n\n. \n. * Reproduce the rest of the columns in Table 4.4 *\n. \n. regress chanwsh dlky dly dsimat1a dofsh htsh_exp [aw=ashare], cluster (sic2)\n(sum of wgt is   1.0000e+00)\n\nLinear regression                                      Number of obs =     447\n                                                       F(  5,    19) =    6.72\n                                                       Prob > F      =  0.0009\n                                                       R-squared     =  0.1557\n                                                       Root MSE      =  .38912\n\n                                  (Std. Err. adjusted for 20 clusters in sic2)\n------------------------------------------------------------------------------\n             |               Robust\n     chanwsh |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]\n-------------+----------------------------------------------------------------\n        dlky |   .0467948   .0113832     4.11   0.001     .0229695    .0706201\n         dly |   .0197383   .0063797     3.09   0.006     .0063853    .0330912\n    dsimat1a |   .1966658   .0962066     2.04   0.055     -.004697    .3980286\n       dofsh |     .19534   .0915302     2.13   0.046     .0037651    .3869148\n    htsh_exp |  -.0650465   .1371193    -0.47   0.641    -.3520404    .2219474\n       _cons |   .2028764   .0428851     4.73   0.000     .1131169     .292636\n------------------------------------------------------------------------------\n\n. \n. regress chanwsh dlky dly dsimat1a dofsh1 htsh_exa [aw=ashare], cluster (sic2)\n(sum of wgt is   1.0000e+00)\n\nLinear regression                                      Number of obs =     447\n                                                       F(  5,    19) =    8.01\n                                                       Prob > F      =  0.0003\n                                                       R-squared     =  0.1592\n                                                       Root MSE      =  .38832\n\n                                  (Std. Err. adjusted for 20 clusters in sic2)\n------------------------------------------------------------------------------\n             |               Robust\n     chanwsh |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]\n-------------+----------------------------------------------------------------\n        dlky |   .0444529   .0113121     3.93   0.001     .0207764    .0681293\n         dly |   .0173278   .0062906     2.75   0.013     .0041613    .0304942\n    dsimat1a |   .2207528   .0999711     2.21   0.040     .0115109    .4299947\n      dofsh1 |   .4309753   .1671453     2.58   0.018     .0811362    .7808144\n    htsh_exa |   .0052436   .0712031     0.07   0.942    -.1437862    .1542735\n       _cons |   .2064394   .0397614     5.19   0.000     .1232178     .289661\n------------------------------------------------------------------------------\n\n. \n. regress chanwsh dlky dly dsimat1a ci dhtsh [aw=ashare], cluster (sic2)\n(sum of wgt is   1.0000e+00)\n\nLinear regression                                      Number of obs =     447\n                                                       F(  5,    19) =   11.87\n                                                       Prob > F      =  0.0000\n                                                       R-squared     =  0.1885\n                                                       Root MSE      =  .38148\n\n                                  (Std. Err. adjusted for 20 clusters in sic2)\n------------------------------------------------------------------------------\n             |               Robust\n     chanwsh |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]\n-------------+----------------------------------------------------------------\n        dlky |   .0399279   .0087378     4.57   0.000     .0216396    .0582162\n         dly |   .0100379   .0062332     1.61   0.124    -.0030084    .0230841\n    dsimat1a |   .1346024   .0883067     1.52   0.144    -.0502257    .3194306\n          ci |   .0180834   .0066465     2.72   0.014     .0041722    .0319946\n       dhtsh |   .0324624      .0519     0.63   0.539    -.0761655    .1410904\n       _cons |   .1569685   .0446895     3.51   0.002     .0634323    .2505048\n------------------------------------------------------------------------------\n\n. \n. * To instead distinguish narrow and other outsourcing, we can reproduce column (\n> 1) of table III in Feenstra and Hanson, 1999 *\n. \n. tabstat wchanwsh wdlky wdly wdsimat1b wdiffout wcosh_exp whtsh_exp wcosh_exa wht\n> sh_exa wcosh whtsh, stats(sum)\n\n   stats |  wchanwsh     wdlky      wdly  wdsim~1b  wdiffout  wcosh_~p  whtsh_~p\n---------+----------------------------------------------------------------------\n     sum |  .3889885  .7063639  1.540769  .4225266  .1998607  .2505536  .1444164\n--------------------------------------------------------------------------------\n\n   stats |  wcosh_~a  whtsh_~a     wcosh     whtsh\n---------+----------------------------------------\n     sum |  .0703266  .1655768  6.561565    .39497\n--------------------------------------------------\n\n. \n. * Reproduce the rest of the columns in Table III *\n. \n. regress chanwsh dlky dly dsimat1b diffout dofsh htsh_exp [aw=ashare], cluster (s\n> ic2)\n(sum of wgt is   1.0000e+00)\n\nLinear regression                                      Number of obs =     447\n                                                       F(  6,    19) =    7.00\n                                                       Prob > F      =  0.0005\n                                                       R-squared     =  0.1627\n                                                       Root MSE      =  .38794\n\n                                  (Std. Err. adjusted for 20 clusters in sic2)\n------------------------------------------------------------------------------\n             |               Robust\n     chanwsh |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]\n-------------+----------------------------------------------------------------\n        dlky |   .0421152   .0141103     2.98   0.008     .0125821    .0716483\n         dly |   .0178086   .0080568     2.21   0.040     .0009456    .0346716\n    dsimat1b |   .2454613   .1692732     1.45   0.163    -.1088315    .5997541\n     diffout |    .121362   .0457066     2.66   0.016      .025697    .2170271\n       dofsh |   .2060218   .1021206     2.02   0.058    -.0077192    .4197627\n    htsh_exp |  -.0392957   .1289341    -0.30   0.764     -.309158    .2305665\n       _cons |    .206945   .0415146     4.98   0.000      .120054    .2938361\n------------------------------------------------------------------------------\n\n. \n. regress chanwsh dlky dly dsimat1b diffout dofsh1 htsh_exa [aw=ashare], cluster (\n> sic2)\n(sum of wgt is   1.0000e+00)\n\nLinear regression                                      Number of obs =     447\n                                                       F(  6,    19) =    7.37\n                                                       Prob > F      =  0.0004\n                                                       R-squared     =  0.1650\n                                                       Root MSE      =  .38742\n\n                                  (Std. Err. adjusted for 20 clusters in sic2)\n------------------------------------------------------------------------------\n             |               Robust\n     chanwsh |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]\n-------------+----------------------------------------------------------------\n        dlky |   .0408212   .0141101     2.89   0.009     .0112884     .070354\n         dly |   .0159677   .0078375     2.04   0.056    -.0004365    .0323718\n    dsimat1b |   .2653356    .175142     1.51   0.146    -.1012407    .6319119\n     diffout |   .1537718   .0502819     3.06   0.006     .0485307     .259013\n      dofsh1 |   .4207269   .1707522     2.46   0.023     .0633383    .7781154\n    htsh_exa |   .0143582     .07223     0.20   0.845    -.1368209    .1655373\n       _cons |   .2137716   .0390531     5.47   0.000     .1320326    .2955107\n------------------------------------------------------------------------------\n\n. \n. regress chanwsh dlky dly dsimat1b diffout ci dhtsh [aw=ashare], cluster (sic2)\n(sum of wgt is   1.0000e+00)\n\nLinear regression                                      Number of obs =     447\n                                                       F(  6,    19) =   14.96\n                                                       Prob > F      =  0.0000\n                                                       R-squared     =  0.1995\n                                                       Root MSE      =  .37933\n\n                                  (Std. Err. adjusted for 20 clusters in sic2)\n------------------------------------------------------------------------------\n             |               Robust\n     chanwsh |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]\n-------------+----------------------------------------------------------------\n        dlky |   .0331274   .0119999     2.76   0.012     .0080113    .0582434\n         dly |   .0068629   .0087795     0.78   0.444    -.0115128    .0252386\n    dsimat1b |   .1928059   .1657117     1.16   0.259    -.1540328    .5396445\n     diffout |   .0380044   .0539983     0.70   0.490    -.0750153    .1510241\n          ci |   .0186984   .0068931     2.71   0.014     .0042711    .0331258\n       dhtsh |   .0519438   .0512489     1.01   0.324    -.0553214    .1592091\n       _cons |   .1612801   .0401323     4.02   0.001     .0772822    .2452781\n------------------------------------------------------------------------------\n\n. \n. log close\n      name:  <unnamed>\n       log:  Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapt\n> er-4\\log_4_2.log\n  log type:  text\n closed on:  19 Jun 2024, 14:02:47\n----------------------------------------------------------------------------------\n\n. \n. clear\n\n. exit\n\nend of do-file\n```\n\n### My code\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Packages ----\n\nlibrary(archive)\nlibrary(haven)\nlibrary(dplyr)\nlibrary(lmtest)\nlibrary(sandwich)\n\n# Extract ----\n\nfzip <- \"first-edition/Chapter-4.zip\"\ndout <- gsub(\"\\\\.zip$\", \"\", fzip)\n\nif (!dir.exists(dout)) {\n  archive_extract(fzip, dir = dout)\n}\n\n# Read and transform ----\n\nfout <- paste0(dout, \"/datachp4.rds\")\n\nif (!file.exists(fout)) {\n  datachp4 <- read_dta(paste0(dout, \"/data_Chp4.dta\"))\n  saveRDS(datachp4, fout)\n} else {\n  datachp4 <- readRDS(fout) %>%\n    filter(!year %in% c(1972, 1987)) %>%\n    filter(!sic72 %in% c(2067, 2794, 3483)) %>%\n    group_by(year) %>%\n    mutate(wagebill = sum(pay)) %>%\n    ungroup() %>%\n    mutate(share = pay / wagebill) %>%\n    arrange(sic72, year) %>%\n    group_by(sic72) %>%\n    mutate(\n      lagshare = lag(share),\n      ashare = (share + lagshare) / 2,\n      lagnwsh = lag(nwsh),\n      chanwsh = (nwsh - lagnwsh) * 100 / 11\n    ) %>%\n    ungroup() %>%\n    mutate(\n      wchanwsh = chanwsh * ashare,\n      wdlky = dlky * ashare,\n      wdly = dly * ashare,\n      wdsimat1a = dsimat1a * ashare,\n      wdsimat1b = dsimat1a * ashare,\n      diffout = dsimat1a - dsimat1b,\n      wdiffout = (dsimat1a - dsimat1b) * ashare,\n      wcosh_exp = dofsh * ashare,\n      htsh_exp = dhtsh - dofsh,\n      whtsh_exp = (dhtsh - dofsh) * ashare,\n      wcosh_exa = dofsh1 * ashare,\n      htsh_exa = dhtsh1 - dofsh1,\n      whtsh_exa = (dhtsh1 - dofsh1) * ashare,\n      wcosh = ci * ashare,\n      whtsh = dhtsh * ashare\n    )\n}\n\n# Check with the first column of Table 4.4 ----\n\ndatachp4 %>%\n  select(wchanwsh:whtsh) %>%\n  summarise_all(sum, na.rm = T)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 × 15\n  wchanwsh wdlky  wdly wdsimat1a wdsimat1b diffout wdiffout wcosh_exp htsh_exp\n     <dbl> <dbl> <dbl>     <dbl>     <dbl>   <dbl>    <dbl>     <dbl>    <dbl>\n1    0.389 0.706  1.54     0.423     0.423    206.    0.200     0.251     164.\n# ℹ 6 more variables: whtsh_exp <dbl>, wcosh_exa <dbl>, htsh_exa <dbl>,\n#   whtsh_exa <dbl>, wcosh <dbl>, whtsh <dbl>\n```\n:::\n\n```{.r .cell-code}\n# Reproduce the rest of the columns in Table 4.4 ----\n\nreg1 <- lm(\n  chanwsh ~ dlky + dly + dsimat1a + dofsh + htsh_exp,\n  data = datachp4,\n  weights = datachp4$ashare\n)\n\n# summary(reg1) # no clustered robust standard errors\ncoeftest(reg1, vcov = vcovCL(reg1, cluster = datachp4$sic2))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nt test of coefficients:\n\n              Estimate Std. Error t value  Pr(>|t|)    \n(Intercept)  0.2028764  0.0428851  4.7307 3.017e-06 ***\ndlky         0.0467948  0.0113832  4.1109 4.702e-05 ***\ndly          0.0197383  0.0063797  3.0939  0.002101 ** \ndsimat1a     0.1966658  0.0962066  2.0442  0.041527 *  \ndofsh        0.1953400  0.0915302  2.1342  0.033381 *  \nhtsh_exp    -0.0650465  0.1371193 -0.4744  0.635464    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n```{.r .cell-code}\nreg2 <- lm(\n  chanwsh ~ dlky + dly + dsimat1a + dofsh1 + htsh_exa,\n  data = datachp4,\n  weights = datachp4$ashare\n)\n\ncoeftest(reg2, vcov = vcovCL(reg2, cluster = datachp4$sic2))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nt test of coefficients:\n\n             Estimate Std. Error t value  Pr(>|t|)    \n(Intercept) 0.2064394  0.0397614  5.1920 3.183e-07 ***\ndlky        0.0444529  0.0113121  3.9297 9.872e-05 ***\ndly         0.0173278  0.0062906  2.7545  0.006121 ** \ndsimat1a    0.2207528  0.0999711  2.2082  0.027746 *  \ndofsh1      0.4309753  0.1671453  2.5784  0.010248 *  \nhtsh_exa    0.0052436  0.0712031  0.0736  0.941328    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n```{.r .cell-code}\nreg3 <- lm(\n  chanwsh ~ dlky + dly + dsimat1a + ci + dhtsh,\n  data = datachp4,\n  weights = datachp4$ashare\n)\n\ncoeftest(reg3, vcov = vcovCL(reg3, cluster = datachp4$sic2))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nt test of coefficients:\n\n             Estimate Std. Error t value  Pr(>|t|)    \n(Intercept) 0.1569685  0.0446895  3.5124 0.0004898 ***\ndlky        0.0399279  0.0087378  4.5696 6.353e-06 ***\ndly         0.0100379  0.0062332  1.6104 0.1080293    \ndsimat1a    0.1346024  0.0883067  1.5243 0.1281605    \nci          0.0180834  0.0066465  2.7208 0.0067708 ** \ndhtsh       0.0324624  0.0519000  0.6255 0.5319791    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n```{.r .cell-code}\n# Column (1) of table III in Feenstra and Hanson, 1999 ----\n\n# To distinguish narrow and other outsourcing\n\ndatachp4 %>%\n  select(wchanwsh:whtsh) %>%\n  summarise_all(sum, na.rm = T)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 × 15\n  wchanwsh wdlky  wdly wdsimat1a wdsimat1b diffout wdiffout wcosh_exp htsh_exp\n     <dbl> <dbl> <dbl>     <dbl>     <dbl>   <dbl>    <dbl>     <dbl>    <dbl>\n1    0.389 0.706  1.54     0.423     0.423    206.    0.200     0.251     164.\n# ℹ 6 more variables: whtsh_exp <dbl>, wcosh_exa <dbl>, htsh_exa <dbl>,\n#   whtsh_exa <dbl>, wcosh <dbl>, whtsh <dbl>\n```\n:::\n\n```{.r .cell-code}\n# Reproduce the rest of the columns in Table III ----\n\nreg4 <- lm(\n  chanwsh ~ dlky + dly + dsimat1b + diffout + dofsh + htsh_exp,\n  data = datachp4,\n  weights = datachp4$ashare\n)\n\ncoeftest(reg4, vcov = vcovCL(reg4, cluster = datachp4$sic2))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nt test of coefficients:\n\n              Estimate Std. Error t value  Pr(>|t|)    \n(Intercept)  0.2069450  0.0415146  4.9849 8.933e-07 ***\ndlky         0.0421152  0.0141103  2.9847  0.002997 ** \ndly          0.0178086  0.0080568  2.2104  0.027592 *  \ndsimat1b     0.2454613  0.1692732  1.4501  0.147746    \ndiffout      0.1213620  0.0457066  2.6552  0.008213 ** \ndofsh        0.2060217  0.1021206  2.0174  0.044257 *  \nhtsh_exp    -0.0392957  0.1289341 -0.3048  0.760683    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n```{.r .cell-code}\nreg5 <- lm(\n  chanwsh ~ dlky + dly + dsimat1b + diffout + dofsh1 + htsh_exa,\n  data = datachp4,\n  weights = datachp4$ashare\n)\n\ncoeftest(reg5, vcov = vcovCL(reg5, cluster = datachp4$sic2))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nt test of coefficients:\n\n             Estimate Std. Error t value Pr(>|t|)    \n(Intercept) 0.2137716  0.0390531  5.4739 7.41e-08 ***\ndlky        0.0408212  0.0141101  2.8930 0.004005 ** \ndly         0.0159677  0.0078375  2.0373 0.042215 *  \ndsimat1b    0.2653356  0.1751420  1.5150 0.130497    \ndiffout     0.1537718  0.0502819  3.0582 0.002363 ** \ndofsh1      0.4207269  0.1707522  2.4640 0.014123 *  \nhtsh_exa    0.0143582  0.0722300  0.1988 0.842523    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n```{.r .cell-code}\nreg6 <- lm(\n  chanwsh ~ dlky + dly + dsimat1b + diffout + ci + dhtsh,\n  data = datachp4,\n  weights = datachp4$ashare\n)\n\ncoeftest(reg6, vcov = vcovCL(reg6, cluster = datachp4$sic2))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nt test of coefficients:\n\n             Estimate Std. Error t value  Pr(>|t|)    \n(Intercept) 0.1612801  0.0401323  4.0187 6.883e-05 ***\ndlky        0.0331274  0.0119999  2.7606  0.006010 ** \ndly         0.0068629  0.0087795  0.7817  0.434811    \ndsimat1b    0.1928058  0.1657117  1.1635  0.245257    \ndiffout     0.0380044  0.0539983  0.7038  0.481925    \nci          0.0186984  0.0068931  2.7126  0.006937 ** \ndhtsh       0.0519438  0.0512489  1.0136  0.311350    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n:::\n\n\n## Exercise 3\n\nRun the STATA program `Problem_4_3a.do` to reproduce the regressions in Table 4.5 (i.e. Table I in Feenstra and Hansen, 1999). Then run `Problem_4_3b.do` to perform the two-step regression, Table IV and Table V in Feenstra and Hanson (1999).  Note that Table V is obtained using the coefficients in the first column of Table IV.\n\n### Feenstra's code\n\n#### Part A\n\n```stata\nset mem 3m\n\nlog using c:\\Empirical_Exercise\\Chapter_4\\log_4_3a.log,replace\n\nuse c:\\Empirical_Exercise\\Chapter_4\\data_Chp4.dta, clear\n\nkeep if year==1990\ndrop if sic72==2067\ndrop if sic72==2794\ndrop if sic72==3483\ngen etfp=ptfp-err\ngen adj1=1/(1-amesh)\ngen etfp1=adj1*etfp\ngen dlpvad1=adj1*dlpvad\ngen apsh1=adj1*apsh\ngen ansh1=adj1*ansh\ngen aksh1=adj1*aksh\ngen mshxpr=amsh*dlpmx\ngen eshxpr=aosh*dlpe\n\n* Reproduce Table 4.5 *\n\ngen dlp34=dlp-mshxpr-eshxpr\n\nregress dlp34 ptfp apsh ansh aksh [aw=mvshipsh], robust\n\npreserve\ndrop if sic72==3573\nregress dlp34 ptfp apsh ansh aksh [aw=mvshipsh], robust\n\nregress dlp apsh ansh aksh mshxpr eshxpr [aw=mvshipsh], robust\nrestore\n\nregress dlpvad1 etfp1 apsh1 ansh1 aksh1 [aw=mvshipsh],robust noconstant\n\nregress dlp etfp apsh ansh aksh mshxpr eshxpr [aw=mvshipsh], robust\n\nlog close\nclear\nexit\n```\n\nOutput:\n\n```stata\n. set mem 3m\n\nCurrent memory allocation\n\n                    current                                 memory usage\n    settable          value     description                 (1M = 1024k)\n    --------------------------------------------------------------------\n    set maxvar         5000     max. variables allowed           1.909M\n    set memory            3M    max. data space                  3.000M\n    set matsize         100     max. RHS vars in models          0.085M\n                                                            -----------\n                                                                 4.994M\n\n. \n. log using Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapte\n> r-4\\log_4_3a.log,replace\n(note: file Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapte\n> r-4\\log_4_3a.log not found)\n----------------------------------------------------------------------------------\n      name:  <unnamed>\n       log:  Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapt\n> er-4\\log_4_3a.log\n  log type:  text\n opened on:  19 Jun 2024, 14:14:42\n\n. \n. use Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-4\\da\n> ta_Chp4.dta, clear\n(Matrl Cons (72 SIC), 67-92)\n\n. \n. keep if year==1990\n(1350 observations deleted)\n\n. drop if sic72==2067\n(1 observation deleted)\n\n. drop if sic72==2794\n(1 observation deleted)\n\n. drop if sic72==3483\n(1 observation deleted)\n\n. gen etfp=ptfp-err\n\n. gen adj1=1/(1-amesh)\n\n. gen etfp1=adj1*etfp\n\n. gen dlpvad1=adj1*dlpvad\n\n. gen apsh1=adj1*apsh\n\n. gen ansh1=adj1*ansh\n\n. gen aksh1=adj1*aksh\n\n. gen mshxpr=amsh*dlpmx\n\n. gen eshxpr=aosh*dlpe\n\n. \n. \n. * Reproduce Table 4.5 *\n. \n. gen dlp34=dlp-mshxpr-eshxpr\n\n. \n. regress dlp34 ptfp apsh ansh aksh [aw=mvshipsh], robust\n(sum of wgt is   9.9873e-01)\n\nLinear regression                                      Number of obs =     447\n                                                       F(  4,   442) =  106.29\n                                                       Prob > F      =  0.0000\n                                                       R-squared     =  0.8957\n                                                       Root MSE      =  .80656\n\n------------------------------------------------------------------------------\n             |               Robust\n       dlp34 |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]\n-------------+----------------------------------------------------------------\n        ptfp |  -.9631819   .0702093   -13.72   0.000    -1.101168   -.8251963\n        apsh |   3.062598    1.22198     2.51   0.013     .6609845    5.464212\n        ansh |   2.294716   1.430073     1.60   0.109    -.5158719    5.105305\n        aksh |   7.887571   .7810006    10.10   0.000     6.352634    9.422507\n       _cons |  -.7051116   .3006016    -2.35   0.019    -1.295898   -.1143256\n------------------------------------------------------------------------------\n\n. \n. preserve\n\n. drop if sic72==3573\n(1 observation deleted)\n\n. regress dlp34 ptfp apsh ansh aksh [aw=mvshipsh], robust\n(sum of wgt is   9.8179e-01)\n\nLinear regression                                      Number of obs =     446\n                                                       F(  4,   441) =   92.17\n                                                       Prob > F      =  0.0000\n                                                       R-squared     =  0.8059\n                                                       Root MSE      =  .74139\n\n------------------------------------------------------------------------------\n             |               Robust\n       dlp34 |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]\n-------------+----------------------------------------------------------------\n        ptfp |  -.7531151   .0751891   -10.02   0.000    -.9008886   -.6053416\n        apsh |   2.427856   1.162844     2.09   0.037      .142451    4.713261\n        ansh |   4.086394   1.722144     2.37   0.018     .7017647    7.471024\n        aksh |   8.058291   .9411699     8.56   0.000     6.208556    9.908027\n       _cons |  -.8249273   .2930995    -2.81   0.005    -1.400973   -.2488819\n------------------------------------------------------------------------------\n\n. \n. regress dlp apsh ansh aksh mshxpr eshxpr [aw=mvshipsh], robust\n(sum of wgt is   9.8179e-01)\n\nLinear regression                                      Number of obs =     446\n                                                       F(  5,   440) =   10.85\n                                                       Prob > F      =  0.0000\n                                                       R-squared     =  0.4289\n                                                       Root MSE      =  1.2034\n\n------------------------------------------------------------------------------\n             |               Robust\n         dlp |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]\n-------------+----------------------------------------------------------------\n        apsh |   3.605277    1.88524     1.91   0.056    -.0999163    7.310471\n        ansh |   6.202674   4.036466     1.54   0.125    -1.730475    14.13582\n        aksh |   9.535214    2.18722     4.36   0.000     5.236518    13.83391\n      mshxpr |   1.219304   .2471334     4.93   0.000     .7335958    1.705013\n      eshxpr |  -.9301182   .9150299    -1.02   0.310    -2.728491    .8682541\n       _cons |  -1.929187   .9147773    -2.11   0.036    -3.727063   -.1313111\n------------------------------------------------------------------------------\n\n. restore\n\n. \n. regress dlpvad1 etfp1 apsh1 ansh1 aksh1 [aw=mvshipsh],robust noconstant\n(sum of wgt is   9.9873e-01)\n\nLinear regression                                      Number of obs =     447\n                                                       F(  4,   443) =       .\n                                                       Prob > F      =  0.0000\n                                                       R-squared     =  0.9998\n                                                       Root MSE      =  .07762\n\n------------------------------------------------------------------------------\n             |               Robust\n     dlpvad1 |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]\n-------------+----------------------------------------------------------------\n       etfp1 |  -1.000041   .0006831 -1463.88   0.000    -1.001384   -.9986986\n       apsh1 |   4.680657   .0157718   296.77   0.000      4.64966    4.711654\n       ansh1 |   5.482807   .0194677   281.64   0.000     5.444547    5.521068\n       aksh1 |   3.952538   .0083407   473.89   0.000     3.936146     3.96893\n------------------------------------------------------------------------------\n\n. \n. regress dlp etfp apsh ansh aksh mshxpr eshxpr [aw=mvshipsh], robust\n(sum of wgt is   9.9873e-01)\n\nLinear regression                                      Number of obs =     447\n                                                       F(  6,   440) =       .\n                                                       Prob > F      =  0.0000\n                                                       R-squared     =  0.9999\n                                                       Root MSE      =   .0262\n\n------------------------------------------------------------------------------\n             |               Robust\n         dlp |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]\n-------------+----------------------------------------------------------------\n        etfp |  -1.000358    .000677 -1477.55   0.000    -1.001689   -.9990273\n        apsh |   4.700013    .011911   394.60   0.000     4.676603    4.723422\n        ansh |   5.443315   .0314405   173.13   0.000     5.381523    5.505107\n        aksh |   3.972308   .0150284   264.32   0.000     3.942772    4.001845\n      mshxpr |   .9974072   .0023115   431.50   0.000     .9928643     1.00195\n      eshxpr |   .9961108   .0057421   173.47   0.000     .9848254    1.007396\n       _cons |   .0010799    .005423     0.20   0.842    -.0095784    .0117382\n------------------------------------------------------------------------------\n\n. \n. log close\n      name:  <unnamed>\n       log:  Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapt\n> er-4\\log_4_3a.log\n  log type:  text\n closed on:  19 Jun 2024, 14:14:44\n----------------------------------------------------------------------------------\n\n. clear\n\n. exit\n\nend of do-file\n```\n\n#### Part B\n\n```stata\nset mem 3m\ncapture log close\nlog using c:\\Empirical_Exercise\\Chapter_4\\log_4_3b.log,replace\n\nuse c:\\Empirical_Exercise\\Chapter_4\\data_Chp4, clear\n\nkeep if year==1990\ndrop if sic72==2067\ndrop if sic72==2794\ndrop if sic72==3483\ngen etfp=ptfp-err\ngen adj1=1/(1-amesh)\ngen etfp1=adj1*etfp\ngen dlpvad1=adj1*dlpvad\ngen apsh1=adj1*apsh\ngen ansh1=adj1*ansh\ngen aksh1=adj1*aksh\ngen t4dlpvad=(dlpvad+etfp)*adj1\npreserve\n\n* Reproduce the first column of Table IV  *\n* generating difference measure of outsourcing *\n\ngen dsimatd1=dsimat1a-dsimat1b\n\n* generating difference measure of high tech share *\n\ngen dhtdsh=dhtsh-dofsh\n\n* check whether we are using the right variable as described in table II *\n\nsum dsimatd1 dhtdsh dofsh [aw=mvshipsh]\n\nregress t4dlpvad dsimat1b dsimatd1 dofsh dhtdsh [aw=mvshipsh], cluster(sic2)\n\n* Reproduce Table V using the coefficients in column(1) of Table IV *\n\ngen wt=mvshipsh^.5\ngen apsh5=apsh1*wt\ngen ansh5=ansh1*wt\ngen aksh5=aksh1*wt\ngen narrout=dsimat1b*wt*_coef[dsimat1b]\ngen diffout=dsimatd1*wt*_coef[dsimatd1]\ngen comsh=dofsh*wt*_coef[dofsh]\ngen difcom=dhtdsh*wt*_coef[dhtdsh]\n\nsum narrout diffout comsh difcom\n\nregress narrout apsh5 ansh5 aksh5, noconstant\nregress diffout apsh5 ansh5 aksh5, noconstant\nregress comsh apsh5 ansh5 aksh5, noconstant\nregress difcom apsh5 ansh5 aksh5, noconstant\n\nrestore\n\n* Reproduce column (2) of Table IV *\n\npreserve\n\n* generating difference measure of outsourcing *\n\ngen dsimatd1=dsimat1a-dsimat1b\n\n* generate difference measure of high tech share with ex ante rental price *\n\ngen dhtdsh1=dhtsh1-dofsh1\n\n* check whether we are using the right variable as described in table II *\n\nsum dsimatd1 dhtdsh1 dofsh1 [aw=mvshipsh]\n\nregress t4dlpvad dsimat1b dsimatd1 dofsh1 dhtdsh1 [aw=mvshipsh], cluster(sic2)\n\n* Reproduce column (3) of Table IV *\n\n* generating difference measure of high tech share *\n\ngen dhtdsh=dhtsh-dofsh\n\nregress t4dlpvad dsimat1b dsimatd1 ci dhtsh [aw=mvshipsh], cluster(sic2)\n\nlog close\nclear\n\nexit\n```\n\nOutput:\n\n```stata\n. set mem 3m\n\nCurrent memory allocation\n\n                    current                                 memory usage\n    settable          value     description                 (1M = 1024k)\n    --------------------------------------------------------------------\n    set maxvar         5000     max. variables allowed           1.909M\n    set memory            3M    max. data space                  3.000M\n    set matsize         100     max. RHS vars in models          0.085M\n                                                            -----------\n                                                                 4.994M\n\n. capture log close\n\n. log using Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapte\n> r-4\\log_4_3b.log,replace\n(note: file Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapte\n> r-4\\log_4_3b.log not found)\n----------------------------------------------------------------------------------\n      name:  <unnamed>\n       log:  Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapt\n> er-4\\log_4_3b.log\n  log type:  text\n opened on:  19 Jun 2024, 14:15:50\n\n. \n. use Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-4\\da\n> ta_Chp4, clear\n(Matrl Cons (72 SIC), 67-92)\n\n. \n. keep if year==1990\n(1350 observations deleted)\n\n. drop if sic72==2067\n(1 observation deleted)\n\n. drop if sic72==2794\n(1 observation deleted)\n\n. drop if sic72==3483\n(1 observation deleted)\n\n. gen etfp=ptfp-err\n\n. gen adj1=1/(1-amesh)\n\n. gen etfp1=adj1*etfp\n\n. gen dlpvad1=adj1*dlpvad\n\n. gen apsh1=adj1*apsh\n\n. gen ansh1=adj1*ansh\n\n. gen aksh1=adj1*aksh\n\n. gen t4dlpvad=(dlpvad+etfp)*adj1\n\n. preserve\n\n. \n. * Reproduce the first column of Table IV  *\n. * generating difference measure of outsourcing *\n. \n. gen dsimatd1=dsimat1a-dsimat1b\n\n. \n. * generating difference measure of high tech share *\n. \n. gen dhtdsh=dhtsh-dofsh\n\n. \n. * check whether we are using the right variable as described in table II *\n. \n. sum dsimatd1 dhtdsh dofsh [aw=mvshipsh]\n\n    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max\n-------------+-----------------------------------------------------------------\n    dsimatd1 |     447  .998730832    .1598317   .3220691  -1.763297   2.735888\n      dhtdsh |     447  .998730832    .1281193   .1962393  -.0841524   .9744269\n       dofsh |     447  .998730832    .1983744    .244483  -.3634307   .8313999\n\n. \n. regress t4dlpvad dsimat1b dsimatd1 dofsh dhtdsh [aw=mvshipsh], cluster(sic2)\n(sum of wgt is   9.9873e-01)\n\nLinear regression                                      Number of obs =     447\n                                                       F(  4,    19) =    5.40\n                                                       Prob > F      =  0.0044\n                                                       R-squared     =  0.1534\n                                                       Root MSE      =  .14521\n\n                                  (Std. Err. adjusted for 20 clusters in sic2)\n------------------------------------------------------------------------------\n             |               Robust\n    t4dlpvad |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]\n-------------+----------------------------------------------------------------\n    dsimat1b |   .0635024    .030585     2.08   0.052    -.0005128    .1275177\n    dsimatd1 |   .0788136   .0472159     1.67   0.111    -.0200103    .1776375\n       dofsh |   .1665693   .0658945     2.53   0.021     .0286505    .3044881\n      dhtdsh |    .075982   .0722494     1.05   0.306    -.0752377    .2272016\n       _cons |   4.262727   .0322917   132.01   0.000      4.19514    4.330314\n------------------------------------------------------------------------------\n\n. \n. * Reproduce Table V using the coefficients in column(1) of Table IV *\n. \n. gen wt=mvshipsh^.5\n\n. gen apsh5=apsh1*wt\n\n. gen ansh5=ansh1*wt\n\n. gen aksh5=aksh1*wt\n\n. gen narrout=dsimat1b*wt*_coef[dsimat1b]\n\n. gen diffout=dsimatd1*wt*_coef[dsimatd1]\n\n. gen comsh=dofsh*wt*_coef[dofsh]\n\n. gen difcom=dhtdsh*wt*_coef[dhtdsh]\n\n. \n. sum narrout diffout comsh difcom\n\n    Variable |       Obs        Mean    Std. Dev.       Min        Max\n-------------+--------------------------------------------------------\n     narrout |       447    .0004107    .0012838  -.0077687   .0131523\n     diffout |       447    .0005548    .0012192  -.0053996   .0156501\n       comsh |       447    .0012452    .0021439  -.0028531   .0110437\n      difcom |       447    .0004038    .0007386  -.0009354   .0064305\n\n. \n. regress narrout apsh5 ansh5 aksh5, noconstant\n\n      Source |       SS       df       MS              Number of obs =     447\n-------------+------------------------------           F(  3,   444) =   52.29\n       Model |  .000211586     3  .000070529           Prob > F      =  0.0000\n    Residual |  .000598861   444  1.3488e-06           R-squared     =  0.2611\n-------------+------------------------------           Adj R-squared =  0.2561\n       Total |  .000810447   447  1.8131e-06           Root MSE      =  .00116\n\n------------------------------------------------------------------------------\n     narrout |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]\n-------------+----------------------------------------------------------------\n       apsh5 |  -.0095155   .0093511    -1.02   0.309    -.0278934    .0088624\n       ansh5 |   .0986666   .0147744     6.68   0.000     .0696303     .127703\n       aksh5 |   .0026378    .003536     0.75   0.456    -.0043116    .0095872\n------------------------------------------------------------------------------\n\n. regress diffout apsh5 ansh5 aksh5, noconstant\n\n      Source |       SS       df       MS              Number of obs =     447\n-------------+------------------------------           F(  3,   444) =   44.65\n       Model |  .000185525     3  .000061842           Prob > F      =  0.0000\n    Residual |  .000615016   444  1.3852e-06           R-squared     =  0.2317\n-------------+------------------------------           Adj R-squared =  0.2266\n       Total |  .000800542   447  1.7909e-06           Root MSE      =  .00118\n\n------------------------------------------------------------------------------\n     diffout |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]\n-------------+----------------------------------------------------------------\n       apsh5 |   .0203644   .0094764     2.15   0.032     .0017403    .0389885\n       ansh5 |   .0628478   .0149723     4.20   0.000     .0334224    .0922732\n       aksh5 |  -.0011399   .0035834    -0.32   0.751    -.0081824    .0059026\n------------------------------------------------------------------------------\n\n. regress comsh apsh5 ansh5 aksh5, noconstant\n\n      Source |       SS       df       MS              Number of obs =     447\n-------------+------------------------------           F(  3,   444) =  153.17\n       Model |  .001395044     3  .000465015           Prob > F      =  0.0000\n    Residual |  .001347998   444  3.0360e-06           R-squared     =  0.5086\n-------------+------------------------------           Adj R-squared =  0.5053\n       Total |  .002743042   447  6.1366e-06           Root MSE      =  .00174\n\n------------------------------------------------------------------------------\n       comsh |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]\n-------------+----------------------------------------------------------------\n       apsh5 |  -.0049722   .0140295    -0.35   0.723    -.0325447    .0226004\n       ansh5 |   .2480141   .0221661    11.19   0.000     .2044505    .2915777\n       aksh5 |   .0007009   .0053051     0.13   0.895    -.0097253    .0111272\n------------------------------------------------------------------------------\n\n. regress difcom apsh5 ansh5 aksh5, noconstant\n\n      Source |       SS       df       MS              Number of obs =     447\n-------------+------------------------------           F(  3,   444) =   68.02\n       Model |  .000099567     3  .000033189           Prob > F      =  0.0000\n    Residual |  .000216627   444  4.8790e-07           R-squared     =  0.3149\n-------------+------------------------------           Adj R-squared =  0.3103\n       Total |  .000316194   447  7.0737e-07           Root MSE      =   .0007\n\n------------------------------------------------------------------------------\n      difcom |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]\n-------------+----------------------------------------------------------------\n       apsh5 |   .0259448   .0056241     4.61   0.000     .0148915     .036998\n       ansh5 |   .0069214   .0088859     0.78   0.436    -.0105422    .0243851\n       aksh5 |   .0043305   .0021267     2.04   0.042     .0001509    .0085102\n------------------------------------------------------------------------------\n\n. \n. restore\n\n. \n. * Reproduce column (2) of Table IV *\n. \n. preserve\n\n. \n. * generating difference measure of outsourcing *\n. \n. gen dsimatd1=dsimat1a-dsimat1b\n\n. \n. * generate difference measure of high tech share with ex ante rental price *\n. \n. gen dhtdsh1=dhtsh1-dofsh1\n\n. \n. * check whether we are using the right variable as described in table II *\n. \n. sum dsimatd1 dhtdsh1 dofsh1 [aw=mvshipsh]\n\n    Variable |     Obs      Weight        Mean   Std. Dev.       Min        Max\n-------------+-----------------------------------------------------------------\n    dsimatd1 |     447  .998730832    .1598317   .3220691  -1.763297   2.735888\n     dhtdsh1 |     447  .998730832    .1643722   .1506561   .0204334   .9001704\n      dofsh1 |     447  .998730832    .0534329    .124323  -.2700591   .3795505\n\n. \n. regress t4dlpvad dsimat1b dsimatd1 dofsh1 dhtdsh1 [aw=mvshipsh], cluster(sic2)\n(sum of wgt is   9.9873e-01)\n\nLinear regression                                      Number of obs =     447\n                                                       F(  4,    19) =    2.42\n                                                       Prob > F      =  0.0844\n                                                       R-squared     =  0.1089\n                                                       Root MSE      =  .14898\n\n                                  (Std. Err. adjusted for 20 clusters in sic2)\n------------------------------------------------------------------------------\n             |               Robust\n    t4dlpvad |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]\n-------------+----------------------------------------------------------------\n    dsimat1b |   .0795164    .034676     2.29   0.033     .0069387    .1520942\n    dsimatd1 |     .11368   .0440198     2.58   0.018     .0215455    .2058144\n      dofsh1 |   .1924159   .1083624     1.78   0.092    -.0343891    .4192209\n     dhtdsh1 |  -.0477944   .0820494    -0.58   0.567    -.2195258    .1239369\n       _cons |   4.294261   .0385949   111.27   0.000     4.213481    4.375041\n------------------------------------------------------------------------------\n\n. \n. * Reproduce column (3) of Table IV *\n. \n. * generating difference measure of high tech share *\n. \n. gen dhtdsh=dhtsh-dofsh\n\n. \n. regress t4dlpvad dsimat1b dsimatd1 ci dhtsh [aw=mvshipsh], cluster(sic2)\n(sum of wgt is   9.9873e-01)\n\nLinear regression                                      Number of obs =     447\n                                                       F(  4,    19) =    5.96\n                                                       Prob > F      =  0.0028\n                                                       R-squared     =  0.2129\n                                                       Root MSE      =  .14002\n\n                                  (Std. Err. adjusted for 20 clusters in sic2)\n------------------------------------------------------------------------------\n             |               Robust\n    t4dlpvad |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]\n-------------+----------------------------------------------------------------\n    dsimat1b |   .0404059   .0295213     1.37   0.187    -.0213829    .1021947\n    dsimatd1 |   .0351687   .0488208     0.72   0.480    -.0670145    .1373518\n          ci |   .0081792   .0045064     1.82   0.085    -.0012528    .0176112\n       dhtsh |    .093074   .0496036     1.88   0.076    -.0107475    .1968955\n       _cons |   4.243861   .0334856   126.74   0.000     4.173775    4.313947\n------------------------------------------------------------------------------\n\n. \n. log close\n      name:  <unnamed>\n       log:  Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapt\n> er-4\\log_4_3b.log\n  log type:  text\n closed on:  19 Jun 2024, 14:15:52\n----------------------------------------------------------------------------------\n\n. clear\n\n. \n. exit\n\nend of do-file\n```\n\n### My code\n\n#### Part A\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Read and transform ----\n\ndatachp4 <- readRDS(fout) %>%\n  filter(year == 1990) %>%\n  filter(!sic72 %in% c(2067, 2794, 3483)) %>%\n  mutate(\n    etfp = ptfp - err,\n    adj1 = 1 / (1 - amesh),\n    etfp1 = adj1 * etfp,\n    dlpvad1 = adj1 * dlpvad,\n    apsh1 = adj1 * apsh,\n    ansh1 = adj1 * ansh,\n    aksh1 = adj1 * aksh,\n    mshxpr = amsh * dlpmx,\n    eshxpr = aosh * dlpe\n  )\n\n# Reproduce Table 4.5 ----\n\ndatachp4 <- datachp4 %>%\n  mutate(dlp34 = dlp - mshxpr - eshxpr)\n\nreg1 <- lm(\n  dlp34 ~ ptfp + apsh + ansh + aksh,\n  data = datachp4,\n  weights = datachp4$mvshipsh\n)\n\n# HC1 is the Stata default\ncoeftest(reg1, vcov = vcovHC(reg1, type = \"HC1\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nt test of coefficients:\n\n             Estimate Std. Error  t value Pr(>|t|)    \n(Intercept) -0.705112   0.300602  -2.3457  0.01943 *  \nptfp        -0.963182   0.070209 -13.7187  < 2e-16 ***\napsh         3.062598   1.221980   2.5063  0.01256 *  \nansh         2.294716   1.430073   1.6046  0.10929    \naksh         7.887571   0.781001  10.0993  < 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n```{.r .cell-code}\n# there is no equivalent to the Stata command \"preserve\" in R\n# therefore, I make a copy of the data and drop the observations\n\ndatachp4_2 <- datachp4 %>%\n  filter(sic72 != 3573)\n\nreg2 <- lm(\n  dlp34 ~ ptfp + apsh + ansh + aksh,\n  data = datachp4_2,\n  weights = datachp4_2$mvshipsh\n)\n\ncoeftest(reg2, vcov = vcovHC(reg2, type = \"HC1\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nt test of coefficients:\n\n             Estimate Std. Error  t value  Pr(>|t|)    \n(Intercept) -0.824927   0.293099  -2.8145  0.005104 ** \nptfp        -0.753115   0.075189 -10.0163 < 2.2e-16 ***\napsh         2.427856   1.162844   2.0879  0.037384 *  \nansh         4.086394   1.722144   2.3729  0.018079 *  \naksh         8.058291   0.941170   8.5620 < 2.2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n```{.r .cell-code}\nreg3 <- lm(\n  dlp ~ apsh + ansh + aksh + mshxpr + eshxpr,\n  data = datachp4_2,\n  weights = datachp4_2$mvshipsh\n)\n\ncoeftest(reg3, vcov = vcovHC(reg3, type = \"HC1\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nt test of coefficients:\n\n            Estimate Std. Error t value  Pr(>|t|)    \n(Intercept) -1.92919    0.91478 -2.1089   0.03552 *  \napsh         3.60528    1.88524  1.9124   0.05648 .  \nansh         6.20267    4.03647  1.5367   0.12510    \naksh         9.53521    2.18722  4.3595 1.625e-05 ***\nmshxpr       1.21930    0.24713  4.9338 1.146e-06 ***\neshxpr      -0.93012    0.91503 -1.0165   0.30995    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n```{.r .cell-code}\nreg4 <- lm(\n  dlpvad1 ~ etfp1 + apsh1 + ansh1 + aksh1 + 0,\n  data = datachp4,\n  weights = datachp4$mvshipsh\n)\n\ncoeftest(reg4, vcov = vcovHC(reg4, type = \"HC1\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nt test of coefficients:\n\n         Estimate  Std. Error  t value  Pr(>|t|)    \netfp1 -1.00004119  0.00068315 -1463.87 < 2.2e-16 ***\napsh1  4.68065661  0.01577181   296.77 < 2.2e-16 ***\nansh1  5.48280782  0.01946769   281.64 < 2.2e-16 ***\naksh1  3.95253801  0.00834071   473.88 < 2.2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n```{.r .cell-code}\n# regress dlp etfp apsh ansh aksh mshxpr eshxpr [aw=mvshipsh], robust\n\nreg5 <- lm(\n  dlp ~ etfp + apsh + ansh + aksh + mshxpr + eshxpr,\n  data = datachp4,\n  weights = datachp4$mvshipsh\n)\n\ncoeftest(reg5, vcov = vcovHC(reg5, type = \"HC1\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nt test of coefficients:\n\n               Estimate  Std. Error    t value Pr(>|t|)    \n(Intercept)  0.00107993  0.00542304     0.1991   0.8422    \netfp        -1.00035789  0.00067704 -1477.5556   <2e-16 ***\napsh         4.70001239  0.01191103   394.5931   <2e-16 ***\nansh         5.44331510  0.03144047   173.1308   <2e-16 ***\naksh         3.97230835  0.01502835   264.3210   <2e-16 ***\nmshxpr       0.99740722  0.00231147   431.5032   <2e-16 ***\neshxpr       0.99611082  0.00574213   173.4741   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n:::\n\n\n#### Part B\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Packages ----\n\nlibrary(tidyr)\n\n# Read and transform ----\n\ndatachp4 <- readRDS(fout) %>%\n  filter(year == 1990) %>%\n  filter(!sic72 %in% c(2067, 2794, 3483)) %>%\n  mutate(\n    etfp = ptfp - err,\n    adj1 = 1 / (1 - amesh),\n    etfp1 = adj1 * etfp,\n    dlpvad1 = adj1 * dlpvad,\n    apsh1 = adj1 * apsh,\n    ansh1 = adj1 * ansh,\n    aksh1 = adj1 * aksh,\n    t4dlpvad = (dlpvad + etfp) * adj1\n  )\n\n# Reproduce the first column of Table IV ----\n\n# generating difference measure of outsourcing\n\ndatachp4_2 <- datachp4 %>%\n  mutate(dsimatd1 = dsimat1a - dsimat1b)\n\n# generating difference measure of high tech share\n\ndatachp4_2 <- datachp4_2 %>%\n  mutate(dhtdsh = dhtsh - dofsh)\n\n# check whether we are using the right variable as described in table II\n\n# sum dsimatd1 dhtdsh dofsh [aw=mvshipsh] is particularly hard to replicate\n\n# function to calculate weighted standard deviation\nweighted.sd <- function(x, w) {\n  sqrt(sum(w * (x - weighted.mean(x, w))^2) / sum(w))\n}\n\ndatachp4_2_1 <- datachp4_2 %>%\n  select(dsimatd1, dhtdsh, dofsh) %>%\n  summarise_all(list(nobs = length, min = min, max = max)) %>%\n  pivot_longer(\n    cols = everything(),\n    names_to = \"variable\",\n    values_to = \"value\"\n  ) %>%\n  separate(variable, into = c(\"var\", \"stat\"), sep = \"_\") %>%\n  pivot_wider(\n    names_from = stat,\n    values_from = value\n  )\n\ndatachp4_2_2 <- datachp4_2 %>%\n  select(dsimatd1, dhtdsh, dofsh, mvshipsh) %>%\n  pivot_longer(\n    cols = c(dsimatd1, dhtdsh, dofsh),\n    names_to = \"var\",\n    values_to = \"val\"\n  ) %>%\n  group_by(var) %>%\n  summarise(sd = weighted.sd(val, mvshipsh))\n\ndatachp4_2_3 <- datachp4_2 %>%\n  summarise(weight = sum(mvshipsh)) %>%\n  bind_cols(var = c(\"dsimatd1\", \"dhtdsh\", \"dofsh\"))\n\ndatachp4_2_4 <- datachp4_2 %>%\n  mutate(across(c(dsimatd1, dhtdsh, dofsh), ~ . * mvshipsh)) %>%\n  select(dsimatd1, dhtdsh, dofsh) %>%\n  summarise_all(list(wsum = sum)) %>%\n  pivot_longer(\n    cols = everything(),\n    names_to = \"variable\",\n    values_to = \"value\"\n  ) %>%\n  separate(variable, into = c(\"var\", \"stat\"), sep = \"_\") %>%\n  pivot_wider(\n    names_from = stat,\n    values_from = value\n  )\n\ndatachp4_2_1 %>%\n  left_join(datachp4_2_2) %>%\n  left_join(datachp4_2_3) %>%\n  left_join(datachp4_2_4)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 3 × 7\n  var       nobs     min   max    sd weight  wsum\n  <chr>    <dbl>   <dbl> <dbl> <dbl>  <dbl> <dbl>\n1 dsimatd1   447 -1.76   2.74  0.322  0.999 0.160\n2 dhtdsh     447 -0.0842 0.974 0.196  0.999 0.128\n3 dofsh      447 -0.363  0.831 0.244  0.999 0.198\n```\n:::\n\n```{.r .cell-code}\nreg1 <- lm(\n  t4dlpvad ~ dsimat1b + dsimatd1 + dofsh + dhtdsh,\n  data = datachp4_2,\n  weights = datachp4_2$mvshipsh\n)\n\ncoeftest(reg1, vcov = vcovCL(reg1, cluster = datachp4_2$sic2))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nt test of coefficients:\n\n            Estimate Std. Error  t value Pr(>|t|)    \n(Intercept) 4.262727   0.032292 132.0067  < 2e-16 ***\ndsimat1b    0.063503   0.030585   2.0763  0.03845 *  \ndsimatd1    0.078814   0.047216   1.6692  0.09578 .  \ndofsh       0.166569   0.065895   2.5278  0.01182 *  \ndhtdsh      0.075982   0.072249   1.0517  0.29353    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n```{.r .cell-code}\n# Reproduce Table V using the coefficients in column(1) of Table IV ----\n\ndatachp4_2 <- datachp4_2 %>%\n  mutate(\n    wt = sqrt(mvshipsh),\n    apsh5 = apsh1 * wt,\n    ansh5 = ansh1 * wt,\n    aksh5 = aksh1 * wt,\n    narrout = dsimat1b * wt * coef(reg1)[\"dsimat1b\"],\n    diffout = dsimatd1 * wt * coef(reg1)[\"dsimatd1\"],\n    comsh = dofsh * wt * coef(reg1)[\"dofsh\"],\n    difcom = dhtdsh * wt * coef(reg1)[\"dhtdsh\"]\n  )\n\ndatachp4_2 %>%\n  select(narrout:difcom) %>%\n  summarise_all(\n    list(nobs = length, mean = mean, sd = sd, min = min, max = max)\n  ) %>%\n  pivot_longer(\n    cols = everything(),\n    names_to = \"variable\",\n    values_to = \"value\"\n  ) %>%\n  separate(variable, into = c(\"var\", \"stat\"), sep = \"_\") %>%\n  pivot_wider(\n    names_from = stat,\n    values_from = value\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 4 × 6\n  var      nobs     mean       sd       min     max\n  <chr>   <dbl>    <dbl>    <dbl>     <dbl>   <dbl>\n1 narrout   447 0.000411 0.00128  -0.00777  0.0132 \n2 diffout   447 0.000555 0.00122  -0.00540  0.0157 \n3 comsh     447 0.00125  0.00214  -0.00285  0.0110 \n4 difcom    447 0.000404 0.000739 -0.000935 0.00643\n```\n:::\n\n```{.r .cell-code}\nreg2 <- lm(\n  narrout ~ apsh5 + ansh5 + aksh5 + 0,\n  data = datachp4_2\n)\n\nsummary(reg2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = narrout ~ apsh5 + ansh5 + aksh5 + 0, data = datachp4_2)\n\nResiduals:\n       Min         1Q     Median         3Q        Max \n-0.0083329 -0.0004728 -0.0002127  0.0000644  0.0119091 \n\nCoefficients:\n       Estimate Std. Error t value Pr(>|t|)    \napsh5 -0.009516   0.009351  -1.018    0.309    \nansh5  0.098667   0.014774   6.678 7.25e-11 ***\naksh5  0.002638   0.003536   0.746    0.456    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.001161 on 444 degrees of freedom\nMultiple R-squared:  0.2611,\tAdjusted R-squared:  0.2561 \nF-statistic: 52.29 on 3 and 444 DF,  p-value: < 2.2e-16\n```\n:::\n\n```{.r .cell-code}\nreg3 <- lm(\n  diffout ~ apsh5 + ansh5 + aksh5 + 0,\n  data = datachp4_2\n)\n\nsummary(reg3)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = diffout ~ apsh5 + ansh5 + aksh5 + 0, data = datachp4_2)\n\nResiduals:\n       Min         1Q     Median         3Q        Max \n-0.0063691 -0.0003192 -0.0000461  0.0003706  0.0133647 \n\nCoefficients:\n       Estimate Std. Error t value Pr(>|t|)    \napsh5  0.020364   0.009476   2.149   0.0322 *  \nansh5  0.062848   0.014972   4.198 3.26e-05 ***\naksh5 -0.001140   0.003583  -0.318   0.7506    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.001177 on 444 degrees of freedom\nMultiple R-squared:  0.2317,\tAdjusted R-squared:  0.2266 \nF-statistic: 44.65 on 3 and 444 DF,  p-value: < 2.2e-16\n```\n:::\n\n```{.r .cell-code}\nreg4 <- lm(\n  comsh ~ apsh5 + ansh5 + aksh5 + 0,\n  data = datachp4_2\n)\n\nsummary(reg4)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = comsh ~ apsh5 + ansh5 + aksh5 + 0, data = datachp4_2)\n\nResiduals:\n       Min         1Q     Median         3Q        Max \n-0.0051922 -0.0009209 -0.0003753  0.0007447  0.0074504 \n\nCoefficients:\n        Estimate Std. Error t value Pr(>|t|)    \napsh5 -0.0049722  0.0140295  -0.354    0.723    \nansh5  0.2480142  0.0221662  11.189   <2e-16 ***\naksh5  0.0007009  0.0053051   0.132    0.895    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.001742 on 444 degrees of freedom\nMultiple R-squared:  0.5086,\tAdjusted R-squared:  0.5053 \nF-statistic: 153.2 on 3 and 444 DF,  p-value: < 2.2e-16\n```\n:::\n\n```{.r .cell-code}\nreg5 <- lm(\n  difcom ~ apsh5 + ansh5 + aksh5 + 0,\n  data = datachp4_2\n)\n\nsummary(reg5)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = difcom ~ apsh5 + ansh5 + aksh5 + 0, data = datachp4_2)\n\nResiduals:\n       Min         1Q     Median         3Q        Max \n-0.0025959 -0.0002751 -0.0000947  0.0001466  0.0058306 \n\nCoefficients:\n      Estimate Std. Error t value Pr(>|t|)    \napsh5 0.025945   0.005624   4.613  5.2e-06 ***\nansh5 0.006921   0.008886   0.779   0.4364    \naksh5 0.004331   0.002127   2.036   0.0423 *  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.0006985 on 444 degrees of freedom\nMultiple R-squared:  0.3149,\tAdjusted R-squared:  0.3103 \nF-statistic: 68.02 on 3 and 444 DF,  p-value: < 2.2e-16\n```\n:::\n\n```{.r .cell-code}\n# Reproduce column (2) of Table IV ----\n\n## generating difference measure of outsourcing\n\ndatachp4 <- datachp4 %>%\n  mutate(dsimatd1 = dsimat1a - dsimat1b)\n\n## generate difference measure of high tech share with ex ante rental price\n\ndatachp4 <- datachp4 %>%\n  mutate(dhtdsh1 = dhtsh1 - dofsh1)\n\n## check whether we are using the right variable as described in table II\n\ndatachp4 %>%\n  select(dsimatd1, dhtdsh1, dofsh1) %>%\n  summarise_all(list(nobs = length, min = min, max = max, sd = sd)) %>%\n  pivot_longer(\n    cols = everything(),\n    names_to = \"variable\",\n    values_to = \"value\"\n  ) %>%\n  separate(variable, into = c(\"var\", \"stat\"), sep = \"_\") %>%\n  pivot_wider(\n    names_from = stat,\n    values_from = value\n  ) %>%\n  left_join(\n    datachp4 %>%\n      summarise(weight = sum(mvshipsh)) %>%\n      bind_cols(var = c(\"dsimatd1\", \"dhtdsh1\", \"dofsh1\"))\n  ) %>%\n  left_join(\n    datachp4 %>%\n      mutate(across(c(dsimatd1, dhtdsh1, dofsh1), ~ . * mvshipsh)) %>%\n      select(dsimatd1, dhtdsh1, dofsh1) %>%\n      summarise_all(list(wsum = sum)) %>%\n      pivot_longer(\n        cols = everything(),\n        names_to = \"variable\",\n        values_to = \"value\"\n      ) %>%\n      separate(variable, into = c(\"var\", \"stat\"), sep = \"_\") %>%\n      pivot_wider(\n        names_from = stat,\n        values_from = value\n      )\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 3 × 7\n  var       nobs     min   max    sd weight   wsum\n  <chr>    <dbl>   <dbl> <dbl> <dbl>  <dbl>  <dbl>\n1 dsimatd1   447 -1.76   2.74  0.340  0.999 0.160 \n2 dhtdsh1    447  0.0204 0.900 0.171  0.999 0.164 \n3 dofsh1     447 -0.270  0.380 0.152  0.999 0.0534\n```\n:::\n\n```{.r .cell-code}\n# regress t4dlpvad dsimat1b dsimatd1 dofsh1 dhtdsh1 [aw=mvshipsh], cluster(sic2)\n\nreg2 <- lm(\n  t4dlpvad ~ dsimat1b + dsimatd1 + dofsh1 + dhtdsh1,\n  data = datachp4,\n  weights = datachp4$mvshipsh\n)\n\ncoeftest(reg2, vcov = vcovCL(reg2, cluster = datachp4$sic2))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nt test of coefficients:\n\n             Estimate Std. Error  t value Pr(>|t|)    \n(Intercept)  4.294261   0.038595 111.2650  < 2e-16 ***\ndsimat1b     0.079517   0.034676   2.2931  0.02231 *  \ndsimatd1     0.113680   0.044020   2.5825  0.01013 *  \ndofsh1       0.192416   0.108362   1.7757  0.07647 .  \ndhtdsh1     -0.047795   0.082049  -0.5825  0.56052    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n```{.r .cell-code}\n# Reproduce column (3) of Table IV ----\n\n## generating difference measure of high tech share\n\ndatachp4 <- datachp4 %>%\n  mutate(dhtdsh = dhtsh - dofsh)\n\nreg3 <- lm(\n  t4dlpvad ~ dsimat1b + dsimatd1 + ci + dhtsh,\n  data = datachp4,\n  weights = datachp4$mvshipsh\n)\n\ncoeftest(reg3, vcov = vcovCL(reg3, cluster = datachp4$sic2))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nt test of coefficients:\n\n             Estimate Std. Error  t value Pr(>|t|)    \n(Intercept) 4.2438613  0.0334856 126.7368  < 2e-16 ***\ndsimat1b    0.0404060  0.0295213   1.3687  0.17179    \ndsimatd1    0.0351687  0.0488208   0.7204  0.47168    \nci          0.0081792  0.0045064   1.8150  0.07020 .  \ndhtsh       0.0930741  0.0496036   1.8764  0.06126 .  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n:::\n",
    "supporting": [
      "chapter4_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}