{
  "hash": "47c61e528682963125af871fd164b067",
  "result": {
    "markdown": "\n# Chapter 2. The Heckscher-Ohlin Model\n\nIn these exercises, you will reproduce some of the empirical results from Trefler (1993, 1995).  To complete the exercise, the Excel file `hov_pub.csv` should be stored in the directory `Chapter-2`. After this, run the STATA program `hov_pub.do`, which will create a new STATA data file `trefler.dta`.\n\n## Read and transform the data\n\n### Feenstra's code\n\n```stata\n* This is to read the data into Stata *\n\nset mem 30m\n* insheet using Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-2\\trefler.csv *\ninsheet using \"Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-2\\hov_pub.csv\"\nrename v1 country\nrename v2 factor\nrename v3 AT\nrename v4 V\nrename v5 Y\nrename v6 B\nrename v7 YPC\nrename v8 POP\n\n* create country index *\nquietly summarize YPC\nlocal maxYPC=_result(6)\ngen ratio=YPC/`maxYPC'\nreplace ratio=ratio+0.0001 if country==\"Italy\"\n\nsort ratio\negen indexc=group(ratio)\n\n* create factor index *\nsort factor\negen indexf=group(factor)\n\n* include delta *\n\ngen delta=1\nreplace delta=0.03 if country==\"Bangladesh\"\nreplace delta=0.09 if country==\"Pakistan\"\nreplace delta=0.10 if country==\"Indonesia\"\nreplace delta=0.09 if country==\"Sri Lanka\"\nreplace delta=0.17 if country==\"Thailand\"\nreplace delta=0.16 if country==\"Colombia\"\nreplace delta=0.28 if country==\"Panama\"\nreplace delta=0.29 if country==\"Yugoslavia\"\nreplace delta=0.14 if country==\"Portugal\"\nreplace delta=0.11 if country==\"Uruguay\"\nreplace delta=0.45 if country==\"Greece\"\nreplace delta=0.55 if country==\"Ireland\"\nreplace delta=0.42 if country==\"Spain\"\nreplace delta=0.49 if country==\"Israel\"\nreplace delta=0.40 if country==\"Hong Kong\"\nreplace delta=0.38 if country==\"New Zealand\"\nreplace delta=0.60 if country==\"Austria\"\nreplace delta=0.48 if country==\"Singapore\"\nreplace delta=0.60 if country==\"Italy\"\nreplace delta=0.58 if country==\"UK\"\nreplace delta=0.70 if country==\"Japan\"\nreplace delta=0.65 if country==\"Belgium\"\nreplace delta=0.47 if country==\"Trinidad\"\nreplace delta=0.72 if country==\"Netherlands\"\nreplace delta=0.65 if country==\"Finland\"\nreplace delta=0.73 if country==\"Denmark\"\nreplace delta=0.78 if country==\"West Germany\"\nreplace delta=0.74 if country==\"France\"\nreplace delta=0.57 if country==\"Sweden\"\nreplace delta=0.69 if country==\"Norway\"\nreplace delta=0.79 if country==\"Switzerland\"\nreplace delta=0.55 if country==\"Canada\"\nreplace delta=1 if country==\"USA\"\n\ncompress\n\nlabel var country \"Name of the country\"\nlabel var factor \"Name of the factor\"\nlabel var AT \"Factor content of trade F=A*T\"\nlabel var V \"Endowment\"\nlabel var Y \"GDP, World Bank, y=p*Q\"\nlabel var B \"Trade balance, World Bank b=p*T\"\nlabel var YPC \"GDP per capita, PWT\"\nlabel var indexc \"Country indentifier\"\nlabel var indexf \"Factor Indentifier\"\n\n* save Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-2\\trefler,replace *\nsave \"Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-2\\trefler\", replace\n\nexit\n```\n\nOutput:\n\n```stata\n. * This is to read the data into Stata *\n. set mem 30m\n\nCurrent memory allocation\n\n                    current                                 memory usage\n    settable          value     description                 (1M = 1024k)\n    --------------------------------------------------------------------\n    set maxvar         5000     max. variables allowed           1.909M\n    set memory           30M    max. data space                 30.000M\n    set matsize         400     max. RHS vars in models          1.254M\n                                                            -----------\n                                                                33.163M\n\n. insheet using Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Ch\n> apter-2\\hov_pub.csv\n(8 vars, 297 obs)\n\n. rename v1 country\n\n. rename v2 factor\n\n. rename v3 AT\n\n. rename v4 V\n\n. rename v5 Y\n\n. rename v6 B\n\n. rename v7 YPC\n\n. rename v8 POP\n\n. \n. * create country index *\n. quietly summarize YPC\n\n. local maxYPC=_result(6)\n\n. gen ratio=YPC/`maxYPC'\n\n. replace ratio=ratio+0.0001 if country==\"Italy\"\n(9 real changes made)\n\n. \n. sort ratio\n\n. egen indexc=group(ratio)\n\n. \n. * create factor index *\n. sort factor\n\n. egen indexf=group(factor)\n\n. \n. * include delta *\n. \n. gen delta=1\n\n. replace delta=0.03 if country==\"Bangladesh\"\n(9 real changes made)\n\n. replace delta=0.09 if country==\"Pakistan\"\n(9 real changes made)\n\n. replace delta=0.10 if country==\"Indonesia\"\n(9 real changes made)\n\n. replace delta=0.09 if country==\"Sri Lanka\"\n(9 real changes made)\n\n. replace delta=0.17 if country==\"Thailand\"\n(9 real changes made)\n\n. replace delta=0.16 if country==\"Colombia\"\n(9 real changes made)\n\n. replace delta=0.28 if country==\"Panama\"\n(9 real changes made)\n\n. replace delta=0.29 if country==\"Yugoslavia\"\n(9 real changes made)\n\n. replace delta=0.14 if country==\"Portugal\"\n(9 real changes made)\n\n. replace delta=0.11 if country==\"Uruguay\"\n(9 real changes made)\n\n. replace delta=0.45 if country==\"Greece\"\n(9 real changes made)\n\n. replace delta=0.55 if country==\"Ireland\"\n(9 real changes made)\n\n. replace delta=0.42 if country==\"Spain\"\n(9 real changes made)\n\n. replace delta=0.49 if country==\"Israel\"\n(9 real changes made)\n\n. replace delta=0.40 if country==\"Hong Kong\"\n(9 real changes made)\n\n. replace delta=0.38 if country==\"New Zealand\"\n(9 real changes made)\n\n. replace delta=0.60 if country==\"Austria\"\n(9 real changes made)\n\n. replace delta=0.48 if country==\"Singapore\"\n(9 real changes made)\n\n. replace delta=0.60 if country==\"Italy\"\n(9 real changes made)\n\n. replace delta=0.58 if country==\"UK\"\n(9 real changes made)\n\n. replace delta=0.70 if country==\"Japan\"\n(9 real changes made)\n\n. replace delta=0.65 if country==\"Belgium\"\n(9 real changes made)\n\n. replace delta=0.47 if country==\"Trinidad\"\n(9 real changes made)\n\n. replace delta=0.72 if country==\"Netherlands\"\n(9 real changes made)\n\n. replace delta=0.65 if country==\"Finland\"\n(9 real changes made)\n\n. replace delta=0.73 if country==\"Denmark\"\n(9 real changes made)\n\n. replace delta=0.78 if country==\"West Germany\"\n(9 real changes made)\n\n. replace delta=0.74 if country==\"France\"\n(9 real changes made)\n\n. replace delta=0.57 if country==\"Sweden\"\n(9 real changes made)\n\n. replace delta=0.69 if country==\"Norway\"\n(9 real changes made)\n\n. replace delta=0.79 if country==\"Switzerland\"\n(9 real changes made)\n\n. replace delta=0.55 if country==\"Canada\"\n(9 real changes made)\n\n. replace delta=1 if country==\"USA\"\n(0 real changes made)\n\n. \n. compress\nYPC was float now int\nindexc was float now byte\nindexf was float now byte\n\n. \n. label var country \"Name of the country\"\n\n. label var factor \"Name of the factor\"\n\n. label var AT \"Factor content of trade F=A*T\"\n\n. label var V \"Endowment\"\n\n. label var Y \"GDP, World Bank, y=p*Q\"\n\n. label var B \"Trade balance, World Bank b=p*T\"\n\n. label var YPC \"GDP per capita, PWT\"\n\n. label var indexc \"Country indentifier\"\n\n. label var indexf \"Factor Indentifier\"\n\n. \n. save Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-2\\t\n> refler,replace\nfile Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-2\\tre\n> fler.dta saved\n\n. \n. exit\n\nend of do-file\n```\n\n### My code\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Packages ----\n\nlibrary(archive)\nlibrary(readr)\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(purrr)\nlibrary(knitr)\n\n# Extract ----\n\nfzip <- \"first-edition/Chapter-2.zip\"\ndout <- gsub(\"\\\\.zip$\", \"\", fzip)\n\nif (!dir.exists(dout)) {\n  archive_extract(fzip, dir = dout)\n}\n\n# Read ----\n\nfout <- paste0(dout, \"/trefler.rds\")\nfout2 <- paste0(dout, \"/trefler_desc.rds\")\n\nif (!file.exists(fout)) {\n  trefler <- read_csv(\"first-edition/Chapter-2/hov_pub.csv\", col_names = F) %>%\n    rename(\n      country = X1,\n      factor = X2,\n      at = X3,\n      v = X4,\n      y = X5,\n      b = X6,\n      ypc = X7,\n      pop = X8\n    )\n\n  # Transform ----\n\n  # see https://www.stata.com/manuals/rsummarize.pdf\n  # https://www.stata.com/manuals/degen.pdf\n  # https://www.stata.com/manuals/degen.pdf\n\n  # Create an auxiliary table for delta values\n  delta_values <- tibble(\n    country = c(\n      \"Bangladesh\", \"Pakistan\", \"Indonesia\", \"Sri Lanka\", \"Thailand\",\n      \"Colombia\", \"Panama\", \"Yugoslavia\", \"Portugal\", \"Uruguay\", \"Greece\",\n      \"Ireland\", \"Spain\", \"Israel\", \"Hong Kong\", \"New Zealand\", \"Austria\",\n      \"Singapore\", \"Italy\", \"UK\", \"Japan\", \"Belgium\", \"Trinidad\", \"Netherlands\",\n      \"Finland\", \"Denmark\", \"West Germany\", \"France\", \"Sweden\", \"Norway\",\n      \"Switzerland\", \"Canada\", \"USA\"\n    ),\n    delta = c(\n      0.03, 0.09, 0.10, 0.09, 0.17, 0.16, 0.28, 0.29, 0.14, 0.11, 0.45,\n      0.55, 0.42, 0.49, 0.40, 0.38, 0.60, 0.48, 0.60, 0.58, 0.70, 0.65, 0.47,\n      0.72, 0.65, 0.73, 0.78, 0.74, 0.57, 0.69, 0.79, 0.55, 1\n    )\n  )\n\n  trefler <- trefler %>%\n    mutate(ypc_max = max(ypc)) %>%\n    mutate(\n      ratio = case_when(\n        country != \"Italy\" ~ ypc / ypc_max,\n        country == \"Italy\" ~ (ypc / ypc_max) + 0.0001\n      )\n    ) %>%\n    select(-ypc_max) %>%\n    arrange(ratio) %>%\n    group_by(ratio) %>%\n    mutate(indexc = cur_group_id()) %>%\n    group_by(factor) %>%\n    mutate(indexf = cur_group_id()) %>%\n    ungroup() %>%\n    left_join(delta_values)\n\n  # Labels ----\n\n  # Create a separate table with the variables description\n\n  trefler_desc <- tibble(\n    variable = c(\n      \"country\", \"factor\", \"at\", \"v\", \"y\", \"b\", \"ypc\", \"indexc\",\n      \"indexf\"\n    ),\n    description = c(\n      \"Name of the country\", \"Name of the factor\",\n      \"Factor content of trade F=A*T\", \"Endowment\", \"GDP, World Bank, y=p*Q\",\n      \"Trade balance, World Bank b=p*T\", \"GDP per capita, PWT\",\n      \"Country indentifier\", \"Factor Indentifier\"\n    )\n  )\n\n  # Save ----\n\n  saveRDS(trefler, fout)\n  saveRDS(trefler_desc, fout2)\n} else {\n  trefler <- readRDS(fout)\n  trefler_desc <- readRDS(fout2)\n}\n```\n:::\n\n\n## Exercise 1  \n\nGiven identical technologies across countries, run the program `sign_rank_1.do` to conduct the sign test, rank test, and test for missing trade. Use the results in `sign_rank_1.log` to replicate columns (2) and (4) in Table 2.5.\n\n### Feenstra's code\n\n```stata\n* This program is to conduct sign test, Rank test and Missing trade test *\n\ncapture log close\n* log using Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-2\\sign_rank_1.log, replace *\nlog using \"Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-2\\sign_rank_1.log\", replace\n\nset mem 30m\n\n* use Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-2\\trefler, clear *\nuse \"Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-2\\trefler\", clear\n\n* number of country in the dataset *\negen C=max(indexc)\negen F=max(indexf)\n\n* Calculate the world level of Yw, Bw and Vw *\negen Yww=sum(Y)\ngen Yw=Yww/F\negen Bww=sum(B)\ngen Bw=Bww/F\negen Vfw=sum(V), by(indexf)\n\n* Calculate country share Sc *\ngen Sc=(Y-B)/(Yw-Bw)\n\n* Calculate epsilon(fc) and sigma^2(f) according to eq.2 in Trefler (1995)*\ngen Efc=AT-(V-Sc*Vfw)\n\n* Construct the average epsilon for a given factor *\negen total=sum(Efc),by(indexf)\ngen ave=total/C\n\n* Construct sigma^2 and the weight *\n\negen tot=sum((Efc-ave)^2), by(indexf)\ngen sigma2f=tot/(C-1)\n\ncodebook sigma2f\ngen sigmaf=sqrt(sigma2f)\ngen weight=sigmaf*sqrt(Sc)\n\n* Using the weight, convert all the data *\n\ngen trAT=AT/(sigmaf*sqrt(Sc))\ngen trV=V/(sigmaf*sqrt(Sc))\ngen trY=Y/sqrt(Sc)\ngen trB=B/sqrt(Sc)\ngen trVfw=Vfw/sigmaf\n\ngen AThat=trV-Sc*trVfw\ngen AThat2=(V-Sc*Vfw)/weight\n\n* Correlation, should be .28 *\n\ncorr trAT AThat2\n\n*************\n* Sign Test *\n*************\n\nsort indexc\nby indexc: count if trAT*AThat2>0\n\ncount if trAT*AThat2>0\ndisplay _result(1)/_N\n\n*****************\n* Missing Trade *\n*****************\n\n* Checking for the missing trade, should be .032 *\n\nquietly summarize trAT\nlocal varAT=_result(4)\nquietly summarize AThat\nlocal varHat=_result(4)\nquietly summarize AThat2\nlocal varHat2=_result(4)\ndisplay `varAT'/`varHat'\ndisplay `varAT'/`varHat2'\n\n**************\n* Rank Tests *\n**************\n\nkeep country indexc indexf trAT AThat2\n\nsort indexc indexf\nreshape wide trAT AThat2, i(indexc) j(indexf)\n\nlocal i=1\nwhile `i'<9{\n\tlocal j=`i'+1\n\twhile `j'<=9{\n\t\tgen rank`i'`j'=((trAT`i'-trAT`j')*(AThat2`i'-AThat2`j')>0)\n\t\tlocal j=`j'+1\n\t}\n\tlocal i=`i'+1\n}\n\nkeep country indexc rank*\nreshape long rank, i(indexc) j(factor)\negen r1=sum(rank), by(indexc)\ngen r2=r1/36\ncollapse r2,by(indexc country)\nsum r2\nlist\n\nlog close\nexit\n```\n\nOutput:\n\n```stata\n. * This program is to conduct sign test, Rank test and Missing trade test *\n. \n. capture log close\n\n. log using Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapte\n> r-2\\sign_rank_1.log, replace\n----------------------------------------------------------------------------------\n      name:  <unnamed>\n       log:  Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapt\n> er-2\\sign_rank_1.log\n  log type:  text\n opened on:  19 Jun 2024, 15:29:23\n\n. \n. set mem 30m\n\nCurrent memory allocation\n\n                    current                                 memory usage\n    settable          value     description                 (1M = 1024k)\n    --------------------------------------------------------------------\n    set maxvar         5000     max. variables allowed           1.909M\n    set memory           30M    max. data space                 30.000M\n    set matsize         400     max. RHS vars in models          1.254M\n                                                            -----------\n                                                                33.163M\n\n. \n. use Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-2\\tr\n> efler, clear\n\n. \n. * number of country in the dataset *\n. egen C=max(indexc)\n\n. egen F=max(indexf)\n\n. \n. * Calculate the world level of Yw, Bw and Vw *\n. egen Yww=sum(Y)\n\n. gen Yw=Yww/F\n\n. egen Bww=sum(B)\n\n. gen Bw=Bww/F\n\n. egen Vfw=sum(V), by(indexf)\n\n. \n. * Calculate country share Sc *\n. gen Sc=(Y-B)/(Yw-Bw)\n\n. \n. * Calculate epsilon(fc) and sigma^2(f) according to eq.2 in Trefler (1995)*\n. gen Efc=AT-(V-Sc*Vfw)\n\n. \n. * Construct the average epsilon for a given factor *\n. egen total=sum(Efc),by(indexf)\n\n. gen ave=total/C\n\n. \n. * Construct sigma^2 and the weight *\n. \n. egen tot=sum((Efc-ave)^2), by(indexf)\n\n. gen sigma2f=tot/(C-1)\n\n. \n. codebook sigma2f\n\n----------------------------------------------------------------------------------\nsigma2f                                                                (unlabeled)\n----------------------------------------------------------------------------------\n\n                  type:  numeric (float)\n\n                 range:  [98198290,7.112e+22]         units:  10\n         unique values:  9                        missing .:  0/297\n\n            tabulation:  Freq.  Value\n                            33  98198288\n                            33  2.419e+08\n                            33  7.455e+11\n                            33  9.191e+11\n                            33  1.210e+12\n                            33  4.383e+12\n                            33  2.106e+13\n                            33  1.009e+14\n                            33  7.112e+22\n\n. gen sigmaf=sqrt(sigma2f)\n\n. gen weight=sigmaf*sqrt(Sc)\n\n. \n. * Using the weight, convert all the data *\n. \n. gen trAT=AT/(sigmaf*sqrt(Sc))\n\n. gen trV=V/(sigmaf*sqrt(Sc))\n\n. gen trY=Y/sqrt(Sc)\n\n. gen trB=B/sqrt(Sc)\n\n. gen trVfw=Vfw/sigmaf\n\n. \n. gen AThat=trV-Sc*trVfw\n\n. gen AThat2=(V-Sc*Vfw)/weight\n\n. \n. * Correlation, should be .28 *\n. \n. corr trAT AThat2\n(obs=297)\n\n             |     trAT   AThat2\n-------------+------------------\n        trAT |   1.0000\n      AThat2 |   0.2823   1.0000\n\n\n. \n. *************\n. * Sign Test *\n. *************\n. \n. sort indexc\n\n. by indexc: count if trAT*AThat2>0\n\n----------------------------------------------------------------------------------\n-> indexc = 1\n    3\n----------------------------------------------------------------------------------\n-> indexc = 2\n    3\n----------------------------------------------------------------------------------\n-> indexc = 3\n    2\n----------------------------------------------------------------------------------\n-> indexc = 4\n    2\n----------------------------------------------------------------------------------\n-> indexc = 5\n    2\n----------------------------------------------------------------------------------\n-> indexc = 6\n    3\n----------------------------------------------------------------------------------\n-> indexc = 7\n    3\n----------------------------------------------------------------------------------\n-> indexc = 8\n    5\n----------------------------------------------------------------------------------\n-> indexc = 9\n    2\n----------------------------------------------------------------------------------\n-> indexc = 10\n    9\n----------------------------------------------------------------------------------\n-> indexc = 11\n    1\n----------------------------------------------------------------------------------\n-> indexc = 12\n    6\n----------------------------------------------------------------------------------\n-> indexc = 13\n    2\n----------------------------------------------------------------------------------\n-> indexc = 14\n    6\n----------------------------------------------------------------------------------\n-> indexc = 15\n    6\n----------------------------------------------------------------------------------\n-> indexc = 16\n    4\n----------------------------------------------------------------------------------\n-> indexc = 17\n    5\n----------------------------------------------------------------------------------\n-> indexc = 18\n    5\n----------------------------------------------------------------------------------\n-> indexc = 19\n    6\n----------------------------------------------------------------------------------\n-> indexc = 20\n    6\n----------------------------------------------------------------------------------\n-> indexc = 21\n    7\n----------------------------------------------------------------------------------\n-> indexc = 22\n    6\n----------------------------------------------------------------------------------\n-> indexc = 23\n    6\n----------------------------------------------------------------------------------\n-> indexc = 24\n    4\n----------------------------------------------------------------------------------\n-> indexc = 25\n    3\n----------------------------------------------------------------------------------\n-> indexc = 26\n    4\n----------------------------------------------------------------------------------\n-> indexc = 27\n    5\n----------------------------------------------------------------------------------\n-> indexc = 28\n    3\n----------------------------------------------------------------------------------\n-> indexc = 29\n    4\n----------------------------------------------------------------------------------\n-> indexc = 30\n    4\n----------------------------------------------------------------------------------\n-> indexc = 31\n    8\n----------------------------------------------------------------------------------\n-> indexc = 32\n    5\n----------------------------------------------------------------------------------\n-> indexc = 33\n    8\n\n. \n. count if trAT*AThat2>0\n  148\n\n. display _result(1)/_N\n.4983165\n\n. \n. *****************\n. * Missing Trade *\n. *****************\n. \n. * Checking for the missing trade, should be .032 *\n. \n. quietly summarize trAT\n\n. local varAT=_result(4)\n\n. quietly summarize AThat\n\n. local varHat=_result(4)\n\n. quietly summarize AThat2\n\n. local varHat2=_result(4)\n\n. display `varAT'/`varHat'\n.03375119\n\n. display `varAT'/`varHat2'\n.031999\n\n. \n. **************\n. * Rank Tests *\n. **************\n. \n. keep country indexc indexf trAT AThat2\n\n. \n. sort indexc indexf\n\n. reshape wide trAT AThat2, i(indexc) j(indexf)\n(note: j = 1 2 3 4 5 6 7 8 9)\n\nData                               long   ->   wide\n-----------------------------------------------------------------------------\nNumber of obs.                      297   ->      33\nNumber of variables                   5   ->      20\nj variable (9 values)            indexf   ->   (dropped)\nxij variables:\n                                   trAT   ->   trAT1 trAT2 ... trAT9\n                                 AThat2   ->   AThat21 AThat22 ... AThat29\n-----------------------------------------------------------------------------\n\n. \n. local i=1\n\n. while `i'<9{\n  2.         local j=`i'+1\n  3.         while `j'<=9{\n  4.                 gen rank`i'`j'=((trAT`i'-trAT`j')*(AThat2`i'-AThat2`j')>0)\n  5.                 local j=`j'+1\n  6.         }\n  7.         local i=`i'+1\n  8. }\n\n. \n. keep country indexc rank*\n\n. reshape long rank, i(indexc) j(factor)\n(note: j = 12 13 14 15 16 17 18 19 23 24 25 26 27 28 29 34 35 36 37 38 39 45 46 47\n>  48 49 56 57 58 59 67 68 69 78 79 89)\n\nData                               wide   ->   long\n-----------------------------------------------------------------------------\nNumber of obs.                       33   ->    1188\nNumber of variables                  38   ->       4\nj variable (36 values)                    ->   factor\nxij variables:\n               rank12 rank13 ... rank89   ->   rank\n-----------------------------------------------------------------------------\n\n. egen r1=sum(rank), by(indexc)\n\n. gen r2=r1/36\n\n. collapse r2,by(indexc country)\n\n. sum r2\n\n    Variable |       Obs        Mean    Std. Dev.       Min        Max\n-------------+--------------------------------------------------------\n          r2 |        33    .6026936    .1721445   .0833333   .9166667\n\n. list\n\n     +----------------------------------+\n     | indexc        country         r2 |\n     |----------------------------------|\n  1. |      1     Bangladesh        .75 |\n  2. |      2       Pakistan   .7222222 |\n  3. |      3      Indonesia   .6666667 |\n  4. |      4      Sri Lanka   .4166667 |\n  5. |      5       Thailand   .6944444 |\n     |----------------------------------|\n  6. |      6       Colombia   .8055556 |\n  7. |      7         Panama   .5555556 |\n  8. |      8     Yugoslavia   .4444444 |\n  9. |      9       Portugal   .5277778 |\n 10. |     10        Uruguay   .7222222 |\n     |----------------------------------|\n 11. |     11         Greece   .4722222 |\n 12. |     12        Ireland   .5277778 |\n 13. |     13          Spain   .3888889 |\n 14. |     14         Israel   .3888889 |\n 15. |     15      Hong Kong   .8333333 |\n     |----------------------------------|\n 16. |     16    New Zealand   .5277778 |\n 17. |     17        Austria   .5277778 |\n 18. |     18      Singapore   .6111111 |\n 19. |     19          Italy   .7777778 |\n 20. |     20             UK   .5833333 |\n     |----------------------------------|\n 21. |     21          Japan   .7777778 |\n 22. |     22        Belgium   .6111111 |\n 23. |     23       Trinidad         .5 |\n 24. |     24    Netherlands   .5277778 |\n 25. |     25        Finland   .4722222 |\n     |----------------------------------|\n 26. |     26        Denmark   .5277778 |\n 27. |     27   West Germany   .8055556 |\n 28. |     28         France   .0833333 |\n 29. |     29         Sweden   .6666667 |\n 30. |     30         Norway   .6111111 |\n     |----------------------------------|\n 31. |     31    Switzerland   .5555556 |\n 32. |     32         Canada   .8888889 |\n 33. |     33            USA   .9166667 |\n     +----------------------------------+\n\n. \n. log close\n      name:  <unnamed>\n       log:  Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapt\n> er-2\\sign_rank_1.log\n  log type:  text\n closed on:  19 Jun 2024, 15:29:31\n----------------------------------------------------------------------------------\n\n. exit\n\nend of do-file\n```\n\n### My code\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Transform ----\n\ntrefler <- readRDS(fout) %>%\n  # Number of country in the dataset\n  mutate(\n    c = max(indexc),\n    f = max(indexf)\n  ) %>%\n  # Calculate the world level of Yw, Bw and Vw\n  mutate(\n    yww = sum(y),\n    yw = yww / f,\n    bww = sum(b),\n    bw = bww / f\n  ) %>%\n  group_by(indexf) %>%\n  mutate(\n    vfw = sum(v)\n  ) %>%\n  ungroup() %>%\n  # Calculate country share Sc\n  mutate(\n    sc = (y - b) / (yw - bw)\n  ) %>%\n  # Calculate epsilon(fc) and sigma^2(f) according to eq.2 in Trefler (1995)\n  mutate(\n    efc = at - (v - sc * vfw)\n  ) %>%\n  # Construct the average epsilon for a given factor\n  group_by(indexf) %>%\n  mutate(ave = sum(efc) / c) %>%\n  # Construct sigma^2 and the weight\n  mutate(\n    sigma2f = sum((efc - ave)^2) / (c - 1),\n    sigmaf = sqrt(sigma2f),\n    weight = sigmaf * sqrt(sc)\n  ) %>%\n  ungroup() %>%\n  # Using the weight, convert all the data\n  mutate(\n    trat = at / (sigmaf * sqrt(sc)),\n    athat2 = (v - (sc * vfw)) / weight\n  ) %>%\n  arrange(country)\n\n# Correlation, should be .28\ntrefler %>%\n  select(trat, athat2) %>%\n  cor()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n            trat    athat2\ntrat   1.0000000 0.2822883\nathat2 0.2822883 1.0000000\n```\n:::\n\n```{.r .cell-code}\n# Sign Test ----\n\ntrefler %>%\n  group_by(country, indexc) %>%\n  summarize(\n    p = sum(trat * athat2 > 0) / n()\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 33 × 3\n# Groups:   country [33]\n   country    indexc     p\n   <chr>       <int> <dbl>\n 1 Austria        17 0.556\n 2 Bangladesh      1 0.333\n 3 Belgium        22 0.667\n 4 Canada         32 0.556\n 5 Colombia        6 0.333\n 6 Denmark        26 0.444\n 7 Finland        25 0.333\n 8 France         28 0.333\n 9 Greece         11 0.111\n10 Hong Kong      15 0.667\n# ℹ 23 more rows\n```\n:::\n\n```{.r .cell-code}\ntrefler %>%\n  summarize(\n    p = sum(trat * athat2 > 0) / n()\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 × 1\n      p\n  <dbl>\n1 0.498\n```\n:::\n\n```{.r .cell-code}\n# Missing Trade ----\n\n# Checking for the missing trade, should be .032\n\ntrefler %>%\n  summarize(\n    varat = var(trat),\n    varhat2 = var(athat2)\n  ) %>%\n  mutate(\n    varat_varhat2 = varat / varhat2\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 × 3\n  varat varhat2 varat_varhat2\n  <dbl>   <dbl>         <dbl>\n1  1.61    50.3        0.0320\n```\n:::\n\n```{.r .cell-code}\n# Rank Tests ----\n\ntrefler_wide <- trefler %>%\n  select(country, indexc, indexf, trat, athat2) %>%\n  arrange(indexc, indexf) %>%\n  pivot_wider(\n    names_from = indexf,\n    values_from = c(trat, athat2)\n  )\n\n# This would be too long\n# trefler_wide <- trefler_wide %>%\n#   mutate(\n#     rank12 = (trat_1 - trat_2) * (athat2_1 - athat2_2) > 0,\n#     rank13 = (trat_1 - trat_3) * (athat2_1 - athat2_3) > 0,\n#     ...\n#     rank89 = (trat_8 - trat_9) * (athat2_8 - athat2_9) > 0,\n#   )\n\n# create all relevant trat_1 - trat_2, trat_1 - trat_3, etc.\n\nranks <- expand_grid(\n  x = 1:8,\n  y = 1:9\n) %>%\n  filter(x < y)\n\n# The syntax here is based on internal R developer functions, but these\n# allow to create columns with minimal lines of code and avoids more complicated\n# bracket syntax\ntrefler_rank <- map2_df(\n  pull(ranks, x),\n  pull(ranks, y),\n  function(x, y) {\n    trefler_wide %>%\n      mutate(\n        name = paste0(\"rank\", x, y),\n        value = (!!sym(paste0(\"trat_\", x)) - !!sym(paste0(\"trat_\", y))) *\n          (!!sym(paste0(\"athat2_\", x)) - !!sym(paste0(\"athat2_\", y))) > 0\n      ) %>%\n      select(country, indexc, name, value)\n  }\n) %>%\n  group_by(country, indexc) %>%\n  summarise(r1 = sum(value)) %>%\n  mutate(r2 = r1 / 36)\n\ntrefler_rank\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 33 × 4\n# Groups:   country [33]\n   country    indexc    r1     r2\n   <chr>       <int> <int>  <dbl>\n 1 Austria        17    19 0.528 \n 2 Bangladesh      1    27 0.75  \n 3 Belgium        22    22 0.611 \n 4 Canada         32    32 0.889 \n 5 Colombia        6    29 0.806 \n 6 Denmark        26    19 0.528 \n 7 Finland        25    17 0.472 \n 8 France         28     3 0.0833\n 9 Greece         11    17 0.472 \n10 Hong Kong      15    30 0.833 \n# ℹ 23 more rows\n```\n:::\n\n```{.r .cell-code}\ntrefler_rank %>%\n  pull(r2) %>%\n  mean()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.6026936\n```\n:::\n:::\n\n\n### Extra step: formatting the table\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntrefler %>%\n  group_by(country, indexc) %>%\n  summarize(\n    p = sum(trat * athat2 > 0) / n()\n  ) %>%\n  arrange(indexc) %>% # same order as in the book\n  select(country, sign_hov = p) %>%\n  left_join(\n    trefler_rank %>%\n      select(country, rank_hov = r2)\n  ) %>%\n  bind_rows(\n    trefler %>%\n      summarize(\n        p = sum(trat * athat2 > 0) / n()\n      ) %>%\n      mutate(\n        country = \"All countries\",\n        rank_hov = mean(pull(trefler_rank, r2))\n      ) %>%\n      select(country, sign_hov = p, rank_hov)\n  ) %>%\n  mutate_if(is.numeric, round, 2) %>% # same no of decimals as in the book\n  kable()\n```\n\n::: {.cell-output-display}\n|country       | sign_hov| rank_hov|\n|:-------------|--------:|--------:|\n|Bangladesh    |     0.33|     0.75|\n|Pakistan      |     0.33|     0.72|\n|Indonesia     |     0.22|     0.67|\n|Sri Lanka     |     0.22|     0.42|\n|Thailand      |     0.22|     0.69|\n|Colombia      |     0.33|     0.81|\n|Panama        |     0.33|     0.56|\n|Yugoslavia    |     0.56|     0.44|\n|Portugal      |     0.22|     0.53|\n|Uruguay       |     1.00|     0.72|\n|Greece        |     0.11|     0.47|\n|Ireland       |     0.67|     0.53|\n|Spain         |     0.22|     0.39|\n|Israel        |     0.67|     0.39|\n|Hong Kong     |     0.67|     0.83|\n|New Zealand   |     0.44|     0.53|\n|Austria       |     0.56|     0.53|\n|Singapore     |     0.56|     0.61|\n|Italy         |     0.67|     0.78|\n|UK            |     0.67|     0.58|\n|Japan         |     0.78|     0.78|\n|Belgium       |     0.67|     0.61|\n|Trinidad      |     0.67|     0.50|\n|Netherlands   |     0.44|     0.53|\n|Finland       |     0.33|     0.47|\n|Denmark       |     0.44|     0.53|\n|West Germany  |     0.56|     0.81|\n|France        |     0.33|     0.08|\n|Sweden        |     0.44|     0.67|\n|Norway        |     0.44|     0.61|\n|Switzerland   |     0.89|     0.56|\n|Canada        |     0.56|     0.89|\n|USA           |     0.89|     0.92|\n|All countries |     0.50|     0.60|\n:::\n:::\n\n\n## Exercise 2\n\nGiven uniform technological differences across countries, run the program `sign_rank_2.do` to redo the sign test, rank test, and missing trade.  Use the results in `sign_rank_2.log` to replicate column (3) and (5), given column (6) in Table 2.5.\n\n### Feenstra's code\n\n```stata\n* This program is to conduct sign test, Rank test and Missing trade test *\n* using delta *\n\ncapture log close\n* log using Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-2\\sign_rank_2.log, replace *\nlog using \"Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-2\\sign_rank_2.log\", replace\n\nset mem 30m\n\n* use Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-2\\trefler, clear *\nuse \"Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-2\\trefler\", clear\n\n* number of country in the dataset *\negen C=max(indexc)\negen F=max(indexf)\n\n* Calculate the world level of Yw, Bw and Vw *\negen Yww=sum(Y)\ngen Yw=Yww/F\negen Bww=sum(B)\ngen Bw=Bww/F\negen Vfw=sum(V), by(indexf)\negen Vw=sum(delta*V), by(indexf)\n\n* Calculate country share Sc *\ngen Sc=(Y-B)/(Yw-Bw)\n\n* Calculate epsilon(fc) and sigma^2(f) according to eq.2 in Trefler (1995)\n\ngen Efc=delta*AT-(delta*V-Sc*Vw)\n\n* Construct the average epsilon for a given factor *\negen total=sum(Efc),by(indexf)\ngen ave=total/C\n\n* Construct sigma^2 and the weight *\n\negen tot=sum((Efc-ave)^2), by(indexf)\ngen sigma2f=tot/(C-1)\n\ncodebook sigma2f\ngen sigmaf=sqrt(sigma2f)\ngen weight=sigmaf*sqrt(Sc)\n\n* Using the weight, convert all the data *\n\ngen trAT=delta*AT/weight\ngen AThat2=(delta*V-Sc*Vw)/weight\n\n* Correlation *\n\ncorr trAT AThat2\n\n*************\n* Sign Test *\n*************\n\nsort indexc\nby indexc: count if trAT*AThat2>0\n\ncount if trAT*AThat2>0\ndisplay _result(1)/_N\n\n*****************\n* Missing Trade *\n*****************\n\nquietly summarize trAT\nlocal varAT=_result(4)\nquietly summarize AThat\nlocal varHat=_result(4)\nquietly summarize AThat2\nlocal varHat2=_result(4)\ndisplay `varAT'/`varHat'\ndisplay `varAT'/`varHat2'\n\n*************\n* Rank Test *\n*************\n\nkeep country indexc indexf trAT AThat2\n\nsort indexc indexf\nreshape wide trAT AThat2, i(indexc) j(indexf)\n\nlocal i=1\nwhile `i'<9{\n\tlocal j=`i'+1\n\twhile `j'<=9{\n\t\tgen rank`i'`j'=((trAT`i'-trAT`j')*(AThat2`i'-AThat2`j')>0)\n\t\tlocal j=`j'+1\n\t}\n\tlocal i=`i'+1\n}\n\nkeep country indexc rank*\nreshape long rank, i(indexc) j(factor)\negen r1=sum(rank), by(indexc)\ngen r2=r1/36\ncollapse r2,by(indexc country)\nsum r2\nlist\n\nlog close\nexit\n```\n\nOutput:\n\n```stata\n. * This program is to conduct sign test, Rank test and Missing trade test *\n. * using delta *\n. \n. capture log close\n\n. log using Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapte\n> r-2\\sign_rank_2.log, replace\n(note: file Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapte\n> r-2\\sign_rank_2.log not found)\n----------------------------------------------------------------------------------\n      name:  <unnamed>\n       log:  Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapt\n> er-2\\sign_rank_2.log\n  log type:  text\n opened on:  19 Jun 2024, 15:30:38\n\n. \n. set mem 30m\n\nCurrent memory allocation\n\n                    current                                 memory usage\n    settable          value     description                 (1M = 1024k)\n    --------------------------------------------------------------------\n    set maxvar         5000     max. variables allowed           1.909M\n    set memory           30M    max. data space                 30.000M\n    set matsize         400     max. RHS vars in models          1.254M\n                                                            -----------\n                                                                33.163M\n\n. \n. use Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-2\\tr\n> efler, clear\n\n. \n. * number of country in the dataset *\n. egen C=max(indexc)\n\n. egen F=max(indexf)\n\n. \n. * Calculate the world level of Yw, Bw and Vw *\n. egen Yww=sum(Y)\n\n. gen Yw=Yww/F\n\n. egen Bww=sum(B)\n\n. gen Bw=Bww/F\n\n. egen Vfw=sum(V), by(indexf)\n\n. egen Vw=sum(delta*V), by(indexf)\n\n. \n. * Calculate country share Sc *\n. gen Sc=(Y-B)/(Yw-Bw)\n\n. \n. * Calculate epsilon(fc) and sigma^2(f) according to eq.2 in Trefler (1995)\n. \n. gen Efc=delta*AT-(delta*V-Sc*Vw)\n\n. \n. * Construct the average epsilon for a given factor *\n. egen total=sum(Efc),by(indexf)\n\n. gen ave=total/C\n\n. \n. * Construct sigma^2 and the weight *\n. \n. egen tot=sum((Efc-ave)^2), by(indexf)\n\n. gen sigma2f=tot/(C-1)\n\n. \n. codebook sigma2f\n\n----------------------------------------------------------------------------------\nsigma2f                                                                (unlabeled)\n----------------------------------------------------------------------------------\n\n                  type:  numeric (float)\n\n                 range:  [51579730,3.418e+21]         units:  10\n         unique values:  9                        missing .:  0/297\n\n            tabulation:  Freq.  Value\n                            33  51579728\n                            33  3.926e+08\n                            33  6.172e+10\n                            33  1.211e+11\n                            33  1.883e+11\n                            33  2.320e+11\n                            33  2.662e+11\n                            33  2.113e+12\n                            33  3.418e+21\n\n. gen sigmaf=sqrt(sigma2f)\n\n. gen weight=sigmaf*sqrt(Sc)\n\n. \n. * Using the weight, convert all the data *\n. \n. gen trAT=delta*AT/weight\n\n. gen AThat2=(delta*V-Sc*Vw)/weight\n\n. \n. * Correlation *\n. \n. corr trAT AThat2\n(obs=297)\n\n             |     trAT   AThat2\n-------------+------------------\n        trAT |   1.0000\n      AThat2 |   0.4100   1.0000\n\n\n. \n. *************\n. * Sign Test *\n. *************\n. \n. sort indexc\n\n. by indexc: count if trAT*AThat2>0\n\n----------------------------------------------------------------------------------\n-> indexc = 1\n    7\n----------------------------------------------------------------------------------\n-> indexc = 2\n    6\n----------------------------------------------------------------------------------\n-> indexc = 3\n    6\n----------------------------------------------------------------------------------\n-> indexc = 4\n    5\n----------------------------------------------------------------------------------\n-> indexc = 5\n    6\n----------------------------------------------------------------------------------\n-> indexc = 6\n    8\n----------------------------------------------------------------------------------\n-> indexc = 7\n    7\n----------------------------------------------------------------------------------\n-> indexc = 8\n    6\n----------------------------------------------------------------------------------\n-> indexc = 9\n    7\n----------------------------------------------------------------------------------\n-> indexc = 10\n    1\n----------------------------------------------------------------------------------\n-> indexc = 11\n    5\n----------------------------------------------------------------------------------\n-> indexc = 12\n    4\n----------------------------------------------------------------------------------\n-> indexc = 13\n    7\n----------------------------------------------------------------------------------\n-> indexc = 14\n    8\n----------------------------------------------------------------------------------\n-> indexc = 15\n    8\n----------------------------------------------------------------------------------\n-> indexc = 16\n    2\n----------------------------------------------------------------------------------\n-> indexc = 17\n    6\n----------------------------------------------------------------------------------\n-> indexc = 18\n    9\n----------------------------------------------------------------------------------\n-> indexc = 19\n    3\n----------------------------------------------------------------------------------\n-> indexc = 20\n    7\n----------------------------------------------------------------------------------\n-> indexc = 21\n    6\n----------------------------------------------------------------------------------\n-> indexc = 22\n    7\n----------------------------------------------------------------------------------\n-> indexc = 23\n    9\n----------------------------------------------------------------------------------\n-> indexc = 24\n    4\n----------------------------------------------------------------------------------\n-> indexc = 25\n    4\n----------------------------------------------------------------------------------\n-> indexc = 26\n    4\n----------------------------------------------------------------------------------\n-> indexc = 27\n    6\n----------------------------------------------------------------------------------\n-> indexc = 28\n    3\n----------------------------------------------------------------------------------\n-> indexc = 29\n    4\n----------------------------------------------------------------------------------\n-> indexc = 30\n    4\n----------------------------------------------------------------------------------\n-> indexc = 31\n    8\n----------------------------------------------------------------------------------\n-> indexc = 32\n    2\n----------------------------------------------------------------------------------\n-> indexc = 33\n    5\n\n. \n. count if trAT*AThat2>0\n  184\n\n. display _result(1)/_N\n.61952862\n\n. \n. *****************\n. * Missing Trade *\n. *****************\n. \n. quietly summarize trAT\n\n. local varAT=_result(4)\n\n. quietly summarize AThat\n\n. local varHat=_result(4)\n\n. quietly summarize AThat2\n\n. local varHat2=_result(4)\n\n. display `varAT'/`varHat'\n.07061819\n\n. display `varAT'/`varHat2'\n.07061819\n\n. \n. *************\n. * Rank Test *\n. *************\n. \n. keep country indexc indexf trAT AThat2\n\n. \n. sort indexc indexf\n\n. reshape wide trAT AThat2, i(indexc) j(indexf)\n(note: j = 1 2 3 4 5 6 7 8 9)\n\nData                               long   ->   wide\n-----------------------------------------------------------------------------\nNumber of obs.                      297   ->      33\nNumber of variables                   5   ->      20\nj variable (9 values)            indexf   ->   (dropped)\nxij variables:\n                                   trAT   ->   trAT1 trAT2 ... trAT9\n                                 AThat2   ->   AThat21 AThat22 ... AThat29\n-----------------------------------------------------------------------------\n\n. \n. local i=1\n\n. while `i'<9{\n  2.         local j=`i'+1\n  3.         while `j'<=9{\n  4.                 gen rank`i'`j'=((trAT`i'-trAT`j')*(AThat2`i'-AThat2`j')>0)\n  5.                 local j=`j'+1\n  6.         }\n  7.         local i=`i'+1\n  8. }\n\n. \n. keep country indexc rank*\n\n. reshape long rank, i(indexc) j(factor)\n(note: j = 12 13 14 15 16 17 18 19 23 24 25 26 27 28 29 34 35 36 37 38 39 45 46 47\n>  48 49 56 57 58 59 67 68 69 78 79 89)\n\nData                               wide   ->   long\n-----------------------------------------------------------------------------\nNumber of obs.                       33   ->    1188\nNumber of variables                  38   ->       4\nj variable (36 values)                    ->   factor\nxij variables:\n               rank12 rank13 ... rank89   ->   rank\n-----------------------------------------------------------------------------\n\n. egen r1=sum(rank), by(indexc)\n\n. gen r2=r1/36\n\n. collapse r2,by(indexc country)\n\n. sum r2\n\n    Variable |       Obs        Mean    Std. Dev.       Min        Max\n-------------+--------------------------------------------------------\n          r2 |        33    .6153199    .1508913   .1944444   .8611111\n\n. list\n\n     +----------------------------------+\n     | indexc        country         r2 |\n     |----------------------------------|\n  1. |      1     Bangladesh   .7777778 |\n  2. |      2       Pakistan   .7777778 |\n  3. |      3      Indonesia   .6666667 |\n  4. |      4      Sri Lanka   .6666667 |\n  5. |      5       Thailand   .7222222 |\n     |----------------------------------|\n  6. |      6       Colombia   .8611111 |\n  7. |      7         Panama   .7777778 |\n  8. |      8     Yugoslavia   .6111111 |\n  9. |      9       Portugal   .5833333 |\n 10. |     10        Uruguay   .5277778 |\n     |----------------------------------|\n 11. |     11         Greece        .75 |\n 12. |     12        Ireland   .3888889 |\n 13. |     13          Spain   .6944444 |\n 14. |     14         Israel   .6944444 |\n 15. |     15      Hong Kong   .7222222 |\n     |----------------------------------|\n 16. |     16    New Zealand   .6111111 |\n 17. |     17        Austria   .4444444 |\n 18. |     18      Singapore   .6111111 |\n 19. |     19          Italy   .6666667 |\n 20. |     20             UK   .6388889 |\n     |----------------------------------|\n 21. |     21          Japan   .7777778 |\n 22. |     22        Belgium   .5277778 |\n 23. |     23       Trinidad   .5277778 |\n 24. |     24    Netherlands   .4722222 |\n 25. |     25        Finland         .5 |\n     |----------------------------------|\n 26. |     26        Denmark   .4166667 |\n 27. |     27   West Germany   .7777778 |\n 28. |     28         France   .1944444 |\n 29. |     29         Sweden   .3611111 |\n 30. |     30         Norway   .7777778 |\n     |----------------------------------|\n 31. |     31    Switzerland         .5 |\n 32. |     32         Canada   .5555556 |\n 33. |     33            USA   .7222222 |\n     +----------------------------------+\n\n. \n. log close\n      name:  <unnamed>\n       log:  Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapt\n> er-2\\sign_rank_2.log\n  log type:  text\n closed on:  19 Jun 2024, 15:30:44\n----------------------------------------------------------------------------------\n\n. exit\n\nend of do-file\n```\n\n### My code\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Transform ----\n\ntrefler <- readRDS(fout) %>%\n  # Number of country in the dataset\n  mutate(\n    c = max(indexc),\n    f = max(indexf)\n  ) %>%\n  # Calculate the world level of Yw, Bw and Vw\n  mutate(\n    yww = sum(y),\n    yw = yww / f,\n    bww = sum(b),\n    bw = bww / f\n  ) %>%\n  group_by(indexf) %>%\n  mutate(\n    vfw = sum(v),\n    vw = sum(delta * v)\n  ) %>%\n  ungroup() %>%\n  # Calculate country share Sc\n  mutate(\n    sc = (y - b) / (yw - bw)\n  ) %>%\n  # Calculate epsilon(fc) and sigma^2(f) according to eq.2 in Trefler (1995)\n  mutate(\n    efc = delta * at - (delta * v - sc * vw)\n  ) %>%\n  # Construct the average epsilon for a given factor\n  group_by(indexf) %>%\n  mutate(ave = sum(efc) / c) %>%\n  # Construct sigma^2 and the weight\n  mutate(\n    sigma2f = sum((efc - ave)^2) / (c - 1),\n    sigmaf = sqrt(sigma2f),\n    weight = sigmaf * sqrt(sc)\n  ) %>%\n  ungroup() %>%\n  # Using the weight, convert all the data\n  mutate(\n    trat = delta * at / weight,\n    athat2 = (delta * v - (sc * vw)) / weight\n  )\n\n# Correlation should be .41\ntrefler %>%\n  select(trat, athat2) %>%\n  cor()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n            trat    athat2\ntrat   1.0000000 0.4099617\nathat2 0.4099617 1.0000000\n```\n:::\n\n```{.r .cell-code}\n# Sign Test ----\n\ntrefler %>%\n  group_by(country, indexc) %>%\n  summarize(\n    p = sum(trat * athat2 > 0) / n()\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 33 × 3\n# Groups:   country [33]\n   country    indexc     p\n   <chr>       <int> <dbl>\n 1 Austria        17 0.667\n 2 Bangladesh      1 0.778\n 3 Belgium        22 0.778\n 4 Canada         32 0.222\n 5 Colombia        6 0.889\n 6 Denmark        26 0.444\n 7 Finland        25 0.444\n 8 France         28 0.333\n 9 Greece         11 0.556\n10 Hong Kong      15 0.889\n# ℹ 23 more rows\n```\n:::\n\n```{.r .cell-code}\ntrefler %>%\n  summarize(\n    p = sum(trat * athat2 > 0) / n()\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 × 1\n      p\n  <dbl>\n1 0.620\n```\n:::\n\n```{.r .cell-code}\n# Missing Trade ----\n\n# Checking for the missing trade, should be .07\n\ntrefler %>%\n  summarize(\n    varat = var(trat),\n    varhat2 = var(athat2)\n  ) %>%\n  mutate(\n    varat_varhat2 = varat / varhat2\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 × 3\n  varat varhat2 varat_varhat2\n  <dbl>   <dbl>         <dbl>\n1  1.34    19.0        0.0706\n```\n:::\n\n```{.r .cell-code}\n# Rank Tests ----\n\ntrefler_wide <- trefler %>%\n  select(country, indexc, indexf, trat, athat2) %>%\n  arrange(indexc, indexf) %>%\n  pivot_wider(\n    names_from = indexf,\n    values_from = c(trat, athat2)\n  )\n\nranks <- expand_grid(\n  x = 1:8,\n  y = 1:9\n) %>%\n  filter(x < y)\n\ntrefler_rank <- map2_df(\n  pull(ranks, x),\n  pull(ranks, y),\n  function(x, y) {\n    trefler_wide %>%\n      mutate(\n        name = paste0(\"rank\", x, y),\n        value = (!!sym(paste0(\"trat_\", x)) - !!sym(paste0(\"trat_\", y))) *\n          (!!sym(paste0(\"athat2_\", x)) - !!sym(paste0(\"athat2_\", y))) > 0\n      ) %>%\n      select(country, indexc, name, value)\n  }\n) %>%\n  group_by(country, indexc) %>%\n  summarise(r1 = sum(value)) %>%\n  mutate(r2 = r1 / 36)\n\ntrefler_rank\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 33 × 4\n# Groups:   country [33]\n   country    indexc    r1    r2\n   <chr>       <int> <int> <dbl>\n 1 Austria        17    16 0.444\n 2 Bangladesh      1    28 0.778\n 3 Belgium        22    19 0.528\n 4 Canada         32    20 0.556\n 5 Colombia        6    31 0.861\n 6 Denmark        26    15 0.417\n 7 Finland        25    18 0.5  \n 8 France         28     7 0.194\n 9 Greece         11    27 0.75 \n10 Hong Kong      15    26 0.722\n# ℹ 23 more rows\n```\n:::\n\n```{.r .cell-code}\ntrefler_rank %>%\n  pull(r2) %>%\n  mean()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.6153199\n```\n:::\n:::\n\n\n### Extra step: formatting the table\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntrefler %>%\n  group_by(country, indexc) %>%\n  summarize(\n    p = sum(trat * athat2 > 0) / n()\n  ) %>%\n  arrange(indexc) %>% # same order as in the book\n  select(country, sign_hov = p) %>%\n  left_join(\n    trefler_rank %>%\n      select(country, rank_hov = r2)\n  ) %>%\n  bind_rows(\n    trefler %>%\n      summarize(\n        p = sum(trat * athat2 > 0) / n()\n      ) %>%\n      mutate(\n        country = \"All countries\",\n        rank_hov = mean(pull(trefler_rank, r2))\n      ) %>%\n      select(country, sign_hov = p, rank_hov)\n  ) %>%\n  mutate_if(is.numeric, round, 2) %>% # same no of decimals as in the book\n  kable()\n```\n\n::: {.cell-output-display}\n|country       | sign_hov| rank_hov|\n|:-------------|--------:|--------:|\n|Bangladesh    |     0.78|     0.78|\n|Pakistan      |     0.67|     0.78|\n|Indonesia     |     0.67|     0.67|\n|Sri Lanka     |     0.56|     0.67|\n|Thailand      |     0.67|     0.72|\n|Colombia      |     0.89|     0.86|\n|Panama        |     0.78|     0.78|\n|Yugoslavia    |     0.67|     0.61|\n|Portugal      |     0.78|     0.58|\n|Uruguay       |     0.11|     0.53|\n|Greece        |     0.56|     0.75|\n|Ireland       |     0.44|     0.39|\n|Spain         |     0.78|     0.69|\n|Israel        |     0.89|     0.69|\n|Hong Kong     |     0.89|     0.72|\n|New Zealand   |     0.22|     0.61|\n|Austria       |     0.67|     0.44|\n|Singapore     |     1.00|     0.61|\n|Italy         |     0.33|     0.67|\n|UK            |     0.78|     0.64|\n|Japan         |     0.67|     0.78|\n|Belgium       |     0.78|     0.53|\n|Trinidad      |     1.00|     0.53|\n|Netherlands   |     0.44|     0.47|\n|Finland       |     0.44|     0.50|\n|Denmark       |     0.44|     0.42|\n|West Germany  |     0.67|     0.78|\n|France        |     0.33|     0.19|\n|Sweden        |     0.44|     0.36|\n|Norway        |     0.44|     0.78|\n|Switzerland   |     0.89|     0.50|\n|Canada        |     0.22|     0.56|\n|USA           |     0.56|     0.72|\n|All countries |     0.62|     0.62|\n:::\n:::\n\n\n### Notes\n\nThe Stata code that I run returns the same values as R. However:\n\n* Austria should have values 0.67 and 0.47. I got 0.67 and 0.44.\n* France should have values 0.33 and 0.22. I got 0.33 and 0.19.\n* Switzerland should have values 0.89 and 0.47. I got 0.89 and 0.50.\n\n## Exercise 3\n\nAllowing all factors in each country to have different productivities, now run the program `compute_pi.do` to compute factor productivities $\\pi_k^i$ as Trefler (1993).  Note that there are 9 factors in the original data set, but these are now aggregated to just 4 factors, which are labor (endowment 1), capital (endowment 2), cropland (endowment 3) and pasture (endowment 4).  Using the results in `pi_.log` or alternatively in the data files `pi_1.dta, pi_2.dta, pi_3.dta, pi_4.dta` to answer the following:\n\n(a)  Which factor has the most negative productivities estimated?\n(b)  What is the correlation between the estimated labor productivity and the productivities of other factors?  What is the correlation between each factor productivity and GDP per-capita (which you can find in the file `trefler.dta`)?\n\n### Feenstra's code\n\n```stata\n* This program is to compute pai, the factor productivity *\n\ncapture log close\n* log using Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-2\\pi.log,replace *\nlog using \"Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-2\\pi.log\", replace\n\nset mem 30m\n\n* use Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-2\\trefler, clear *\nuse \"Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-2\\trefler\", clear\n\n* number of country in the dataset *\negen C=max(indexc)\negen F=max(indexf)\n\n* Calculate the world level of Yw, Bw and Vw *\negen Yww=sum(Y)\ngen Yw=Yww/F\negen Bww=sum(B)\ngen Bw=Bww/F\negen Vfw=sum(V), by(indexf)\n\n* Calculate country share Sc *\ngen Sc=(Y-B)/(Yw-Bw)\n\n* Calculate epsilon(fc) and sigma^2(f) according to eq.2 in Trefler (1995)\ngen Efc=AT-(V-Sc*Vfw)\n\n* Construct the average epsilon for a given factor *\negen total=sum(Efc),by(indexf)\ngen ave=total/C\n\n* Construct sigma^2 and the weight *\n\negen tot=sum((Efc-ave)^2), by(indexf)\ngen sigma2f=tot/(C-1)\n\ncodebook sigma2f\ngen sigmaf=sqrt(sigma2f)\ngen weight=sigmaf*sqrt(Sc)\n\n* Using the weight, convert all the data *\n\ngen trAT=AT/(sigmaf*sqrt(Sc))\ngen trV=V/(sigmaf*sqrt(Sc))\ngen trY=Y/sqrt(Sc)\ngen trB=B/sqrt(Sc)\ngen trVfw=Vfw/sigmaf\n\ngen AThat=trV-Sc*trVfw\ngen AThat2=(V-Sc*Vfw)/weight\n\n* Construct Aggregate Labor Endowment *\n\npreserve\nkeep if indexf==7 |indexf==8 | indexf==9\ngen en=2\nreplace en=3 if indexf==8\nreplace en=4 if indexf==9\nkeep country factor AT V en indexc Sc\n\n* save Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-2\\indexf_189,replace *\nsave \"Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-2\\indexf_189\", replace\n\nrestore\n\npreserve\ndrop if indexf==7 |indexf==8 | indexf==9\n\negen v_l=sum(V), by(country)\negen AT_l=sum(AT), by(country)\n\ndrop V AT factor\nrename v_l V\nrename AT_l AT\ngen en=1\ncollapse (mean)AT V en indexc Sc, by(country)\ngen str5 factor=\"Labor\"\n* save Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-2\\indexf_L,replace *\nsave \"Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-2\\indexf_L\", replace\n\nrestore\n\n* use Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-2\\indexf_189,clear *\nuse \"Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-2\\indexf_189\", clear\n\n* append using Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-2\\indexf_L *\nappend using \"Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-2\\indexf_L\"\nsort indexc en\n* save Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-2\\pi,replace *\nsave \"Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-2\\pi\", replace\n\n************************************\n* Compute Pi: factor productivity *\n************************************\n\n* use Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-2\\pi, clear *\nuse \"Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-2\\pi\", clear\n\ngen p_0=1\ngen p_1=1\n\nlocal i=1\nwhile `i'<=4{\n\tpreserve\n\tkeep if en==`i'\n\tlocal j=1\n\twhile `j'<51{\n\t\treplace p_0=p_1\n\t\tgen Vp=p_0*V\n\t\tegen Vpw=sum(Vp)\n\t\treplace p_1=(AT+Sc*Vpw)/V\n\t\treplace p_1=1 if country==\"USA\"\n\t\tdrop Vp Vpw\n\t\tlocal j=`j'+1\n\t}\n\tkeep en country indexc p_1\n\t* save Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-2\\pi_`i',replace *\n  save \"Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-2\\pi_`i'\", replace\n\trestore\n\tlocal i=`i'+1\n}\n\nlocal i=1\nwhile `i'<=4{\n\t* use Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-2\\pi_`i',clear *\n  use \"Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-2\\pi_`i'\", clear\n\tsort en indexc\n\tby en: list en indexc country p_1\n\tlocal i=`i'+1\n}\n\nlog close\n\nexit\n```\n\nOutput:\n\n```stata\n. * This program is to compute pai, the factor productivity *\n. \n. capture log close\n\n. log using Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapte\n> r-2\\pi.log,replace\n----------------------------------------------------------------------------------\n      name:  <unnamed>\n       log:  Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapt\n> er-2\\pi.log\n  log type:  text\n opened on:  19 Jun 2024, 15:32:25\n\n. \n. set mem 30m\n\nCurrent memory allocation\n\n                    current                                 memory usage\n    settable          value     description                 (1M = 1024k)\n    --------------------------------------------------------------------\n    set maxvar         5000     max. variables allowed           1.909M\n    set memory           30M    max. data space                 30.000M\n    set matsize         400     max. RHS vars in models          1.254M\n                                                            -----------\n                                                                33.163M\n\n. \n. use Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-2\\tr\n> efler, clear\n\n. \n. * number of country in the dataset *\n. egen C=max(indexc)\n\n. egen F=max(indexf)\n\n. \n. * Calculate the world level of Yw, Bw and Vw *\n. egen Yww=sum(Y)\n\n. gen Yw=Yww/F\n\n. egen Bww=sum(B)\n\n. gen Bw=Bww/F\n\n. egen Vfw=sum(V), by(indexf)\n\n. \n. * Calculate country share Sc *\n. gen Sc=(Y-B)/(Yw-Bw)\n\n. \n. * Calculate epsilon(fc) and sigma^2(f) according to eq.2 in Trefler (1995)\n. gen Efc=AT-(V-Sc*Vfw)\n\n. \n. * Construct the average epsilon for a given factor *\n. egen total=sum(Efc),by(indexf)\n\n. gen ave=total/C\n\n. \n. * Construct sigma^2 and the weight *\n. \n. egen tot=sum((Efc-ave)^2), by(indexf)\n\n. gen sigma2f=tot/(C-1)\n\n. \n. codebook sigma2f\n\n----------------------------------------------------------------------------------\nsigma2f                                                                (unlabeled)\n----------------------------------------------------------------------------------\n\n                  type:  numeric (float)\n\n                 range:  [98198290,7.112e+22]         units:  10\n         unique values:  9                        missing .:  0/297\n\n            tabulation:  Freq.  Value\n                            33  98198288\n                            33  2.419e+08\n                            33  7.455e+11\n                            33  9.191e+11\n                            33  1.210e+12\n                            33  4.383e+12\n                            33  2.106e+13\n                            33  1.009e+14\n                            33  7.112e+22\n\n. gen sigmaf=sqrt(sigma2f)\n\n. gen weight=sigmaf*sqrt(Sc)\n\n. \n. * Using the weight, convert all the data *\n. \n. gen trAT=AT/(sigmaf*sqrt(Sc))\n\n. gen trV=V/(sigmaf*sqrt(Sc))\n\n. gen trY=Y/sqrt(Sc)\n\n. gen trB=B/sqrt(Sc)\n\n. gen trVfw=Vfw/sigmaf\n\n. \n. gen AThat=trV-Sc*trVfw\n\n. gen AThat2=(V-Sc*Vfw)/weight\n\n. \n. * Construct Aggregate Labor Endowment *\n. \n. preserve\n\n. keep if indexf==7 |indexf==8 | indexf==9\n(198 observations deleted)\n\n. gen en=2\n\n. replace en=3 if indexf==8\n(33 real changes made)\n\n. replace en=4 if indexf==9\n(33 real changes made)\n\n. keep country factor AT V en indexc Sc\n\n. \n. save Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-2\\i\n> ndexf_189,replace\nfile Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-2\\ind\n> exf_189.dta saved\n\n. \n. restore\n\n. \n. preserve\n\n. drop if indexf==7 |indexf==8 | indexf==9\n(99 observations deleted)\n\n. \n. egen v_l=sum(V), by(country)\n\n. egen AT_l=sum(AT), by(country)\n\n. \n. drop V AT factor\n\n. rename v_l V\n\n. rename AT_l AT\n\n. gen en=1\n\n. collapse (mean)AT V en indexc Sc, by(country)\n\n. gen str5 factor=\"Labor\"\n\n. save Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-2\\i\n> ndexf_L,replace\nfile Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-2\\ind\n> exf_L.dta saved\n\n. \n. restore\n\n. \n. use Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-2\\in\n> dexf_189,clear\n\n. append using Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Cha\n> pter-2\\indexf_L\nindexc was byte now float\n\n. sort indexc en\n\n. save Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-2\\p\n> i,replace\nfile Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-2\\pi.\n> dta saved\n\n. \n. ************************************\n. * Compute Pi: factor productivity *\n. ************************************\n. \n. use Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-2\\pi\n> , clear\n\n. \n. gen p_0=1\n\n. gen p_1=1\n\n. \n. local i=1\n\n. while `i'<=4{\n  2.         preserve\n  3.         keep if en==`i'\n  4.         local j=1\n  5.         while `j'<51{\n  6.                 replace p_0=p_1\n  7.                 gen Vp=p_0*V\n  8.                 egen Vpw=sum(Vp)\n  9.                 replace p_1=(AT+Sc*Vpw)/V\n 10.                 replace p_1=1 if country==\"USA\"\n 11.                 drop Vp Vpw\n 12.                 local j=`j'+1\n 13.         }\n 14.         keep en country indexc p_1\n 15.         save Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\\n> Chapter-2\\pi_`i',replace\n 16.         restore\n 17.         local i=`i'+1\n 18. }\n(99 observations deleted)\n(0 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(30 real changes made)\n(1 real change made)\n(29 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\nfile Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-2\\pi_\n> 1.dta saved\n(99 observations deleted)\n(0 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\nfile Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-2\\pi_\n> 2.dta saved\n(99 observations deleted)\n(0 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(32 real changes made)\n(1 real change made)\n(31 real changes made)\n(31 real changes made)\n(1 real change made)\n(30 real changes made)\n(29 real changes made)\n(1 real change made)\n(28 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\nfile Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-2\\pi_\n> 3.dta saved\n(99 observations deleted)\n(0 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(33 real changes made)\n(1 real change made)\n(32 real changes made)\n(28 real changes made)\n(1 real change made)\n(27 real changes made)\n(31 real changes made)\n(1 real change made)\n(30 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\n(0 real changes made)\n(1 real change made)\n(1 real change made)\nfile Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapter-2\\pi_\n> 4.dta saved\n\n. \n. local i=1\n\n. while `i'<=4{\n  2.         use Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\C\n> hapter-2\\pi_`i',clear\n  3.         sort en indexc\n  4.         by en: list en indexc country p_1\n  5.         local i=`i'+1\n  6. }\n\n----------------------------------------------------------------------------------\n-> en = 1\n\n     +---------------------------------------+\n     | en   indexc        country        p_1 |\n     |---------------------------------------|\n  1. |  1        1     Bangladesh   .0165219 |\n  2. |  1        2       Pakistan   .0394124 |\n  3. |  1        3      Indonesia   .0432824 |\n  4. |  1        4      Sri Lanka   .0344432 |\n  5. |  1        5       Thailand    .048902 |\n     |---------------------------------------|\n  6. |  1        6       Colombia   .1940833 |\n  7. |  1        7         Panama   .2279774 |\n  8. |  1        8     Yugoslavia   .1997569 |\n  9. |  1        9       Portugal   .1759864 |\n 10. |  1       10        Uruguay   .2029693 |\n     |---------------------------------------|\n 11. |  1       11         Greece   .3140718 |\n 12. |  1       12        Ireland   .4166084 |\n 13. |  1       13          Spain   .4172725 |\n 14. |  1       14         Israel   .6131932 |\n 15. |  1       15      Hong Kong   .3781684 |\n     |---------------------------------------|\n 16. |  1       16    New Zealand   .5850298 |\n 17. |  1       17        Austria   .5694186 |\n 18. |  1       18      Singapore   .4873306 |\n 19. |  1       19          Italy   .5907437 |\n 20. |  1       20             UK   .6332356 |\n     |---------------------------------------|\n 21. |  1       21          Japan    .604921 |\n 22. |  1       22        Belgium   .7233988 |\n 23. |  1       23       Trinidad    .448344 |\n 24. |  1       24    Netherlands   .7933354 |\n 25. |  1       25        Finland   .6969619 |\n     |---------------------------------------|\n 26. |  1       26        Denmark   .7061784 |\n 27. |  1       27   West Germany   .7691833 |\n 28. |  1       28         France    .735665 |\n 29. |  1       29         Sweden   .7270576 |\n 30. |  1       30         Norway   .7816517 |\n     |---------------------------------------|\n 31. |  1       31    Switzerland   .9317446 |\n 32. |  1       32         Canada   .7799865 |\n 33. |  1       33            USA          1 |\n     +---------------------------------------+\n\n\n----------------------------------------------------------------------------------\n-> en = 2\n\n     +---------------------------------------+\n     | en   indexc        country        p_1 |\n     |---------------------------------------|\n  1. |  2        1     Bangladesh   .9119021 |\n  2. |  2        2       Pakistan   .4867497 |\n  3. |  2        3      Indonesia    .250653 |\n  4. |  2        4      Sri Lanka   .1259789 |\n  5. |  2        5       Thailand   .3929541 |\n     |---------------------------------------|\n  6. |  2        6       Colombia   .4856291 |\n  7. |  2        7         Panama   .3224079 |\n  8. |  2        8     Yugoslavia   .2985477 |\n  9. |  2        9       Portugal    .297107 |\n 10. |  2       10        Uruguay   .4060566 |\n     |---------------------------------------|\n 11. |  2       11         Greece   .4401574 |\n 12. |  2       12        Ireland   .4783922 |\n 13. |  2       13          Spain    .519489 |\n 14. |  2       14         Israel   .5049116 |\n 15. |  2       15      Hong Kong   .5150965 |\n     |---------------------------------------|\n 16. |  2       16    New Zealand   .6197254 |\n 17. |  2       17        Austria    .542198 |\n 18. |  2       18      Singapore   .3209652 |\n 19. |  2       19          Italy   .5122213 |\n 20. |  2       20             UK   .8159872 |\n     |---------------------------------------|\n 21. |  2       21          Japan   .6502131 |\n 22. |  2       22        Belgium   .6457499 |\n 23. |  2       23       Trinidad   .4193396 |\n 24. |  2       24    Netherlands   .7513015 |\n 25. |  2       25        Finland   .6453199 |\n     |---------------------------------------|\n 26. |  2       26        Denmark    .703564 |\n 27. |  2       27   West Germany   .6629313 |\n 28. |  2       28         France   .6150761 |\n 29. |  2       29         Sweden   .9445322 |\n 30. |  2       30         Norway   .6199874 |\n     |---------------------------------------|\n 31. |  2       31    Switzerland   .6079721 |\n 32. |  2       32         Canada   .7359194 |\n 33. |  2       33            USA          1 |\n     +---------------------------------------+\n\n\n----------------------------------------------------------------------------------\n-> en = 3\n\n     +----------------------------------------+\n     | en   indexc        country         p_1 |\n     |----------------------------------------|\n  1. |  3        1     Bangladesh    .0230836 |\n  2. |  3        2       Pakistan    .0975686 |\n  3. |  3        3      Indonesia    .1641388 |\n  4. |  3        4      Sri Lanka    .2300839 |\n  5. |  3        5       Thailand    .3002517 |\n     |----------------------------------------|\n  6. |  3        6       Colombia    .5963939 |\n  7. |  3        7         Panama    .5834956 |\n  8. |  3        8     Yugoslavia    .3189657 |\n  9. |  3        9       Portugal    -.383313 |\n 10. |  3       10        Uruguay    .5709916 |\n     |----------------------------------------|\n 11. |  3       11         Greece    .6072472 |\n 12. |  3       12        Ireland    1.480371 |\n 13. |  3       13          Spain    .2365766 |\n 14. |  3       14         Israel    2.517195 |\n 15. |  3       15      Hong Kong    -229.073 |\n     |----------------------------------------|\n 16. |  3       16    New Zealand    7.520329 |\n 17. |  3       17        Austria    1.159659 |\n 18. |  3       18      Singapore   -25.49224 |\n 19. |  3       19          Italy    .6419317 |\n 20. |  3       20             UK     1.47654 |\n     |----------------------------------------|\n 21. |  3       21          Japan    4.292305 |\n 22. |  3       22        Belgium    .4575562 |\n 23. |  3       23       Trinidad    -.904206 |\n 24. |  3       24    Netherlands    9.091455 |\n 25. |  3       25        Finland      .67896 |\n     |----------------------------------------|\n 26. |  3       26        Denmark    1.759899 |\n 27. |  3       27   West Germany    1.054174 |\n 28. |  3       28         France    1.558952 |\n 29. |  3       29         Sweden     .907351 |\n 30. |  3       30         Norway    1.812922 |\n     |----------------------------------------|\n 31. |  3       31    Switzerland     3.74253 |\n 32. |  3       32         Canada    .4738446 |\n 33. |  3       33            USA           1 |\n     +----------------------------------------+\n\n\n----------------------------------------------------------------------------------\n-> en = 4\n\n     +----------------------------------------+\n     | en   indexc        country         p_1 |\n     |----------------------------------------|\n  1. |  4        1     Bangladesh    1.256177 |\n  2. |  4        2       Pakistan    .4731916 |\n  3. |  4        3      Indonesia    .4576648 |\n  4. |  4        4      Sri Lanka    .7949094 |\n  5. |  4        5       Thailand    16.93923 |\n     |----------------------------------------|\n  6. |  4        6       Colombia    .1271541 |\n  7. |  4        7         Panama    .2973391 |\n  8. |  4        8     Yugoslavia    .6397428 |\n  9. |  4        9       Portugal    1.639775 |\n 10. |  4       10        Uruguay    .0984165 |\n     |----------------------------------------|\n 11. |  4       11         Greece    .5059133 |\n 12. |  4       12        Ireland    .6129137 |\n 13. |  4       13          Spain    1.017669 |\n 14. |  4       14         Israel     2.15672 |\n 15. |  4       15      Hong Kong   -879.5381 |\n     |----------------------------------------|\n 16. |  4       16    New Zealand    .3673215 |\n 17. |  4       17        Austria    1.975304 |\n 18. |  4       18      Singapore    795.1004 |\n 19. |  4       19          Italy    3.145272 |\n 20. |  4       20             UK    2.242249 |\n     |----------------------------------------|\n 21. |  4       21          Japan    100.5984 |\n 22. |  4       22        Belgium    6.886858 |\n 23. |  4       23       Trinidad     4.62197 |\n 24. |  4       24    Netherlands    13.09784 |\n 25. |  4       25        Finland    22.29664 |\n     |----------------------------------------|\n 26. |  4       26        Denmark    28.72834 |\n 27. |  4       27   West Germany    6.864776 |\n 28. |  4       28         France    3.166397 |\n 29. |  4       29         Sweden     7.64686 |\n 30. |  4       30         Norway    34.59857 |\n     |----------------------------------------|\n 31. |  4       31    Switzerland    3.335021 |\n 32. |  4       32         Canada    .9541135 |\n 33. |  4       33            USA           1 |\n     +----------------------------------------+\n\n\n. \n. log close\n      name:  <unnamed>\n       log:  Z:\\home\\pacha\\github\\advanced-international-trade\\first-edition\\Chapt\n> er-2\\pi.log\n  log type:  text\n closed on:  19 Jun 2024, 15:32:49\n----------------------------------------------------------------------------------\n\n. \n. exit\n\nend of do-file\n```\n\n### My code\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntrefler <- readRDS(fout) %>%\n  # Number of country in the dataset\n  mutate(\n    c = max(indexc),\n    f = max(indexf)\n  ) %>%\n  # Calculate the world level of Yw, Bw and Vw\n  mutate(\n    yww = sum(y),\n    yw = yww / f,\n    bww = sum(b),\n    bw = bww / f\n  ) %>%\n  group_by(indexf) %>%\n  mutate(\n    vfw = sum(v),\n    vw = sum(delta * v)\n  ) %>%\n  ungroup() %>%\n  # Calculate country share Sc\n  mutate(\n    sc = (y - b) / (yw - bw)\n  ) %>%\n  # Calculate epsilon(fc) and sigma^2(f) according to eq.2 in Trefler (1995)\n  mutate(\n    efc = delta * at - (delta * v - sc * vw)\n  ) %>%\n  # Construct the average epsilon for a given factor\n  group_by(indexf) %>%\n  mutate(ave = sum(efc) / c) %>%\n  # Construct sigma^2 and the weight\n  mutate(\n    sigma2f = sum((efc - ave)^2) / (c - 1),\n    sigmaf = sqrt(sigma2f),\n    weight = sigmaf * sqrt(sc)\n  ) %>%\n  ungroup() %>%\n  # Using the weight, convert all the data\n  mutate(\n    trat = delta * at / weight,\n    athat2 = (delta * v - (sc * vw)) / weight\n  )\n\n# No need to save changes and restore\ntrefler2 <- trefler %>%\n  # Construct Aggregate Labor Endowment\n  filter(indexf %in% 7:9) %>%\n  mutate(\n    en = case_when(\n      indexf == 7 ~ 2,\n      indexf == 8 ~ 3,\n      indexf == 9 ~ 4\n    )\n  ) %>%\n  select(country, factor, indexf, at, v, en, indexc, sc)\n\ntrefler3 <- trefler %>%\n  filter(!(indexf %in% 7:9)) %>%\n  group_by(country) %>%\n  # No need to create v_l and at_l to then rename and then collapse\n  summarise(\n    v = sum(v),\n    at = sum(at),\n    sc = mean(sc),\n    indexc = mean(indexc)\n  ) %>%\n  mutate(\n    en = 1,\n    factor = \"Labor\"\n  )\n\ntrefler3 <- trefler2 %>%\n  select(-indexf) %>%\n  bind_rows(trefler3) %>%\n  arrange(indexc, en)\n\n# Compute Pi: factor productivity\n# No need to save intermediate outputs, we proceed with iteration\ntrefler4 <- map_df(\n  trefler3 %>%\n    distinct(en) %>%\n    pull(),\n  function(x) {\n    d <- trefler3 %>%\n      filter(en == x) %>%\n      mutate(p0 = 1, p1 = 1)\n\n    iter <- 50\n\n    for (i in seq_len(iter)) {\n      d <- d %>%\n        mutate(\n          p0 = p1,\n          vp = p0 * v,\n          vpw = sum(vp),\n          p1 = ifelse(country == \"USA\", 1, (at + sc * vpw) / v)\n        ) %>%\n        select(-vp, -vpw)\n    }\n\n    # Tidy alternative to the for loop\n    # d <- accumulate(seq_len(iter), .init = d, ~ .x %>%\n    #   mutate(\n    #     p0 = p1,\n    #     p1 = ifelse(country == \"USA\", 1, (at + sc * sum(p1 * v)) / v)\n    #   )) %>%\n    #   .[[iter + 1]]\n\n    d %>%\n      select(country, indexc, en, p1)\n  }\n)\n```\n:::\n\n\n### Extra step: formatting the tables\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntrefler4 %>%\n  arrange(country, en) %>%\n  kable()\n```\n\n::: {.cell-output-display}\n|country      | indexc| en|           p1|\n|:------------|------:|--:|------------:|\n|Austria      |     17|  1|    0.5694186|\n|Austria      |     17|  2|    0.5421980|\n|Austria      |     17|  3|    1.1596592|\n|Austria      |     17|  4|    1.9753040|\n|Bangladesh   |      1|  1|    0.0165219|\n|Bangladesh   |      1|  2|    0.9119021|\n|Bangladesh   |      1|  3|    0.0230836|\n|Bangladesh   |      1|  4|    1.2561775|\n|Belgium      |     22|  1|    0.7233988|\n|Belgium      |     22|  2|    0.6457500|\n|Belgium      |     22|  3|    0.4575561|\n|Belgium      |     22|  4|    6.8868596|\n|Canada       |     32|  1|    0.7799865|\n|Canada       |     32|  2|    0.7359194|\n|Canada       |     32|  3|    0.4738445|\n|Canada       |     32|  4|    0.9541137|\n|Colombia     |      6|  1|    0.1940833|\n|Colombia     |      6|  2|    0.4856291|\n|Colombia     |      6|  3|    0.5963939|\n|Colombia     |      6|  4|    0.1271541|\n|Denmark      |     26|  1|    0.7061784|\n|Denmark      |     26|  2|    0.7035640|\n|Denmark      |     26|  3|    1.7598990|\n|Denmark      |     26|  4|   28.7283398|\n|Finland      |     25|  1|    0.6969619|\n|Finland      |     25|  2|    0.6453199|\n|Finland      |     25|  3|    0.6789600|\n|Finland      |     25|  4|   22.2966445|\n|France       |     28|  1|    0.7356650|\n|France       |     28|  2|    0.6150762|\n|France       |     28|  3|    1.5589519|\n|France       |     28|  4|    3.1663974|\n|Greece       |     11|  1|    0.3140718|\n|Greece       |     11|  2|    0.4401574|\n|Greece       |     11|  3|    0.6072472|\n|Greece       |     11|  4|    0.5059134|\n|Hong Kong    |     15|  1|    0.3781684|\n|Hong Kong    |     15|  2|    0.5150965|\n|Hong Kong    |     15|  3| -229.0729738|\n|Hong Kong    |     15|  4| -879.5376414|\n|Indonesia    |      3|  1|    0.0432824|\n|Indonesia    |      3|  2|    0.2506530|\n|Indonesia    |      3|  3|    0.1641388|\n|Indonesia    |      3|  4|    0.4576649|\n|Ireland      |     12|  1|    0.4166084|\n|Ireland      |     12|  2|    0.4783923|\n|Ireland      |     12|  3|    1.4803708|\n|Ireland      |     12|  4|    0.6129137|\n|Israel       |     14|  1|    0.6131932|\n|Israel       |     14|  2|    0.5049116|\n|Israel       |     14|  3|    2.5171947|\n|Israel       |     14|  4|    2.1567210|\n|Italy        |     19|  1|    0.5907437|\n|Italy        |     19|  2|    0.5122213|\n|Italy        |     19|  3|    0.6419316|\n|Italy        |     19|  4|    3.1452732|\n|Japan        |     21|  1|    0.6049210|\n|Japan        |     21|  2|    0.6502130|\n|Japan        |     21|  3|    4.2923043|\n|Japan        |     21|  4|  100.5984017|\n|Netherlands  |     24|  1|    0.7933355|\n|Netherlands  |     24|  2|    0.7513015|\n|Netherlands  |     24|  3|    9.0914542|\n|Netherlands  |     24|  4|   13.0978390|\n|New Zealand  |     16|  1|    0.5850298|\n|New Zealand  |     16|  2|    0.6197254|\n|New Zealand  |     16|  3|    7.5203295|\n|New Zealand  |     16|  4|    0.3673216|\n|Norway       |     30|  1|    0.7816517|\n|Norway       |     30|  2|    0.6199874|\n|Norway       |     30|  3|    1.8129219|\n|Norway       |     30|  4|   34.5985787|\n|Pakistan     |      2|  1|    0.0394124|\n|Pakistan     |      2|  2|    0.4867497|\n|Pakistan     |      2|  3|    0.0975686|\n|Pakistan     |      2|  4|    0.4731917|\n|Panama       |      7|  1|    0.2279774|\n|Panama       |      7|  2|    0.3224079|\n|Panama       |      7|  3|    0.5834955|\n|Panama       |      7|  4|    0.2973391|\n|Portugal     |      9|  1|    0.1759864|\n|Portugal     |      9|  2|    0.2971070|\n|Portugal     |      9|  3|   -0.3833130|\n|Portugal     |      9|  4|    1.6397757|\n|Singapore    |     18|  1|    0.4873306|\n|Singapore    |     18|  2|    0.3209652|\n|Singapore    |     18|  3|  -25.4922493|\n|Singapore    |     18|  4|  795.1006524|\n|Spain        |     13|  1|    0.4172726|\n|Spain        |     13|  2|    0.5194890|\n|Spain        |     13|  3|    0.2365766|\n|Spain        |     13|  4|    1.0176692|\n|Sri Lanka    |      4|  1|    0.0344433|\n|Sri Lanka    |      4|  2|    0.1259789|\n|Sri Lanka    |      4|  3|    0.2300838|\n|Sri Lanka    |      4|  4|    0.7949096|\n|Sweden       |     29|  1|    0.7270576|\n|Sweden       |     29|  2|    0.9445322|\n|Sweden       |     29|  3|    0.9073509|\n|Sweden       |     29|  4|    7.6468612|\n|Switzerland  |     31|  1|    0.9317447|\n|Switzerland  |     31|  2|    0.6079722|\n|Switzerland  |     31|  3|    3.7425295|\n|Switzerland  |     31|  4|    3.3350218|\n|Thailand     |      5|  1|    0.0489020|\n|Thailand     |      5|  2|    0.3929541|\n|Thailand     |      5|  3|    0.3002516|\n|Thailand     |      5|  4|   16.9392348|\n|Trinidad     |     23|  1|    0.4483440|\n|Trinidad     |     23|  2|    0.4193396|\n|Trinidad     |     23|  3|   -0.9042060|\n|Trinidad     |     23|  4|    4.6219780|\n|UK           |     20|  1|    0.6332355|\n|UK           |     20|  2|    0.8159872|\n|UK           |     20|  3|    1.4765402|\n|UK           |     20|  4|    2.2422499|\n|USA          |     33|  1|    1.0000000|\n|USA          |     33|  2|    1.0000000|\n|USA          |     33|  3|    1.0000000|\n|USA          |     33|  4|    1.0000000|\n|Uruguay      |     10|  1|    0.2029693|\n|Uruguay      |     10|  2|    0.4060566|\n|Uruguay      |     10|  3|    0.5709917|\n|Uruguay      |     10|  4|    0.0984165|\n|West Germany |     27|  1|    0.7691833|\n|West Germany |     27|  2|    0.6629313|\n|West Germany |     27|  3|    1.0541740|\n|West Germany |     27|  4|    6.8647780|\n|Yugoslavia   |      8|  1|    0.1997569|\n|Yugoslavia   |      8|  2|    0.2985477|\n|Yugoslavia   |      8|  3|    0.3189656|\n|Yugoslavia   |      8|  4|    0.6397429|\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}